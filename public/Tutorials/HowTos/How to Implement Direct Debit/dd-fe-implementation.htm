<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2B,Spryker.B2C,Spryker.DemoShop">
    <head>
    </head>
    <body>
        <h1>Direct Debit Front-end Implementation <img src="../../../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../../../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../../../Resources/Images/shoptype/Demoshop.png" /></h1>
        <h2>Form creation
</h2>
        <p>In Yves, the starting point is to build a form.</p>
        <ul>
            <li>Add a new module in Yves</li>
            <li>Add a <var>Form</var> folder where we will place the implementation for building the form</li>
        </ul>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>1. Adding the data provider</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>The first step is to add the data provider, inside the <var>Form/DataProvider/</var> folder:</p><pre><code class="language-PHP line-numbers">&lt;?php
namespace Pyz\Yves\PaymentMethods\Form\DataProvider;

use Generated\Shared\Transfer\QuoteTransfer;
use Pyz\Yves\Checkout\Dependency\DataProvider\DataProviderInterface;

class DirectDebitDataProvider implements DataProviderInterface
{

    /**
     * @param \Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
     *
     * @return \Generated\Shared\Transfer\QuoteTransfer
     */
    public function getData(QuoteTransfer $quoteTransfer)
    {
        return $quoteTransfer;
    }

    /**
     * @param \Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
     *
     * @return array
     */
    public function getOptions(QuoteTransfer $quoteTransfer)
    {
        return [];
    }

}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>2. Implementing the form</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>The next step is to implement the form:</p><pre><code class="language-PHP line-numbers">&lt;?php
namespace Pyz\Yves\PaymentMethods\Form\DataProvider;

use Generated\Shared\Transfer\QuoteTransfer;
use Pyz\Yves\Checkout\Dependency\DataProvider\DataProviderInterface;

class DirectDebitDataProvider implements DataProviderInterface
{

    /**
     * @param \Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
     *
     * @return \Generated\Shared\Transfer\QuoteTransfer
     */
    public function getData(QuoteTransfer $quoteTransfer)
    {
        return $quoteTransfer;
    }

    /**
     * @param \Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
     *
     * @return array
     */
    public function getOptions(QuoteTransfer $quoteTransfer)
    {
        return [];
    }

}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>3. Adding a plugin</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>Right after the form is implemented, you will need to plug this form into checkout. In order to do that, add a plugin for it inside the <var>Plugin/</var> folder:</p><pre xml:space="preserve"><code class="language-PHP line-numbers">&lt;?php

namespace Pyz\Yves\PaymentMethods\Plugin;

use Spryker\Yves\Kernel\AbstractPlugin;
use Spryker\Yves\StepEngine\Dependency\Plugin\Form\SubFormPluginInterface;

/**
 * @method \Pyz\Yves\PaymentMethods\PaymentMethodsFactory getFactory()
 */
class DirectDebitSubFormPlugin extends AbstractPlugin implements SubFormPluginInterface
{

    /**
     * @return \Pyz\Yves\PaymentMethods\Form\DirectDebitSubForm
     */
    public function createSubForm()
    {
        return $this-&gt;getFactory()-&gt;createDirectDebitForm();
    }

    /**
     * @return \Pyz\Yves\Checkout\Dependency\DataProvider\DataProviderInterface
     */
    public function createSubFormDataProvider()
    {
        return $this-&gt;getFactory()-&gt;createDirectDebitFormDataProvider();
    }

}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <h2>
Payment Handler</h2>
        <p>The next procedure to be performed is to set-up the payment handler.</p>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>1. Handling the new payment type</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p xml:space="preserve">
To be able to handle this new payment type, add a <var>DirectDebitHandler</var> class inside the <var>Handler/</var> folder:</p><pre xml:space="preserve"><code class="language-PHP line-numbers">&lt;?php

namespace Pyz\Yves\PaymentMethods\Handler;

use Generated\Shared\Transfer\QuoteTransfer;
use Pyz\Shared\PaymentMethods\PaymentMethodsConstants;
use Symfony\Component\HttpFoundation\Request;

class DirectDebitHandler
{

    /**
     * @const string
     */
    const PAYMENT_PROVIDER = PaymentMethodsConstants::PROVIDER;

    /**
     * @const string
     */
    const PAYMENT_METHOD = PaymentMethodsConstants::PAYMENT_METHOD_DIRECTDEBIT;

    /**
     * @param \Symfony\Component\HttpFoundation\Request $request
     * @param \Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
     *
     * @return \Generated\Shared\Transfer\QuoteTransfer
     */
    public function addPaymentToQuote(Request $request, QuoteTransfer $quoteTransfer)
    {
        $quoteTransfer-&gt;getPayment()
            -&gt;setPaymentProvider(static::PAYMENT_PROVIDER)
            -&gt;setPaymentMethod(static::PAYMENT_METHOD);

        return $quoteTransfer;
    }
}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>
2. Plugging the payment handler into checkout</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>To plug this payment handler into checkout, add a plugin for it inside the <var>Plugin/</var> folder:</p><pre xml:space="preserve"><code class="language-PHP line-numbers">&lt;?php

namespace Pyz\Yves\PaymentMethods\Plugin;

use Spryker\Shared\Kernel\AbstractTransfer;
use Spryker\Yves\Kernel\AbstractPlugin;
use Spryker\Yves\StepEngine\Dependency\Plugin\Handler\StepHandlerPluginInterface;
use Symfony\Component\HttpFoundation\Request;

/**
 * @method \Pyz\Yves\PaymentMethods\PaymentMethodsFactory getFactory()
 */
class DirectDebitHandlerPlugin extends AbstractPlugin implements StepHandlerPluginInterface
{

    /**
     * @param \Symfony\Component\HttpFoundation\Request $request
     * @param \Generated\Shared\Transfer\QuoteTransfer $quoteTransfer
     *
     * @return \Generated\Shared\Transfer\QuoteTransfer
     */
    public function addToDataClass(Request $request, QuoteTransfer $quoteTransfer)
    {
        $this-&gt;getFactory()-&gt;createDirectDebitHandler()-&gt;addPaymentToQuote($request, $quoteTransfer);
    }

}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <h2>
Direct Debit Twig Template
</h2>
        <p>Add the Twig template that will be rendered when direct debit payment method is selected under the configured path:</p>
        <ol>
            <li>In Yves, create <var>directdebit.twig</var> template file in <code><var>PaymentMethods/Theme/ </var></code>, then <var>ApplicationConstants::YVES_THEME</var> config value directory.</li>
            <li>Adjust the path according to the theme you are currently using.<br /><MadCap:dropDown><MadCap:dropDownHead><MadCap:dropDownHotspot>Click to expand the code sample</MadCap:dropDownHotspot></MadCap:dropDownHead><MadCap:dropDownBody><pre xml:space="preserve"><code class="language-XML line-numbers">&lt;div class="payment-subform directdebit-form"&gt;
    &lt;h4&gt;{{ 'payment.paymentmethods.directdebit.bankaccount' | trans }}&lt;/h4&gt;
    &lt;label&gt;{{ 'payment.paymentmethods.directdebit.holder' | trans }}&lt;/label&gt;
    &lt;div class="field"&gt;
        {{ form_widget(form.paymentmethods_directdebit.bank_account_holder, { 'attr': {'placeholder': 'payment.paymentmethods.directdebit.holder' | trans } }) }}
        {{ form_errors(form.paymentmethods_directdebit.bank_account_holder) }}
    &lt;/div&gt;
    &lt;label&gt;{{ 'payment.paymentmethods.directdebit.iban' | trans }}&lt;/label&gt;
    &lt;div class="field"&gt;
        {{ form_widget(form.paymentmethods_directdebit.bank_account_iban, { 'attr': {'placeholder': 'payment.paymentmethods.directdebit.iban' | trans } }) }}
        {{ form_errors(form.paymentmethods_directdebit.bank_account_iban) }}
    &lt;/div&gt;
    &lt;label&gt;{{ 'payment.paymentmethods.directdebit.bic' | trans }}&lt;/label&gt;
    &lt;div class="field"&gt;
        {{ form_widget(form.paymentmethods_directdebit.bank_account_bic, { 'attr': {'placeholder': 'payment.paymentmethods.directdebit.bic' | trans } }) }}
        {{ form_errors(form.paymentmethods_directdebit.bank_account_bic) }}
    &lt;/div&gt;
    {{ form_widget(form.paymentmethods_directdebit) }}
    {{ form_errors(form.paymentmethods_directdebit) }}
&lt;/div&gt;</code></pre></MadCap:dropDownBody></MadCap:dropDown></li>
        </ol>
        <p class="important">Don’t forget to add the factory and the dependency provider for this new added module in Yves.
</p>
    </body>
</html>