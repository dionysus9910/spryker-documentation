<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="ReleaseVersions.2018-10">
    <head><title>Validating REST Request Format | Spryker</title>
        <meta name="description" content="This guide describes how to validate REST requests with the Glue API, explains the validation rules format and prerequisites to apply the validation rules." />
    </head>
    <body>
        <h1>Validating REST Request Format</h1>
        <p>Glue API allows you to validate requests sent to REST endpoints. It allows you to check whether all required fields are present, the type and the correct format of the fields.</p>
        <h2>1. Installation</h2>
        <p>To be able to validate REST requests, first, you need to install the <var>RestRequestValidation</var> Module that provides the functionality. For details, see <MadCap:annotation MadCap:createDate="2019-01-18T18:08:54.2883004+02:00" MadCap:creator="dmitry.beirak" MadCap:initials="DM" MadCap:comment="https://spryker.atlassian.net/wiki/spaces/DOCS/pages/401309997/API+Installation+and+Configuration#APIInstallationandConfiguration-RequestValidationIntegration" MadCap:editor="dmitry.beirak" MadCap:editDate="2019-01-18T18:08:55.5991193+02:00"><a href="https://documentation.spryker.com/feature_integration_guides/glue_api/glue-api-installation-and-configuration.htm">Request Validation Integration</a></MadCap:annotation>.</p>
        <h2>2. Default Validation Schema</h2>
        <p>Spryker Glue API comes with a default validation schema. The schema provides default validation rules for REST APIs shipped with Spryker. You can find it in the following file: <var>vendor/spryker/spryker/Bundles/RestRequestValidator/config/validation.dist.yaml</var>. The schema can be used as a sample and reference for your own validation implementations.</p>
        <p>By default, the schema is not applied.</p>
        <h2>3. Validating APIs</h2>
        <p>To apply validation rules in any of APIs, be that your own APIs or APIs shipped with Spryker, you need to:</p>
        <ol>
            <li>Copy the default validation schema file to the project level and to each API module that you want to be validated. For example, if you want to provide validation for module <i>StoresRestAPI</i>, you need to copy the file to <var>src/Pyz/Glue/StoresRestAPI/Validation</var>.</li>
            <li>Rename the file to the name of the API you are providing validation for. For the <i>StoresRestAPI</i>, the name will be <var>STORES.validation.yaml</var>.</li>
            <li>Provide validation for the endpoints provided by the API. For details, see <a href="#ruleformat">Validation Rule Format</a>.</li>
            <li>Run <pre><code lass="language-Bash">vendor/bin/console glue:rest:build-request-validation-cache</code></pre>.</li>
            <li>Make sure that the following file has changed: <var>src/Pyz/Generated/Glue/Validator/validation.cache</var>.</li>
        </ol>
        <p>Now, the API endpoints you provided validation rules for will validate all incoming requests.</p>
        <h2><a name="ruleformat"></a>4. Validation Rule Format</h2>
        <p>The general format of validation YAML files is as follows:</p><pre><code class="language-Yaml line-numbers">endpoint_name1:
  method:
    field1:
      - Constraint1
      - Constraint2
      - ConstraintWithParameters:
          parameterName: '/\w*/'
    field2:
      - Constraint1
  
endpoint_name2:
  method:
    field1:
    - Constraint1</code></pre>
        <p>The validation rules are the same as those of the Symfony Validator component. For details, see <a href="https://symfony.com/doc/current/validation.html#supported-constraints" target="_blank">Supported Constraints</a>.</p>
        <p>If you want to disable validation for any field of the APIs shipped with Spryker on your project level, you need to add the field on the project or store level without any constraints. For example, if an API is validated on the core level as follows:</p><pre><code class="language-Yaml line-numbers">access-tokens:
  post:
    username:
      - NotBlank
      - Email
      - Regex:
          pattern: '/\w*/'
  
refresh-tokens:
  post:
    refresh_token:
    - Required</code></pre>
        <p>To remove validation on the <b>username</b> field, your project level implementation should look as follows:</p><pre><code class="language-Yaml line-numbers">access-tokens:
  post:
    username:
  
refresh-tokens:
  post:
    refresh_token:
    - Required</code></pre>
        <p>By default, all the fields in a request are required. To make a field optional, the schema should be written as follows:</p><pre><code class="language-Yaml line-numbers">refresh-tokens:
  post:
    refresh_token:
    - Optional:
        constraints:
        - NotBlank</code></pre>
        <h2>5. Validation Cache</h2>
        <p>All validation rules in Spryker GLUE API are cached. For this purpose, rules are not applied immediately after you create or change them. To apply changes, you need to re-build the validation cache. For this purpose, run the following console command: <pre><code lass="language-Bash">vendor/bin/console glue:rest:build-request-validation-cache</code></pre>.</p>
        <h2>See Also:</h2>
        <ul>
            <li><a href="https://documentation.spryker.com/glue_rest_api/glue_api_developer_guides/glue-infrastructure.htm">Glue Infrastructure</a>
            </li>
            <li>
                <MadCap:xref href="implementing-rest-api-resource.htm">Implementing a REST API Resource</MadCap:xref>
            </li>
        </ul>
        <p><i>Last review date: Feb. 28th, 2019</i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Volodymyr Volkov</i>
            </MadCap:conditionalText>
        </p>
    </body>
</html>