<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2B,Spryker.B2C,Spryker.DemoShop,Spryker.ShopSuite,Spryker.MultiStore">
    <head>
        <link href="../../../Resources/TableStyles/PatternedRows.css" rel="stylesheet" MadCap:stylesheetType="table" />
    </head>
    <body>
        <h1><a name="Triggeri"></a>Triggering Events - State Machine <img src="../../../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../../../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../../../Resources/Images/shoptype/MasterSuite.png" /> <img src="../../../Resources/Images/shoptype/Demoshop.png" /></h1>
        <p>
            <MadCap:popup>
                <MadCap:popupHead>MS</MadCap:popupHead>
                <MadCap:popupBody>Multi-store</MadCap:popupBody>
            </MadCap:popup>
        </p>
        <p>There are two main triggers: first one <var>StateMachineFacade::triggerForNewStateMachineItem()</var> is used when first time triggering the state machine for an item; this trigger will initialize the state machine and start transition through states until a decision without event, timeout or manual event is detected. It will call <var>getInitialStateForProcess()</var> and <var>itemStateUpdated()</var> methods from state machine handler plugin.</p>
        <p>To manually trigger an already initialized item, use the <var>StateMachineFacade::triggerEvent()</var> facade method. This trigger will trigger a given event and start the transition through states. Also, calling into <var>itemStateUpdated</var> from SM handler.</p>
        <p>When implementing a state machine, use <var>StateMachineFacade::triggerForNewStateMachineItem()</var> when you create an item for the first time (e.g.: after order persisted, product added to cart). Method <var>StateMachineFacade::triggerEvent() </var>is mostly used in Zed to manually trigger events.</p>
        <p>There is a way to make an HTTP request to the state machine in order to trigger events.</p>
        <p>The state machine has <var>TriggerController</var> to trigger requests.</p>
        <p>Make request to <var>/state-machine/trigger/trigger-event-for-new-item</var> for uninitialized item, with there <var>$_GET</var> parameters:</p>
        <table class="TableStyle-PatternedRows" style="mc-table-style: url('../../../Resources/TableStyles/PatternedRows.css');" cellspacing="0">
            <col class="TableStyle-PatternedRows-Column-Regular" />
            <col class="TableStyle-PatternedRows-Column-Regular" />
            <thead>
                <tr class="TableStyle-PatternedRows-Head-Header1">
                    <th class="TableStyle-PatternedRows-HeadE-Regular-Header1">Parameter</th>
                    <th class="TableStyle-PatternedRows-HeadD-Regular-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-PatternedRows-Body-LightRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">
                        <p>identifier</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">
                        <p>	id of local entity event/state that it belongs to (most cases primary key of table you storing idItemState)</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-DarkerRows">
                        <p>state-machine-name</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-DarkerRows">
                        <p>string - name of the state machine that is being triggered (Invoice, PrePayment, etc..)</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-LightRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">
                        <p>process-name</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">
                        <p>string - name of the process from the current state machine</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows-BodyB-Regular-DarkerRows">
                        <p>redirect	</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyA-Regular-DarkerRows">
                        <p>	string - url to redirect to after the processing is finished</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <p>&#160;</p>
        <p>	Make a request to <var>/state-machine/trigger/trigger-event</var> for initialized item, with these <var>$_GET</var> parameters:</p>
        <table class="TableStyle-PatternedRows" style="mc-table-style: url('../../../Resources/TableStyles/PatternedRows.css');" cellspacing="0">
            <col class="TableStyle-PatternedRows-Column-Regular" />
            <col class="TableStyle-PatternedRows-Column-Regular" />
            <thead>
                <tr class="TableStyle-PatternedRows-Head-Header1">
                    <th class="TableStyle-PatternedRows-HeadE-Regular-Header1">Parameter</th>
                    <th class="TableStyle-PatternedRows-HeadD-Regular-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-PatternedRows-Body-LightRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">
                        <p>event</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">
                        <p>	event to trigger (ship, refund, cancel)</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-DarkerRows">
                        <p>id-process</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-DarkerRows">
                        <p>id of the process event that is intended</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-LightRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">
                        <p>identifier</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">
                        <p>id of the local entity event/state that it belongs to, (most cases primary key of table you storing idItemState)</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-DarkerRows">
                        <p>id-state</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-DarkerRows">
                        <p>	id of the assigned state, as it is stored in the current entity</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-LightRows">
                    <td class="TableStyle-PatternedRows-BodyE-Regular-LightRows">
                        <p>state-machine-name</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyD-Regular-LightRows">
                        <p>	string - name of the state machine that is being triggered (Invoice, PrePayment, etc..)</p>
                    </td>
                </tr>
                <tr class="TableStyle-PatternedRows-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows-BodyB-Regular-DarkerRows">
                        <p>redirect</p>
                    </td>
                    <td class="TableStyle-PatternedRows-BodyA-Regular-DarkerRows">
                        <p>string - url to redirect to after the processing is finished</p>
                    </td>
                </tr>
            </tbody>
        </table>
        <p>&#160;</p>
        <p><b>See also:</b>
        </p>
        <ul>
            <li><a href="order-process-modelling-state-machines.htm">State Machine Modelling</a>
            </li>
            <li><a href="state-machine-cronjob.htm">Cron Jobs - State Machine</a>
            </li>
            <li><a href="state-machine-implementing-plugin.htm">Implementing the Plugin - State Machine</a>
            </li>
            <li><a href="state-machine-patterns.htm">State Machine parrerns</a>
            </li>
            <li><a href="state-machine-persistence.htm">Persistence - State Machine</a>
            </li>
            <li><a href="state-machine-persistence.htm">Updating Presentation in Zed - State Machine</a>
            </li>
            <li><a href="http://documentation.spryker.com/state_machine_cookbook/state-machine-cookbook.htm">State Machine cookbook</a>
            </li>
        </ul>
        <p>&#160;</p>
        <p><![CDATA[
		
		]]><i>Last review date: </i><i>Oct. 2nd, 2017 </i><MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Denis Turkov</i><![CDATA[
]]></MadCap:conditionalText></p>
    </body>
</html>