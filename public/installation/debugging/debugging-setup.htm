<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="">
    <head>
    </head>
    <body>
        <h1>Debugging Setup</h1>
        <p>Used to be: http://spryker.github.io/getting-started/installation/debugging-setup/</p>
        <p>This article describes how to setup debugging in your development environment. </p>
        <p class="note">To configure debugging for old version of the VM prior 91, <a href="debugging-setup-prior-vm91.htm">click here</a>.</p>
        <h2>

Installing the Xdebug Module</h2>
        <p><b>To install Xdebug run</b>:</p><pre><code class="language-PHP line-numbers">sudo -i apt-get install php-xdebug
</code></pre>
        <p><b>Enable Xdebug</b>:</p>
        <p>Make sure that Xdebug is enabled in your <var>php.ini</var> file. </p>
        <p>In your virtual machine, navigate to <var>/etc/php/7.2/mods-available/xdebug.ini</var> and set:

</p><pre><code class="language-PHP line-numbers"> xdebug.remote_enable=1
 xdebug.remote_host=10.10.0.1
 # This is needed to prevent max recursion exeception when Twig templates are very complicated
 xdebug.max_nesting_level=1000
</code></pre>
        <p><b>Enable module and restart PHP-FPM</b>:</p>
        <p>Run the following command from the command line:

</p><pre><code class="language-PHP line-numbers">sudo -i bash -c "phpenmod xdebug &amp;&amp; systemctl restart php7.2-fpm.service"</code></pre>
        <p>To disable:

</p><pre><code class="language-PHP line-numbers">sudo -i bash -c "phpdismod xdebug &amp;&amp; systemctl restart php7.2-fpm.service"
</code></pre>
        <p><b>Define servers in PHPStorm</b>:
</p>
        <p>In PHPStorm go to Settings (Preferences-&gt;Languages &amp; Frameworks)-&gt;PHP-&gt;Servers Add a new Server using (+) with the following values:

</p>
        <ul>
            <li class="bullet_list">Name: Any name, e.g. <var>zed.de.demoshop.local</var> (it is used in CLI below)
</li>
            <li class="bullet_list">Host: <var>~^zed\.de\..+\.local$
</var></li>
            <li class="bullet_list">Check “Use path mappings”
</li>
            <li class="bullet_list">Set “Absolute path on server” to: <var>/data/shop/development/current</var><![CDATA[
]]></li>
        </ul>
        <p>
            <img src="../../Resources/Images/define-Servers-Php-Storm.png" title="Define Servers in PHP Storm" MadCap:mediastyle="@media print { width: auto;height: auto; }" style="height: auto;width: auto;mc-thumbnail-max-height: auto;max-width: 50%;" class="Thumbnail" />
        </p>
        <p>
For Yves, add another one using <var>~^www\.de\..+\.local$</var> as Host.

</p>
        <p class="important">Host names changed

<br />Starting from VM91 a regular expression is used to define host names and is forwarded to PHPStorm. This allows to support custom domains in your setup
</p>
        <h2><b>Configure Debugger</b><![CDATA[
]]></h2>
        <p>In PHPStorm, go to: Settings (Preferences-&gt;Languages &amp; Frameworks)-&gt;PHP-&gt;Debug -&gt; Under External connections increase Max. simultaneous connections to 2.</p>
        <p>

This is necessary to allow debugging Zed through a connection from Yves.
</p>
        <h2>Debugging
</h2>
        <p><b>To debug from PHPStorm</b>:</p>
        <ul>
            <li class="bullet_list">
Go to Run-&gt;Edit Configurations…
</li>
            <li class="bullet_list">Add a PHP Remote Debug using (+)
</li>
            <li class="bullet_list">Name: any name you like
</li>
            <li class="bullet_list">Servers: zed.de.demoshop.local
</li>
            <li class="bullet_list">Ide Key(session id): PHPSTORM
</li>
        </ul>
        <p>
            <img src="../../Resources/Images/debugging-Php-Storm.png" title="Debugging from PHPStorm" alt="Debugging from PHPStorm" class="Thumbnail" /><![CDATA[
]]></p>
        <ul>
            <li class="bullet_list">Click on Listen for PHP Debug Connections button (in the picture)
</li>
            <li class="bullet_list">Click on Debug button (in the picture), you should get the message: “Waiting for incoming connection with IDE key ‘PHPSTORM’”
</li>
        </ul>
        <p><b>Debugging Console Commands</b>:</p>
        <p>In order to trigger Xdebug in CLI, prepend environment variables to commands like

</p><pre><code class="language-PHP line-numbers">XDEBUG_CONFIG="remote_host=10.10.0.1" PHP_IDE_CONFIG="serverName=zed.de.demoshop.local" vendor/bin/console &lt;command&gt;
</code></pre>
        <p>The <var>serverName </var>variable should be equal to the server name used when defining servers in PHPStorm.
</p>
        <MadCap:snippetBlock src="../../Resources/Snippets/xdebuggooglechrome.flsnp" />
        <p>&#160;</p>
    </body>
</html>