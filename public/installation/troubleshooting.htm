<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2B,Spryker.B2C,Spryker.DemoShop,Spryker.ShopSuite">
    <head>
    </head>
    <body>
        <h1>Troubleshooting <img src="../Resources/Images/shoptype/MasterSuite.png" /> <img src="../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../Resources/Images/shoptype/Demoshop.png" /></h1>
        <p MadCap:conditions="General.Hidden Comment">Used to be: http://spryker.github.io/getting-started/installation/troubleshooting/</p>
        <p>Click on an issue to see how to troubleshoot.</p>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Error on box image download</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you get an error on downloading Spryker VM box image file, try running Vagrant with debug to see potential errors: <var>vagrant up --debug</var>.</p>
                <p>Also, you can go to <a href="https://github.com/spryker/devvm/releases/" target="_blank">Spryker VM Releases</a> page and download the box manually. After finishing the box download, you need to run the following:</p><pre><code class="language-Bash">vagrant box add /path/to/downloaded/image/file.box --name &lt;boxname&gt;
vagrant up</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Too many open files in Dev VM</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you get the <i style="color: #ff4500;">Too many open files</i> error while running <var>./vendor/bin/install</var>, you need to adjust the maximum number of open files as follows:</p><pre><code class="language-Bash">ulimit -n 65535</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>VM stuck at 'Configuring and enabling network interfaces'</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If Spryker Virtual Machine gets stuck at the <i>Configuring and enabling network interfaces</i> message during start up, do the following:</p>
                <ol>
                    <li>Press <var>Ctrl+C</var> twice to stop the VM&#160;start up process.</li>
                    <li>Execute the <var>vagrant halt</var> command to stop the VM.</li>
                    <li>Start the virtual machine again with <i>vagrant up</i>.
                    <p class="tip">If you get a message that the machine is already running, end all processes related to <i style="font-weight: bold; font-style: normal;">Vagrant</i>, <i style="font-weight: bold; font-style: normal;">Virtualbox</i> and <i style="font-weight: bold; font-style: normal;">Ruby</i>. Then try again.</p></li>
                    <li>If the start up process halts again with the same message, delete all virtual network interfaces in <b>Virtualbox</b> and restart the VM again.
					<p class="tip">The interfaces will be re-created automatically.</p></li>
                </ol>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Installation failed with the error: Could not create directory '/home/username/.ssh'</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>During Spryker Virtual Machine installation, you may receive the following error after running the <var>vagrant up</var> command: <var>'Could not create directory '/home/username/.ssh'</var>. This may happen because the implementation of OpenSSH used by Vagrant cannot resolve a path to the user's home folder.</p>
                <p>To fix the issue:</p>
                <ol>
                    <li>Execute the <var>export VAGRANT_PREFER_SYSTEM_BIN=1</var> command.</li>
                    <li>
                        <p>Resume installation by repeating the <var>vagrant up</var> command with the corresponding parameters per the Installation Guide you used:</p>
                        <ul>
                            <li><a href="installation-guide-b2b.htm#build" target="_blank">B2B Demo Shop installation guide</a>
                            </li>
                            <li><a href="installation-guide-b2c.htm#build" target="_blank">B2C Demo Shop installation guide</a>
                            </li>
                            <li><a href="installation-guide-legacy-demoshop.htm#build" target="_blank">Legacy Demoshop installation guide</a>
                            </li>
                        </ul>
                    </li>
                </ol>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Composer Install fails with 'Composer could not find a composer.json file'</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you get the <i>Composer could not find a composer.json file</i> error on the <var>composer install</var> step, do the following:</p>
                <ol>
                    <li>If you are installing onto Spryker Virtual Machine, make sure that it has been started using the <var>vagrant up</var> command.</li>
                    <p class="important">Vagrant is responsible for mounting the codebase into the VM. If you run the machine in VirtualBox directly, Spryker project codebase will not be mounted.</p>
                    <li>If you are installing onto Spryker Virtual Machine on a <b>Windows host</b>, make sure that you have completed steps <b>7. Mount the share in Windows</b> and <b>8. Copy the codebase to the VM</b> of the Installation Guides:
						<ul><li><a href="installation-guide-b2b.htm#mountshare" target="_blank">B2B Demo Shop installation guide</a></li><li><a href="installation-guide-b2c.htm#mountshare" target="_blank">B2C Demo Shop installation guide</a></li><li><a href="installation-guide-legacy-demoshop.htm#mountshare" target="_blank">Legacy Demoshop installation guide</a></li></ul></li>
                    <li>If none of the above helped, make sure that you are in the codebase installation folder. To do this, execute the following command:<pre><code class="language-Bash">git config --get remote.origin.url</code></pre><p>You should get the remote repository url, for example, <i>https://github.com/spryker-shop/b2b-demo-shop.git</i>.</p><p>Also, make sure that you are in the codebase directory, which is <var>/data/shop/development/current</var> by default.</p></li>
                </ol>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Peer authentication failed for user postgres</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you get the error below while running <var>./setup</var>, on the <var>Setup Zed</var> step:</p><pre><code class="language-PHP line-numbers">Zed Exception: RuntimeException - psql: FATAL:  Peer authentication failed for user "postgres"</code></pre>
                <p>then open the PostgreSQL configuration file :</p><pre><code class="language-Bash">sudo vim /etc/postgresql/9.4/main/pg_hba.conf</code></pre>
                <p>and make sure that the first line contains the following input:</p><pre><code class="language-PHP line-numbers">TYPE      DATABASE    USER      ADDRESS     METHOD
local     all         postgres              trust</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>The host path of the shared folder is missing</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you get <i style="color: #ff4500;">The host path of the shared folder is missing</i> error when building the virtual machine in Windows, you need to clone the Spryker repository manually and start the machine again. To do this, execute the following commands:
					<pre><code class="language-PHP line-numbers">mkdir project
cd project
git clone https://github.com/spryker-shop/suite.git .
cd ..
vagrant up</code></pre></p>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>NPM error during installation</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>During <MadCap:variable name="General.ProductName" /> installation , you can get the following error:</p><pre><code class="language-Bash line-numbers">npm ERR! code ELIFECYCLE
npm ERR! errno 137
npm ERR! spryker-master-suite@ zed: `node ./node_modules/@spryker/oryx-for-zed/build`
npm ERR! Exit status 137
npm ERR! Failed at the spryker-master-suite@ zed script.</code></pre>
                <p>To fix it:</p>
                <ol>
                    <li>On the host, execute the following commands:<pre><code class="language-Bash">vagrant reload
vagrant ssh</code></pre>.</li>
                    <li>In the code installation directory, delete folder <var>node_modules</var> and file <var>package_lock.json</var>.</li>
                    <li>Execute the following command inside the VM:<pre><code class="language-Bash">vendor/bin/install -s frontend</code></pre></li>
                </ol>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>NFS export issues</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you get the following error:</p><pre>NFS is reporting that your exports file is invalid, this means that Vagrant does
this check before making any changes to the file. Please correct
the issues below and execute "vagrant reload":
exports:3: path contains non-directory or non-existent components: /devvm/pillar
exports:3: no usable directories in export entry
exports:3: using fallback (marked offline): /
exports:4: path contains non-directory or non-existent components: /devvm/saltstack
exports:4: no usable directories in export entry
exports:4: using fallback (marked offline): /</pre>
                <p>run the following commands, try re-creating NFS&#160;exports:</p><pre><code class="language-Bash">sudo rm /etc/exports
sudo touch /etc/exports</code></pre>
                <p>If you still get the <i style="color: #ff4500;">NFS is reporting that your export file is invalid</i> error, this can also happen because you previously had VMs that were not properly destroyed. Also, such an error can occur when multiple VMs are hosted o the same computer. To fix this:</p><pre><code class="language-Bash">sudo sed -i .bak '/VAGRANT-BEGIN/,/VAGRANT-END/d' /etc/exports</code></pre>
                <p>Then, you need to re-initialize the VM:</p><pre><code class="language-Bash">vagrant halt
vagrant up --provision
# - OR -
vagrant destroy
vagrant up</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>.NFS files crash my console commands</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>You can get the following error when running <var>vendor/bin/console</var> or console commands inside the development VM:</p><pre>Error: ENOTEMPTY, directory not empty
'/data/shop/development/current/static/public/Yves/images/icons' at Error (native)</pre>
                <p> This is caused by peculiarities of the NFS&#160;file system design. Make sure you have the latest version of the VM installed and also disable the Ngnix <var>open_file_cache</var> feature. To do so, execute the following commands:</p><pre><code class="language-Bash">sudo grep -r open_file_cache /etc/nginx/
/etc/nginx/nginx.conf:  open_file_cache off;</code></pre>
                <p>To get the latest Saltstack for your VM and reconfigure Nginx, do the following:</p><pre xml:space="preserve"><code class="language-Bash"># on your host
cd vendor/spryker/saltstack # (or where you have the Saltstack repository on your host)
git pull
# inside the vm
sudo salt-call state.highstate whitelist=nginx</code></pre>
                <p>If you are running Mac OSX as a host system: disable Spotlight for your Code directory. For details, see: <a href="http://www.techiecorner.com/254/how-to-disable-spotlight-index-for-specific-folder-in-mac-os-x/" target="_blank">How to disable spotlight index for specific folder in Mac OS X</a>. </p>
                <p>To remove stale .nfs files, execute the following either on your host or inside the VM:</p><pre><code class="language-Bash">find . -name .nfs\* -exec rm {} \;</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>My Elasticsearch dies</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre>[Elastica\Exception\Connection\HttpException]
Couldn't connect to host, Elasticsearch down?</pre>
                <p>Restart Elasticsearch:</p><pre><code class="language-Bash line-numbers"># find out which Elasticsearch you are using:
grep -r ELASTICA_PARAMETER__PORT /data/shop/development/current/config/Shared
# If you have port 10005
sudo -i service elasticsearch-development restart
# Older VMs used port 9200
sudo -i service elasticsearch restart</code></pre>
                <p>Do you have more than one Elasticsearch instances running?</p><pre><code class="language-Bash line-numbers">sudo -i service elasticsearch status
sudo -i service elasticsearch-development status
sudo -i service elasticsearch-testing status
# Stop some of them ... (see above on how to figure out which one)
sudo -i service elasticsearch... stop
# ... and disable them
sudo -i update-rc.d elasticsearch... disable</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Exception connecting to Redis</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>You can get the following exception from Redis:</p><pre><code class="language-PHP line-numbers">Exception: stream_socket_client(): unable to connect to tcp://......:10009 (Connection refused)</code></pre>
                <p>This means that Redis encountered a corrupted AOF file. The following error will also be logged in Redis logs located in the following folder: <var>/data/logs/development/redis</var>:</p><pre>Bad file format reading the append only file: make a backup of your AOF file, then use ./redis-check-aof --fix [filename];</pre>
                <p>To fix the exception:</p>
                <ol>
                    <li>
                        <p>Run</p><pre><code class="language-Bash">sudo redis-check-aof --fix /data/shop/development/shared/redis/appendonly.aof</code></pre>
                        <p>You should get:</p><pre><code class="language-Bash">Successfully truncated AOF</code></pre>
                    </li>
                    <li>Start Redis server<pre><code class="language-Bash">sudo service redis-server-development start</code></pre></li>
                    <li>Make sure Redis can write log files under: <var>/data/logs/development/redis/</var><pre><code class="language-Bash">sudo chown redis:redis /data/logs/development/redis/ -R</code></pre></li>
                </ol>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Mac OSX and iterm2 (locale error)</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you encounter error messages like this one:</p><pre><code class="language-Bash line-numbers">perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
LANGUAGE = (unset),
LC_ALL = (unset),
LC_CTYPE = "de_DE.UTF-8",
LANG = "C"
are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").
perl: warning: Setting locale failed.
perl: warning: Please check that your locale settings:
LANGUAGE = (unset),
LC_ALL = (unset),
LC_CTYPE = "de_DE.UTF-8",
LANG = "C"
are supported and installed on your system.
perl: warning: Falling back to the standard locale ("C").</code></pre>
                <p>Go to iterm2 Preferences -&gt; Profiles -&gt; Terminal and disable option <i>Set locale variables automatically</i>.</p>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Setup MySQL Workbench to avoid port clashing with the host system</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>We recommend setting up TCP/IP over SSH for MySQL to avoid port clashing with the host system. For current connection values have a look at <var>config/Shared/config_default-development_DE.php.</var> Use <var>$HOME/.vagrant.d/insecure_private_key </var>as SSH Key File.</p>
                <p>MySQL: </p>
                <p>
                    <img src="../Resources/Images/msql-workbench-vagrant-setup.png" title="Workbench Vagrant Setup" alt="Workbench Vagrant Setup" class="Thumbnail" />
                </p>
                <p>In case the connection fails, run the following command :</p><pre><code class="language-Bash line-numbers">CREATE USER 'root'@'%' IDENTIFIED BY ''; # no password will be set
GRANT ALL PRIVILEGES ON * . * TO 'root'@'%';
FLUSH PRIVILEGES;</code></pre>
                <p>This command creates a new root user with full permissions.</p>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Wrong curl version error on Mac OS</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you receive an error about a wrong curl version on Mac OS, you resolve the issue using the following command:</p><pre><code class="language-Bash">sudo rm -rf /opt/vagrant/embedded/bin/curl</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Failed to decode response: zlib_decode(): data error</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you see the above error during <var>composer install</var> or c<var>omposer update</var>, you need to change your composer configuration. Run <var>composer config -ge</var> in the terminal and replace the configuration with the following one</p><pre xml:space="preserve"><code class="language-PHP line-numbers">{
    "repositories": {
        "packagist": { "url": "https://packagist.org", "type": "composer" }
    }
}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Installation fails on MacOS due to SIP</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>SIP (System Integrity Protection) is a MacOS feature that protects the system files from modification. In some cases, it precludes the proper functioning of third-party applications and may prevent you from installing Spryker on MacOS starting from version 10.11 El Capitan. To solve this problem, you need to disable SIP during the installation:</p>
                <ol>
                    <li>Reboot your Mac and hold down the Command+R as it boots.</li>
                    <li>Wait for entering the recovery environment.</li>
                    <li>Click on the “Utilities” menu and select “Terminal”.</li>
                    <li>Type <var>csrutil disable</var> in the terminal and press Enter.</li>
                    <li>Type <var>reboot</var>.</li>
                </ol>
                <p>Now SIP is disabled and you can start your installation. After it’s finished, it is strongly recommended enabling SIP again. You can do this by following the previous steps again with typing <var>csrutil enable</var> at Step 4. To determine, whether SIP is enabled or not, you can type <var>csrutil status</var>.</p>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Failed to connect to localhost port</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>If you get the following error during Spryker Vistrual Machine startup: </p><pre xml:space="preserve"><code class="language-PHP line-numbers">ErrorException - Exception: cURL error: Failed to connect to localhost port (address): Connection refused while calling Jenkins URL http://localhost:(address)/quietDown</code></pre>
                <p> Restart the Virtual Machine by running the command:</p>
                <p><code class="language-PHP line-numbers">
vagrant reload</code>
                </p>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>&#160;</p>
        <p>&#160;</p>
        <p><i>Last review date: Feb 11, 2019</i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment"> <i>by Volodymyr Volkov</i></MadCap:conditionalText>
        </p>
    </body>
</html>