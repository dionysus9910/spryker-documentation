<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="General.Demoshop">
    <head><title>Migration Guide - Category | Spryker</title>
        <link href="../Resources/TableStyles/PatternedRows2.css" rel="stylesheet" MadCap:stylesheetType="table" />
        <meta name="description" content="Learn how to migrate the Category module from version 3.* to version 4.*. " />
    </head>
    <body>
        <h1>Migration Guide - Category</h1>
        <h2><a name="3-4"></a><span style="font-size: 20pt;">Upgrading from Version 3.* to Version 4.*</span>
        </h2>
        <h3>Changes</h3>
        <p>The fourth version of the Category module introduced the changes described below.</p>
        <p>Added:</p>
        <ul>
            <li>category templates functionality</li>
            <li>category view functionality</li>
            <li>tests for the module</li>
            <li>dependencies for Storage and Event modules</li>
        </ul>
        <p>Removed:</p>
        <ul>
            <li>category <var>is_clickable</var> functionality</li>
        </ul>
        <h3>Update modules</h3>
        <ol>
            <li>Update the Category module by adding <var>"spryker/category": "^4.0.0"</var> to your <var>composer.json</var> and running <var>composer update</var>.</li>
            <p>Due to the changes in the Category module, all related modules have to be updated too.</p>
            <li>Run <var>composer require spryker/event spryker/storage</var> to install Event and Storage modules.</li>
            <h3>Database update and migration</h3>
            <li>Execute the following SQL statement to create the table <var>spy_category_template</var> and modify the <var>spy_category</var> one:</li><pre><code class="language-SQL line-numbers">
CREATE SEQUENCE "spy_category_template_pk_seq";
 
CREATE TABLE "spy_category_template"
(
    "id_category_template" INTEGER NOT NULL,
    "name" VARCHAR(255) NOT NULL,
    "template_path" VARCHAR(255) NOT NULL,
    PRIMARY KEY("id_category_template"),
    CONSTRAINT "spy_category_template-template_path" UNIQUE("template_path")
);
 
ALTER TABLE "spy_category" ADD "fk_category_template" INTEGER;
 
ALTER TABLE "spy_category" ADD FOREIGN KEY("fk_category_template") REFERENCES spy_category_template(id_category_template);</code></pre>
            <li>Run <var>console propel:diff; console propel:migrate; console propel:model:build</var> to build propel models.</li>
            <li>Run <var>console transfer:generate</var> to generate objects.</li>
            <h3>Resolve deprecations</h3>
            <p>
    Before upgrading to the new version, make sure that you do not use any deprecated code from version 3.*. You can find replacements for the deprecated code in the table below.<![CDATA[    
]]></p>
            <table style="width: 100%;mc-table-style: url('../Resources/TableStyles/PatternedRows2.css');" class="TableStyle-PatternedRows2" cellspacing="0">
                <col style="width: 1072px;" class="TableStyle-PatternedRows2-Column-Regular" />
                <col class="TableStyle-PatternedRows2-Column-Regular" />
                <thead>
                    <tr class="TableStyle-PatternedRows2-Head-Header1">
                        <td style="font-weight: bold;" class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Deprecated code</td>
                        <td style="font-weight: bold;" class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Replacement</td>
                    </tr>
                </thead>
                <tbody>
                    <tr class="TableStyle-PatternedRows2-Body-LightRows">
                        <td style="font-weight: normal;" class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">\Spryker\Shared\Category\CategoryConstants::RESOURCE_TYPE_CATEGORY_NODE</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows">\Spryker\Shared\Category\CategoryConfig::RESOURCE_TYPE_CATEGORY_NODE</td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                        <td style="font-weight: normal;" class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">\Spryker\Shared\Category\CategoryConstants::RESOURCE_TYPE_NAVIGATION</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows">\Spryker\Shared\Category\CategoryConfig::RESOURCE_TYPE_NAVIGATION</td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-LightRows">
                        <td style="font-weight: normal;" class="TableStyle-PatternedRows2-BodyB-Regular-LightRows">\Spryker\Zed\Category\Communication\Form\CategoryLocalizedAttributeType::setDefaultOptions()</td>
                        <td style="font-weight: normal;" class="TableStyle-PatternedRows2-BodyA-Regular-LightRows">\Spryker\Zed\Category\Communication\Form\CategoryLocalizedAttributeType::configureOptions()</td>
                    </tr>
                </tbody>
            </table>
            <div class="note">Also, <var>is_clickable</var> form field was removed because this functionality is obsolete, so make sure that you do not use it.</div>
            <h4>Data migration</h4>
            <p>The following migration script is designed to add the category template selection functionality to your project. If necessary, adjust the script to cover your category implementation</p>
            <MadCap:dropDown>
                <MadCap:dropDownHead>
                    <MadCap:dropDownHotspot><div class="drop-anchor">CategoryTemplateMigration.php</div></MadCap:dropDownHotspot>
                </MadCap:dropDownHead>
                <MadCap:dropDownBody><pre><code class="language-PHP line-numbers">
&lt;?php
 
/**
 * Copyright © 2016-present Spryker Systems GmbH. All rights reserved.
 * Use of this software requires acceptance of the Evaluation License Agreement. See LICENSE file.
 */
 
namespace Pyz\Zed\Category\Communication\Console;
 
use Exception;
use Orm\Zed\Category\Persistence\SpyCategoryQuery;
use Orm\Zed\Category\Persistence\SpyCategoryTemplateQuery;
use Spryker\Zed\Category\CategoryConfig;
use Spryker\Zed\Kernel\Communication\Console\Console;
use Spryker\Zed\PropelOrm\Business\Runtime\ActiveQuery\Criteria;
use Symfony\Component\Console\Input\InputInterface;
use Symfony\Component\Console\Output\OutputInterface;
 
/**
 * @method \Spryker\Zed\Category\Business\CategoryFacadeInterface getFacade()
 */
class CategoryTemplateMigration extends Console
{
 
    const COMMAND_NAME = 'category-template:migrate';
 
    /**
     * @var \Symfony\Component\Console\Output\OutputInterface
     */
    protected $output;
 
    /**
     * @param \Symfony\Component\Console\Input\InputInterface $input
     * @param \Symfony\Component\Console\Output\OutputInterface $output
     *
     * @return void
     */
    public function execute(InputInterface $input, OutputInterface $output)
    {
        $this-&gt;output = $output;
 
        $this-&gt;getFacade()-&gt;syncCategoryTemplate();
        $this-&gt;assignTemplateToAllCategories();
 
        $output-&gt;writeln('Successfully finished.');
    }
 
    /**
    * @return void
    */
    protected function configure()
    {
        parent::configure();
 
        $this-&gt;setName(static::COMMAND_NAME);
        $this-&gt;setDescription('');
    }
 
    /**
    * @throws \Exception
    *
    * @return void
    */
    protected function assignTemplateToAllCategories()
    {
        $spyCategoryTemplate = SpyCategoryTemplateQuery::create()
            -&gt;filterByName(CategoryConfig::CATEGORY_TEMPLATE_DEFAULT)
            -&gt;findOne();
 
        if (empty($spyCategoryTemplate)) {
            throw new Exception('Please specify CATEGORY_TEMPLATE_DEFAULT in your category template list configuration');
        }
 
        $query = SpyCategoryQuery::create()
            -&gt;filterByFkCategoryTemplate(null, Criteria::ISNULL);
 
        $this-&gt;output-&gt;writeln('Will update ' . $query-&gt;count() . ' categories without template.');
 
        foreach ($query-&gt;find() as $category) {
            $category-&gt;setFkCategoryTemplate($spyCategoryTemplate-&gt;getIdCategoryTemplate());
            $category-&gt;save();
        }
    }
 
    /**
    * @return array
    */
    protected function getTemplateList()
    {
        return $this-&gt;getFactory()
                -&gt;getConfig()
                -&gt;getTemplateList();
    }
 
}</code></pre>
                </MadCap:dropDownBody>
            </MadCap:dropDown>
            <li>Copy the script to <var>src/Pyz/Zed/Category/Communication/Console/CategoryTemplateMigration.php.</var></li>
            <li>Register it in <var>Pyz\Zed\Console\ConsoleDependencyProvider:</var></li><pre><code class="language-PHP line-numbers">
&lt;?php
namespace Pyz\Zed\Console;
 
class ConsoleDependencyProvider extends SprykerConsoleDependencyProvider
{
    public function getConsoleCommands(Container $container)
    {
        $commands = [
            ...
            CategoryTemplateMigration()
        ]; ...
    }
}</code></pre>
            <li>Run the command to add templates to your categories: <var>vendor/bin/console category-template:migrate</var></li>
        </ol>
        <p style="font-style: italic;">Estimated migration time: 1 hour. The time may vary depending on project-specific factors.</p>
        <p><b>See also:</b>
        </p>
        <ul>
            <li><a href="http://documentation.spryker.com/administration_interface_guide/category.htm">Creating and structuring categories</a>
            </li>
            <li><a href="http://documentation.spryker.com/administration_interface_guide/search_and_filters/category-filters.htm">Creating and managing category filters</a>
            </li>
        </ul>
        <p><i>Last review date: February 19, 2019</i> <MadCap:conditionalText MadCap:conditions="General.Hidden Comment">by Alexey Kravchenko, Andrii Tserkovnyi</MadCap:conditionalText></p>
    </body>
</html>