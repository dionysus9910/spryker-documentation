<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="General.Demoshop,Spryker.B2B,Spryker.B2C,Spryker.DemoShop,Spryker.ShopSuite">
    <head>
    </head>
    <body>
        <h1>Migration Guide - Refund <img src="../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../Resources/Images/shoptype/MasterSuite.png" /> <img src="../Resources/Images/shoptype/Demoshop.png" /></h1>
        <h2>Upgrading from Version 4.* to Version 5.*</h2>
        <p>Version 4 of the Refund module no longer uses <var>SalesAggregatorFacade </var>, it was replaced with <var>SalesFacade</var>.</p>
        <p>The <var>RefundCalculator </var>business class must now replace <var>RefundToSalesAggregatorInterface</var> with the <var>RefundToSalesInterface</var> bridge.</p>
        <p>To learn more see, <MadCap:xref href="mg-calculation.htm#Upgradin">Upgrading from version 3.* to version 4.*</MadCap:xref></p>
        <h2>Upgrading from Version 2.* to Version 3.*</h2>
        <p>To migrate the Refund module from version 2 to version 3, follow these steps:</p>
        <p>Version 3 of the Refund module was completely rebuilt; the <var>SalesAggregator </var>is used to get a calculated <var>OrderTransfer </var>and plugins are used to change the refundable amount calculation behaviour.</p>
        <p>The <var>RefundFacade </var>has completely changed and exposes only two methods. </p>
        <p>Check your code and where you make use of the <var>RefundFacade </var>change your implementation to use the new methods from the <var>RefundFacade</var>.</p>
        <p><strong>These methods are</strong>:</p>
        <ul>
            <li class="bullet_list"><var>RefundFacade::calculateRefund(array $salesOrderItems, SpySalesOrder<br /> $salesOrderEntity)</var>
            </li>
            <li class="bullet_list"><strong>RefundFacade::saveRefund(RefundTransfer $refundTransfer)</strong>
            </li>
        </ul>
        <p><strong>You need to</strong>:</p>
        <ol>
            <li>rename method <var>RefundFacade::calculateRefundableAmount()</var> to <var>RefundFacade::calculateRefund()</var> and pass needed arguments to it <var>calculateRefund()</var> will return a <var>RefundTransfer </var>which holds the refundable amount</li>
            <li>when refund process of payment provider is done and accepted pass the <var>RefundTransfer </var>to <var>RefundFacade::saveRefund()</var></li>
            <li>Refund view in sales order detail page can be activated by adding <var>'refund' =&gt; '/refund/sales/list'</var> to <var>SalesConfig::getSalesDetailExternalBlocksUrls()</var></li>
        </ol>
        <p>&#160;</p>
        <p><b>See also:</b>
        </p>
        <ul>
            <li>Using and extending the Refund module</li>
        </ul>
        <p>&#160;</p>
    </body>
</html>