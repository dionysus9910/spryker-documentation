<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="">
    <head>
    </head>
    <body>
        <h1>HowTo - Product Data from Import to Front-End View</h1>
        <p class="tip"><strong>Product Customization</strong><![CDATA[

]]><br />This article describes flow of the product data from importing it to the SQL database to showing it in the front-end view.
</p>
        <h2>Importing Products to the SQL Database
</h2>
        <p>Products are imported in the SQL database through the Importer module. The product details are parsed from CSV files, from where they are processed and inserted in the SQL database. This step is done when installing the application, after the database is created, when running the <code>./setup -i</code> script.

</p>
        <p>The products can also be imported separately, by running the dedicated command below:

</p><pre><code class="language-PHP line-numbers">vendor/bin/console data:import:product-abstract</code></pre>
        <p>In the Demoshop we import abstract (<var>product_abstract.csv</var>) and concrete (<var>product_concrete.csv</var>) products separately. The first line in the CSV files describes the structure of the entries stored in database.

</p>
        <p>Both abstract and concrete products have some attributes that are localized and non-localized. In the csv files the localized attributes contains the locales as suffix, such as <var>abstract_sku</var> which is a non-localized attribute of the product or <var>name.en_US</var> which is the localized name of the product.
</p>
        <p>There are also several fields such as <var>attribute_key_1</var> and <var>value_1</var> which represent a non-localized product attribute and it’s value. Localized product attributes also contain the locales as a suffix in the header of the csv file. These product attributes are stored in json format in the database as key-value pairs.</p>
        <h3>Load Products Into the Redis Data Store</h3>
        <p>To have this data available on front-end, we must collect it and export to Redis; Yves has no connection to the SQL database and it retrieves the product information through the Redis and Elasticsearch data stores.</p>
        <p>The export is done by the collectors. You can manually execute the export to the key-value data stores by running the following command from console:
</p><pre><code class="language-bash">vendor/bin/console collector:storage:export</code></pre>
        <h3>Display Product Information in Front-end
</h3>
        <p>Now that we have the data in the key-value storage, we are able to show the product details in the front-end views.

</p>
        <p>When requesting a page in front-end, the <code>Collector </code>module takes care of identifying the type of request (if it is a product details page or a category page) and retrieves necessary data from Redis.

</p>
        <p>It also takes care of routing the request to the correct controller action.

</p>
        <p><strong>Example</strong>:

</p>
        <p>When in Demoshop we request this page: <var>/en/canon-1200d-+-efs-1855mm-89</var>, the <var>StorageRouter</var> will try to find the route for this request. This is done in the <var>StorageRouter::match($pathInfo)</var> operation.

</p>
        <p>The <code>UrlMatcher</code> will get the URL details for this request; it will decode the URL and generate a key and it will try to retrieve the value for this key from Redis:

</p><pre><code class="language-bash">{"reference_key":"de.en_us.resource.product_abstract.89","type":"product_abstract"}</code></pre>
        <p>If it succeeds in finding a key-value entry for this URL, it will get the value for the returned reference key (in this example <var>de.en_us.resource.product_abstract.89</var>). Now that we have the data, the resource creator according to the resource type will transform the returned JSON in a more understandable format (<var>ProductResourceCreator</var>).

</p>
        <p>After building the product, the resource creator will route the request to the corresponding controller action and will pass the built product to it.

</p>
        <p>In Demoshop, product details requests are routed to <var>ProductController::detailAction(ProductAbstractInterface $product)</var> from the Product module.

</p>
        <p>You can find the view associated with this controller action under <code>Pyz\Yves\Product\Theme\demoshop\product\detail.twig</code>.

</p><pre><code class="language-PHP line-numbers">{% extends "@application/layout/layout.twig" %}

{% block content %}
&lt;h1&gt;{{ product.name }}&lt;/h1&gt;
&lt;p&gt;{{ product.description }}&lt;/p&gt;
{% endblock %}
</code></pre>
        <p>In the example above, when rendering the product details page, we’ll be able to see the name and description of the product.

</p>
        <h2>Adding New Attributes to a Product
</h2>
        <p>Adding a new attribute to a product can be done very easy, without having to make many changes.

</p>
        <p>Let’s consider that we want to add a <code>waterproof </code>attribute to abstract products that have associated boolean values.</p>
        <p>

In the <code>product_abstract.csv</code> file add the “waterproof” key to one of the already defined and yet empty <code>attribute_key_x</code> (where "x" is a number) field and the desired value to its related <code>value_x</code> field. If there’s no empty product attribute key-value field for the product you’d like to edit, then you can simply introduce a new column in the csv with the same pattern.

</p>
        <p>The process of importing products can only happen once so in order to re-import every product we’ll need to reset the data stores and reinstall it with the following command:<![CDATA[

]]></p><pre><code class="language-PHP line-numbers">./setup -i</code></pre>
        <p>Now you have the data containing your changes imported in the SQL database and in the Redis data store, and the product detail page should also display the new attribute we’ve just added.
</p>
        <p>&#160;</p>
        <p><i>Last review date: Sep. 15, 2017</i> <MadCap:conditionalText MadCap:conditions="General.Hidden Comment">by Ehsan Zanjani</MadCap:conditionalText><![CDATA[
]]></p>
    </body>
</html>