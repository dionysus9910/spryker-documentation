<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="HTTP://www.madcapsoftware.com/Schemas/MadCap.xsd" d1p1:lastBlockDepth="5" d1p1:lastHeight="3580" d1p1:lastWidth="933" xmlns:d1p1="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1>HowTo - Force HTTPS</h1>
        <p>The following article describes how you can force to use HTTPS in your pages.</p>
        <p class="info"><strong>Load balancer</strong>
            <br />If your servers are behind a load balancer and the load balancer is doing the redirects from HTTP to HTTPS, you don't need to further configure the application.
        </p>
        <h2>Application Configuration</h2>
        <h3>Force HTTPS For All Pages</h3>
        <p>To force HTTPS on all pages, you have to set <code>$config[ApplicationConstants::(YVES|ZED)_SSL_ENABLED]</code> to <code>true</code>. The application will then always force HTTPS on all pages.</p>
        <MadCap:dropDown xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Configuration:
            </MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-PHP line-numbers">&lt;?php

use Spryker\Shared\Application\ApplicationConstants;

// Zed
$config[ApplicationConstants::ZED_SSL_ENABLED] = true;

// Yves
$config[ApplicationConstants::YVES_SSL_ENABLED] = true;</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>Before a controller is resolved, the application will check if the request is secure and that the requested resource is not excluded from HTTPS.</p>
        <div class="example">If the request is not secure and not excluded from HTTPS, the application will return a redirect response if the page was requested with HTTP.
		<p>If the request is secure and page is excluded from HTTPS, the application will allow requests with HTTP.</p></div>
        <h3>Allow Pages to Use HTTP</h3>
        <p>You can also allow some of your pages not to use HTTPS. If you want to allow some pages to use HTTP you can add them
            to <code>$config[ApplicationConstants::(YVES|ZED)_SSL_EXCLUDED]</code> and only set <code>$config[ApplicationConstants::(YVES|ZED)_SSL_ENABLED]</code> to <code>true</code>. The
            key in this array is the route name and the value is the URL.
        </p>
        <MadCap:dropDown xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Configuration:
            </MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-PHP line-numbers">&lt;?php

use Spryker\Shared\Application\ApplicationConstants;

// Zed
$config[ApplicationConstants::ZED_SSL_ENABLED] = true;
$config[ApplicationConstants::ZED_SSL_EXCLUDED] = [
    'route-name' =&gt; '/url'
];

// Yves
$config[ApplicationConstants::YVES_SSL_ENABLED] = true;
$config[ApplicationConstants::YVES_SSL_EXCLUDED] = [
    'route-name' =&gt; '/url'
];</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <h2>When Is a Request Secure?</h2>
        <p>There are two options that identify if a request is secure or not.</p>
        <ol>
            <li>When the value of <code>$request-&gt;server-&gt;get('REMOTE_ADDR')</code> is found in the configured trusted proxies and the value of <code>$request-&gt;header-&gt;get('X_FORWARDED_PROTO')</code> is HTTPS.</li>
            <li>When the value of <code>$request-&gt;server-&gt;get('HTTPS')</code> is HTTPS.</li>
        </ol>
        <p>The checks for a secure request will be made in this order.</p>
        <h2>Trusted Proxy Configuration</h2>
        <p>Both applications have a configuration for trusted proxies. To use trusted proxies you need to configure <code>$config[ApplicationConstants::(YVES|ZED)_TRUSTED_PROXIES]</code></p>
        <MadCap:dropDown xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Configuration:
        </MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-PHP line-numbers">&lt;?php

use Spryker\Shared\Application\ApplicationConstants;

// Zed
$config[ApplicationConstants::ZED_TRUSTED_PROXIES] = [
    // the IP address (or range) of your proxy
    '192.0.0.1',
    '10.0.0.0/8',
];

// Yves
$config[ApplicationConstants::YVES_TRUSTED_PROXIES] = [
    // the IP address (or range) of your proxy
    '192.0.0.1',
    '10.0.0.0/8',
];</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>As described above, the application will check if the value of <code>$request-&gt;server-&gt;get('REMOTE_ADDR')</code> can be found in your configured trusted proxies. If so, the current request will be marked as secure when the value of <code>$request-&gt;header-&gt;get('X_FORWARDED_PROTO')</code> is HTTPS.</p>
        <p>&#160;</p>
        <p><i>Last reivew date: Sep. 21, 2017</i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd"><i> by René Klatt</i>
            </MadCap:conditionalText>
        </p>
    </body>
</html>