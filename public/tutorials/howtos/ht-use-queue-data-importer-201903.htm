<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-conditions="ReleaseVersions.2019-03" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Tutorials|HowTos">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <meta name="description" content="This article will explain you how to use the Queue Data feature that adds the ability to import data with the help of message queues." />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>HowTo - Use Queue Data Importer | Spryker</title>
        <!-- Google Tag Manager -->
        <script>/* <![CDATA[ */(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-NP24S2');/* ]]> */</script>
        <!-- End Google Tag Manager -->
        <script>/* <![CDATA[ */
			var s = document.createElement("script");
			s.type = "text/javascript";
			s.src = "https://www.googletagmanager.com/gtag/js?id==UA-56589105-4";
			document.getElementsByTagName('head').item(0).appendChild(s);
		/* ]]> */</script>
        <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-56589105-4');
		/* ]]> */</script>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/perfect-scrollbar.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../resources/scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../resources/scripts/custom.modernizr.js">
        </script>
        <script src="../../resources/scripts/jquery.min.js">
        </script>
        <script src="../../resources/scripts/require.min.js">
        </script>
        <script src="../../resources/scripts/require.config.js">
        </script>
        <script src="../../resources/scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../resources/scripts/plugins.min.js">
        </script>
        <script src="../../resources/scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <!-- Google Tag Manager (noscript) -->
                                <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP24S2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                </noscript>
                                <!-- End Google Tag Manager (noscript) -->
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="breadcrumbs-block">
                                            <div class="nocontent">
                                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                        </div>
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie _Skins_SearchHome mc-component">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="94z6nyDHMEqKGNAvQuAuBQ">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="94z6nyDHMEqKGNAvQuAuBQ:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="toolbar-wrapper">
                                                    <div class="widget-github js-widget-github"><a class="widget-github-link js-widget-github-link" href="https://github.com/spryker/spryker-documentation" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><path d="M13.5 0C6.057 0 0 6.057 0 13.5c0 5.888 3.791 10.905 9.058 12.745a.463.463 0 0 0 .258.088c1.316.43 2.724.667 4.184.667C20.943 27 27 20.943 27 13.5S20.943 0 13.5 0zm0 .931c6.93 0 12.569 5.639 12.569 12.569 0 5.428-3.459 10.061-8.287 11.818a1.903 1.903 0 0 1-.092-.527v-2.446c0-.975-.477-2.037-.946-2.75 2.584-.436 5.537-1.776 5.537-6.779 0-1.37-.429-2.58-1.275-3.598.186-.611.415-1.9-.225-3.52a.47.47 0 0 0-.291-.272c-.13-.04-1.326-.35-3.806 1.277a12.921 12.921 0 0 0-6.36 0c-2.481-1.63-3.68-1.319-3.809-1.277a.47.47 0 0 0-.29.273C5.582 7.319 5.811 8.607 6 9.218c-.85 1.018-1.279 2.227-1.279 3.598 0 4.957 2.9 6.323 5.463 6.778-.322.407-.66.934-.81 1.47-.661.184-2.018.19-2.929-1.37-.032-.06-.829-1.475-2.4-1.584-.25.002-.882.042-1.035.525-.169.537.424.944.679 1.117l.058.034c.029.015.707.371 1.213 1.644.105.333 1.03 2.84 4.353 2.399.002.367 0 .552-.004.7v.26c0 .15-.045.378-.096.525C4.386 23.558.931 18.924.931 13.5.931 6.57 6.57.931 13.5.931zm6.51 5.375c.5 1.471.158 2.537.035 2.839a.468.468 0 0 0 .089.49c.805.883 1.214 1.952 1.214 3.181 0 4.72-2.796 5.666-5.535 5.97a.464.464 0 0 0-.253.815c.368.314 1.199 1.68 1.199 2.744v2.446c0 .009.001.414.134.809a12.513 12.513 0 0 1-6.792-.002c.135-.396.139-.802.139-.81l.001-.248c.002-.211.006-.497 0-1.266a.473.473 0 0 0-.174-.362.47.47 0 0 0-.391-.09c-3.126.681-3.802-1.576-3.828-1.67l-.016-.047c-.448-1.135-1.037-1.713-1.388-1.975.759.267 1.182 1.007 1.193 1.024 1.231 2.107 3.264 2.162 4.328 1.685a.463.463 0 0 0 .27-.36c.095-.665.826-1.545 1.196-1.87a.464.464 0 0 0 .136-.488.461.461 0 0 0-.39-.324c-2.73-.31-5.524-1.266-5.524-5.98 0-1.228.41-2.3 1.219-3.181a.464.464 0 0 0 .087-.491c-.124-.302-.467-1.364.031-2.837.396.013 1.362.182 2.988 1.286.112.076.256.1.387.063.973-.27 2.058-.416 3.135-.421 1.08.005 2.166.15 3.14.421.131.037.273.013.386-.063 1.635-1.11 2.6-1.275 2.984-1.288z" /></svg></a>
                                                    </div>
                                                    <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic NextTopic Print ExpandAll CollapseAll;">
                                                        <div class="button-group-container-left">
                                                            <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                                            </button>
                                                            <button class="button needs-pie next-topic-button" title="Navigate next">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                                            </button>
                                                            <button class="button needs-pie print-button" title="Print">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                            </button>
                                                            <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="js-anchorer main-content">
                                                    <h1>HowTo - Use Queue Data Importer</h1>
                                                    <p>Queue data import adds the ability to import data with the help of message queues. It is meant to increase data import performance by using performance-related abilities/properties of message queues, like:</p>
                                                    <ul>
                                                        <li value="1">Parallel message consumption by multiple consumers using round-robin</li>
                                                        <li value="2">Fast transmitting of large amounts of data</li>
                                                        <li value="3">Bulk message processing</li>
                                                    </ul>
                                                    <p>Besides this, Queue Data Import also provides the ability to use different import groups.</p>
                                                    <h2>Why You Need It</h2>
                                                    <p>The main goal of using Queue Data Import is the ability to import data in parallel. Once the data is stored in a queue, it can be consumed by several consumers at a time, thus roughly dividing total import execution time by the number of consumers.</p>
                                                    <h2>How Does It Work</h2>
                                                    <p>Regular data import is done as a single-step process: the data is read from some data source and then stored in persistent storage (usually a database).</p>
                                                    <p>
                                                        <img src="../../resources/images/data-import.png" />
                                                    </p>
                                                    <p>Queue data import is intended to be done in two separate steps.</p>
                                                    <ol>
                                                        <li value="1"><b>Step 1</b> is about importing the data from the original data source into the queue.<br />a. Each resource (e.g. abstract product data) is meant to be imported to its dedicated queue.<br />b. In general, during this step, data should not be preprocessed in any way and should go to a queue as is.</li>
                                                        <li value="2">During Step 2, data previously stored in a queue is consumed from the queue and imported into persistent storage.
            </li>
                                                    </ol>
                                                    <h3>How to Export Data from CSV to Queue (Step 1)</h3>
                                                    <p>The <var>DataImport</var> module was extended with the new classes that are responsible for providing the preconfigured queue writer instances to the data import facilities. It is completely configured on the project level.</p>
                                                    <p>To be able to import data into a message queue, an instance of <var>Spryker\Zed\DataImport\Business\DataWriter\QueueWriter\QueueWriter</var> should be used as a data writer during import. Two pieces of configuration have to be provided to a queue writer's <var>::write()</var> method:</p>
                                                    <ol>
                                                        <li value="1">Queue name - a name of the resource-based queue which will store the imported data between the step (i.e. <b>import.product_abstract</b>)</li>
                                                        <li value="2">Chunk size - the size of the chunks in which the data will be written to a queue</li>
                                                    </ol>
                                                    <p>First, a dedicated configuration method has to be defined in <var>Pyz\Zed\DataImport\DataImportConfig</var>:</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Zed\DataImport\DataImportConfig</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">.....
use Spryker\Zed\DataImport\DataImportConfig as SprykerDataImportConfig;
.....
 
class DataImportConfig extends SprykerDataImportConfig
{
    public const PRODUCT_ABSTRACT_QUEUE = 'import.product_abstract';
    public const PRODUCT_ABSTRACT_QUEUE_ERROR = 'import.product_abstract.error';
 
    .....
 
    public function getProductAbstractQueueWriterConfiguration(): DataImporterQueueWriterConfigurationTransfer
    {
        return (new QueueWriterConfigurationTransfer())
            -&gt;setQueueName(static::PRODUCT_ABSTRACT_QUEUE)
            -&gt;setChunkSize($this-&gt;getQueueWriterChunkSize());
    }
    .....
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Here you have to specify the names for the queues:</p>
                                                    <ol>
                                                        <li value="1">the main queue, which will hold the data</li>
                                                        <li value="2">the error queue (the name of the main queue suffixed with .error)</li>
                                                    </ol>
                                                    <p>You need to specify the name for the method, which will create an instance of <var>DataImportQueueWriterConfigurationTransfer</var> and initialize it with the main queue name and the size of a chunk the data will be written in.</p>
                                                    <p>Next, a plugin class, which will configure and hook up queue writer with data importer, needs to be created. This plugin must extend <var>Spryker\Zed\DataImport\Communication\Plugin\AbstractQueueWriterPlugin</var> and has to provide implementations for its two abstract methods:</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Zed\DataImport\Communication\Plugin\ProductAbstract\ProductAbstractQueueWriterPlugin</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">use Spryker\Zed\DataImport\Communication\Plugin\AbstractQueueWriterPlugin;
.....
 
/**
 * @method \Pyz\Zed\DataImport\DataImportConfig getConfig()
 */
class ProductAbstractQueueWriterPlugin extends AbstractQueueWriterPlugin
{
    protected function getQueueName(): string
    {
        return $this-&gt;getConfig()-&gt;getProductAbstractQueueWriterConfiguration()-&gt;getQueueName();
    }
 
    protected function getChunkSize(): int
    {
        return $this-&gt;getConfig()-&gt;getProductAbstractQueueWriterConfiguration()-&gt;getChunkSize();
    }
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>The plugin should call the newly created method from the config class, thus providing the configuration values to the queue writer instance.</p>
                                                    <p class="important">Additional plugins must be created for other resources, should they need to be imported with the help of message queues.</p>
                                                    <p>After that, the names of the new queues need to be added to the <var>RabbitMq</var>module configuration class. Go to <var>Pyz\Client\RabbitMq\RabbitMqConfig</var> and register the new queues for the resource.</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Client\RabbitMq\RabbitMqConfig</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">use Spryker\Zed\DataImport\DataImportConfig;
  
.....
  
/**
 * @return \ArrayObject
 */
protected function getQueueOptions()
{
    .....
    //Queue data import
    $queueOptionCollection-&gt;append($this-&gt;createQueueOption(DataImportConfig::PRODUCT_ABSTRACT_QUEUE, DataImportConfig::PRODUCT_ABSTRACT_QUEUE_ERROR));
    ......
  
    return $queueOptionCollection;
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>The last step is to enable Queue data import. Go to <var>Pyz\Zed\DataImport\Business\DataImportBusinessFactory</var>.</p>
                                                    <p>First of all, remove all the old code related to importing the selected resource data.</p>
                                                    <p>Then, add a method for creating <var>DataSetWriterCollection</var> based on that plugin and another one for creating data importer, which will work on top of this collection. Add the call to this method to <var>DataImportBusinessFactory::getImporter()</var>.</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Zed\DataImport\Business\DataImportBusinessFactory</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">use Pyz\Zed\DataImport\DataImportConfig;
use Pyz\Zed\DataImport\Communication\Plugin\ProductAbstract\ProductAbstractQueueWriterPlugin;
  
class DataImportBusinessFactory extends SprykerDataImportBusinessFactory
{
    .....
    public function getImporter()
    {
        $dataImporterCollection = $this-&gt;createDataImporterCollection();
        .....
        $dataImporterCollection-&gt;addDataImporter($this-&gt;getProductAbstractQueueWriter());
        .....
        return $dataImporterCollection;
    }
  
    public function getProductAbstractQueueWriter()
    {
        $dataImporter = $this-&gt;getCsvDataImporterWriterAwareFromConfig($this-&gt;getConfig()-&gt;getProductAbstractDataImporterConfiguration());
        $dataImporter-&gt;setImportGroup(DataImportConfig::IMPORT_GROUP_QUEUE_WRITERS);
        $dataImporter-&gt;setDataSetWriter($this-&gt;createProductAbstractQueueDataImportWriters());
  
        return $dataImporter;
    }
  
    protected function createProductAbstractQueueDataImportWriters(): DataSetWriterInterface
    {
        return new DataSetWriterCollection($this-&gt;createProductAbstractQueueWriterPlugins());
    }
  
    protected function createProductAbstractQueueWriterPlugins(): array
    {
        return [
            new ProductAbstractQueueWriterPlugin(),
        ];
    }
    .....
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Pay attention to the <var>::setImportGroup()</var> method call on the data importer instance. By calling this method, an import group can be set for each separate data import. Import groups allow you to run importers separately on a per-group basis by supplying the group name as an option for the data import console command. Three groups are supported out of the box: <var>FULL, QUEUE_READERS, QUEUE_WRITERS</var>. With no call to <var>::setImportGroup</var>, data importer will be placed into the <var>FULL</var> group by default.</p>
                                                    <p class="important">It is not recommended to use the <var>QUEUE_READERS</var> group. This executes all the configured queue importers during one import run. Because in a lot of scenarios the order, in which the data is imported, matters and because of the possibility of the race condition, this can lead to various malfunctions/inconsistencies in the imported data. We recommend structuring the import process in a way that would allow importing data with the help of the message queues apart from other imported resources.</p>
                                                    <p>Now, whenever you run <var>vendor/bin/console data:import</var> with the <var>--group</var> option set to <var>QUEUE_WRITERS</var>, product abstract data will be stored in the dedicated queue.</p><pre><code class="language-PHP line-numbers">vendor/bin/console data:import --group=QUEUE_WRITERS</code></pre>
                                                    <p class="important">Import groups should not be used together with import types. For example, this command is illegal and will lead to an exception:<br /><var>vendor/bin/console data:import:product-abstract --group=QUEUE_WRITERS</var></p>
                                                    <p class="important">We also highly recommend preparing the properly structured data for the import in queues from the very beginning instead of actually importing it from CSV, XML, etc. as the first step. In this case, a queue can be treated as an original source of data for import which would make the overall process more convenient.</p>
                                                    <h2>How to Export Data from Queue to Database (Step 2)</h2>
                                                    <p>Add a new constant and a public method to <var>Pyz\Zed\DataImport\DataImportConfig</var>. The method should call <var>Spryker\Zed\DataImport::buildQueueDataImporterConfiguration()</var>, passing three arguments:</p>
                                                    <ul>
                                                        <li value="1">The name of the queue to consume messages from (should match the name of the queue used in <b>Step 1</b>)</li>
                                                        <li value="2">Import type</li>
                                                        <li value="3">Queue consumer options</li>
                                                    </ul>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Zed\DataImport\DataImportConfig</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">use Generated\Shared\Transfer\QueueDataImporterConfigurationTransfer;
use Generated\Shared\Transfer\RabbitMqConsumerOptionTransfer;
use Spryker\Zed\DataImport\DataImportConfig as SprykerDataImportConfig;
.....
 
class DataImportConfig extends SprykerDataImportConfig
{
    public const IMPORT_TYPE_PRODUCT_ABSTRACT_QUEUE = 'product-abstract-queue';
    .....
  
    public function getProductAbstractQueueImporterConfiguration(): QueueDataImporterConfigurationTransfer
    {
        return $this-&gt;buildQueueDataImporterConfiguration(
            'import.product_abstract',
            static::IMPORT_TYPE_PRODUCT_ABSTRACT_QUEUE,
            $this-&gt;getQueueConsumerOptions()
        );
    }
 
    protected function getQueueConsumerOptions(): array
    {
        return [
            'rabbitmq' =&gt; (new RabbitMqConsumerOptionTransfer())-&gt;setConsumerExclusive(false)-&gt;setNoWait(false),
        ];
    }
    .....
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Notice that a new import type has been introduced. It needs to be registered in <var>Pyz\Zed\Console\ConsoleDependencyProvider::getConsoleCommands()</var>.</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Zed\Console\ConsoleDependencyProvider</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">namespace Pyz\Zed\Console;
 
use Pyz\Zed\DataImport\DataImportConfig;
use Spryker\Zed\Console\ConsoleDependencyProvider as SprykerConsoleDependencyProvider;
use Spryker\Zed\DataImport\Communication\Console\DataImportConsole;
.....
 
class ConsoleDependencyProvider extends SprykerConsoleDependencyProvider
{
    protected function getConsoleCommands(Container $container)
    {
        $commands = [
            .....
            new DataImportConsole(DataImportConsole::DEFAULT_NAME . ':' . DataImportConfig::IMPORT_TYPE_PRODUCT_ABSTRACT_QUEUE),
            .....
        ];
        .....
    }
    .....
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p class="important">You should use different import type names for <b>Step 1</b> and <b>Step 2</b></p>
                                                    <p>&#160;</p>
                                                    <p>Go to <var>Pyz\Zed\DataImport\Business\DataImportBusinessFactory</var> and add a new method for creating the queue data importer that will use the queue reader and import data to the database. Add a call to this method to <var>DataImportBusinessFactory::getImporter()</var> after the one that creates the queue writer.</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Zed\DataImport\Business\DataImportBusinessFactory</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">use Spryker\Zed\DataImport\Business\DataImporter\Queue\QueueDataImporterInterface;
.....
 
class DataImportBusinessFactory extends SprykerDataImportBusinessFactory
{
    .....
    public function getImporter()
    {
        .....
        $dataImporterCollection-&gt;addDataImporter($this-&gt;getProductAbstractQueueWriter());
        .....
        $dataImporterCollection-&gt;addDataImporter($this-&gt;createProductAbstractQueueImporter());
        .....
    }
  
    protected function createProductAbstractQueueImporter(): QueueDataImporterInterface
    {
        $dataImporter = $this-&gt;createQueueDataImporter($this-&gt;getConfig()-&gt;getProductAbstractQueueImporterConfiguration());
  
        $dataSetStepBroker = $this-&gt;createTransactionAwareDataSetStepBroker(ProductAbstractHydratorStep::BULK_SIZE);
        $dataSetStepBroker
            -&gt;addStep($this-&gt;createAddLocalesStep())
            -&gt;addStep($this-&gt;createAddCategoryKeysStep())
            -&gt;addStep($this-&gt;createTaxSetNameToIdTaxSetStep(ProductAbstractHydratorStep::KEY_TAX_SET_NAME))
            -&gt;addStep($this-&gt;createAttributesExtractorStep())
            -&gt;addStep($this-&gt;createProductLocalizedAttributesExtractorStep([
                ProductAbstractHydratorStep::KEY_NAME,
                ProductAbstractHydratorStep::KEY_URL,
                ProductAbstractHydratorStep::KEY_DESCRIPTION,
                ProductAbstractHydratorStep::KEY_META_TITLE,
                ProductAbstractHydratorStep::KEY_META_DESCRIPTION,
                ProductAbstractHydratorStep::KEY_META_KEYWORDS,
            ]))
            -&gt;addStep(new ProductAbstractHydratorStep());
        $dataImporter-&gt;addDataSetStepBroker($dataSetStepBroker);
        $dataImporter-&gt;setDataSetWriter($this-&gt;createProductAbstractDataImportWriters());
  
        return $dataImporter;
    }
    .....
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>Pay attention to <var>Spryker\Zed\DataImport\Business\DataImportBusinessFactory::createQueueDataImporter()</var>. Instead of creating the regular data importer instance, this method will create an instance of the <var>Spryker\Zed\DataImport\Business\DataImporter\Queue\QueueDataImporter</var> class, which is responsible for handling the queue-related tasks such as message acknowledgment after successful data import. During data import, an instance of this class is preconfigured to run as part of the <var>QUEUE_READERS</var> group.</p>
                                                    <p>Finally, make changes to all bulk data set writers, which store data internally and then flush it to the database in bulk once a configured threshold is reached. First, you should use <var>Spryker\Zed\DataImport\Business\DataImporter\Queue\DataSetWriterPersistenceStateAwareTrait</var> inside these writers. Then you should:</p>
                                                    <ul>
                                                        <li value="1">switch the persistence state to <var>false</var> at the very beginning of the <var>::write()</var> method by calling <var>Spryker\Zed\DataImport\Business\DataImporter\Queue\DataSetWriterPersistenceStateAwareTrait::setDataSetWriterPersistenceState(false)</var></li>
                                                        <li value="2">switch the persistence state to <var>true</var> once the buffered data was saved to the database by calling <var>Spryker\Zed\DataImport\Business\DataImporter\Queue\DataSetWriterPersistenceStateAwareTrait::setDataSetWriterPersistenceState(true)</var></li>
                                                    </ul>
                                                    <p>This is needed for proper acknowledgment of the corresponding messages in the import queue.</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage" style="font-weight: bold;"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />Pyz\Zed\DataImport\Business\Model\ProductAbstract\Writer\ProductAbstractBulkPdoDataSetWriter</a></span>
                                                        <div class="MCDropDownBody dropDownBody"><pre><code class="language-PHP line-numbers">use Spryker\Zed\DataImport\Business\DataImporter\Queue\DataSetWriterPersistenceStateAwareTrait;
use Spryker\Zed\DataImport\Business\Model\DataSet\DataSetInterface;
use Spryker\Zed\DataImport\Business\Model\DataSet\DataSetWriterInterface;
.....
 
class ProductAbstractBulkPdoDataSetWriter implements DataSetWriterInterface
{
    use DataSetWriterPersistenceStateAwareTrait;
 
    /**
     * Static buffer.
     */
    protected static $productAbstractCollection = [];
 
    .....
 
    public function write(DataSetInterface $dataSet): void
    {
        $this-&gt;setDataSetWriterPersistenceState(false);
         
        // storing data sets in the internal buffer
    }
 
    .....
 
    /**
     * Called once the data in the internal buffer is ready to be saved.
     */
    protected function flush(): void
    {
        // writing data from the buffer to database
         
        $this-&gt;setDataSetWriterPersistenceState(true);
    }
}</code></pre>
                                                        </div>
                                                    </div>
                                                    <p>To perform data importing from the queue into the persistent storage, run <var>vendor/bin/console data:import</var> with the <var>--group</var> option set to <var>QUEUE_READERS</var>.</p><pre><code class="language-PHP line-numbers">vendor/bin/console data:import --group=QUEUE_READERS</code></pre>
                                                    <p class="tip">It is possible to perform both steps (as well as all the other enabled imports) by executing the console command only once. Simply don't use the <var>--group</var> option, or set it to <var>FULL</var>. In this case, the data will be imported into a queue and then immediately consumed from the queue and saved to the persistent storage. All the other importers will be executed as usual. Just make sure that the <b>Step 1</b> importer is configured to run before the <b>Step 2</b> importer.</p>
                                                    <p>&#160;</p>
                                                    <p><b>See also:</b>
                                                    </p>
                                                    <ul>
                                                        <li value="1"><a href="https://documentation.spryker.com/feature_integration_guides/queue-data-import-feature-integration-201903.htm">Integrate the Queue Data Import v.201903.0 into your project</a> </li>
                                                    </ul>
                                                    <p>&#160;</p>
                                                    <p><i>Last review date: Aug 12, 2019</i><![CDATA[  ]]></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div><a class="scroll-top js-scroll-top" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill="#FFF" fill-rule="nonzero" d="M11.82 5.22a.54.54 0 0 1 0 .806.636.636 0 0 1-.852 0L6.607 1.937v13.49a.587.587 0 0 1-.602.573c-.336 0-.611-.258-.611-.573V1.937L1.04 6.026a.647.647 0 0 1-.86 0 .54.54 0 0 1 0-.807L5.573.163a.636.636 0 0 1 .852 0L11.82 5.22z" /></svg></a>
                                <script>/* <![CDATA[ */
			function createGithubUrl() {
			var GITHUB_CONTENT_PATH = '/blob/master/public';
			var link = document.querySelector('.js-widget-github-link');
			var href =
			link.getAttribute('href')
			+ GITHUB_CONTENT_PATH
			+ window.location.pathname;
			link.setAttribute('href', href);
			}
			createGithubUrl();
		/* ]]> */</script>
                                <script>/* <![CDATA[ */
			requirejs.config({
				appDir: '',
				paths: {
					'clipboard': ['https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min']
					
				}
			});
			require(['clipboard'], function(Clipboard) {
				console.log(Clipboard);
				window.Clipboard = Clipboard;
			});
		/* ]]> */</script>
                                <script src="../../resources/scripts/perfect-scrollbar.js">
                                </script>
                                <script src="../../resources/scripts/imagemapster.js">
                                </script>
                                <script src="../../resources/scripts/script.js">
                                </script>
                                <script src="../../resources/scripts/prism.js">
                                </script>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>
