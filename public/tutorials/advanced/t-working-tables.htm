<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="">
    <head>
    </head>
    <body>
        <h1>Tutorial - Working with Tables</h1>

        <p>
            <img src="../../Resources/Images/shoptype/B2B_Shop.png" />
            <img src="../../Resources/Images/shoptype/B2C_Shop.png" />
            <img src="../../Resources/Images/shoptype/MasterSuite.png" />
            <img src="../../Resources/Images/shoptype/Demoshop.png" />
        </p>

        <p>Spryker has a dedicated component to help you build tables for the Zed UI.</p>
        <p>This tutorial will help you get started on working with tables.</p>
        <ul>
            <li class="bullet_list"><a href="#Creating">Creating a New Table</a>
            </li>
            <li class="bullet_list"><a href="#Configur">Configure the Table</a>
            </li>
            <li class="bullet_list"><a href="#Prepare">Prepare the Data</a>
            </li>
            <li class="bullet_list"><a href="#Render">Render the Table</a>
            </li>
        </ul>
        <h2><a name="Creating"></a>Creating a New Table</h2>
        <p>To get started defining the new table, create a new class in your module, under the <code>/Communication/Table/</code> folder that extends the <code>AbstractTable</code> class.</p>
        <p>Example:</p><pre><code class="language-PHP line-numbers">&lt;?php
use Spryker\Zed\Gui\Communication\Table\AbstractTable;

class OrdersTable extends AbstractTable</code></pre>
        <p>The query used for fetching the data must be injected in the constructor.</p>
        <p>The table configuration class must implement the following operations :</p>
        <ul>
            <li class="bullet_list"><code>function configure(TableConfiguration $configuration)</code> : here you setup the captions for the tables header, the searchable and sortable fields and you specify the raw fields</li>
            <li class="bullet_list"><code>function prepareData(TableConfiguration $configuration)</code> : here you prepare the data retrieved by the query in the manner you want to be shown in the table</li>
        </ul>
        <h2><a name="Configur"></a>Configure the Table</h2><pre><code class="language-PHP line-numbers">&lt;?php
function configure(TableConfiguration $configuration)</code></pre>
        <p>The configuration of the table must be done here:</p>
        <ul>
            <li class="bullet_list">setup captions for the table headers (<code>setHeader()</code>)</li>
            <li class="bullet_list">setup searchable fields (<code>setSearchable()</code>)</li>
            <li class="bullet_list">setup sortable fields (<code>setSortable()</code>)</li>
            <li class="bullet_list">setup raw fields - for fields containing HTML markup that should not be escaped (<code>addRawColumn</code>)</li>
        </ul>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Click to expand the code sample</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-PHP line-numbers">&lt;?php
protected function configure(TableConfiguration $config)
{
    $config-&gt;setHeader([
        SpySalesOrderTableMap::COL_ID_SALES_ORDER =&gt; 'Order Id',
        SpySalesOrderTableMap::COL_CREATED_AT =&gt; 'Timestamp',
        SpySalesOrderTableMap::COL_FK_CUSTOMER =&gt; 'Customer Id',
        SpySalesOrderTableMap::COL_FIRST_NAME =&gt; 'Billing Name',
        SpySalesOrderTableMap::COL_GRAND_TOTAL =&gt; 'Value'
    ]);
    $config-&gt;setSortable([
        SpySalesOrderTableMap::COL_CREATED_AT,
        SpySalesOrderTableMap::COL_GRAND_TOTAL
    ]);
    $config-&gt;setSearchable([
        SpySalesOrderTableMap::COL_FIRST_NAME,
        SpySalesOrderTableMap::COL_GRAND_TOTAL
    ]);

    $config-&gt;addRawColumn('URL');

    $this-&gt;persistFilters($config);

    return $config;
}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <h3>Configure the default field for sorting</h3>
        <p>You can configure the field on which the table is sorted by default when it’s initially rendered or when no sorting is applied by the user from the UI. You just need to specify the index of the field when configuring the table:</p><pre><code class="language-PHP line-numbers">&lt;?php
$config-&gt;setDefaultSortColumnIndex(5);</code></pre>
        <p>Additionally, you can configure the default sort direction (for the initial rendering of the table or for the case it’s not set yet), e.g.:</p><pre><code class="language-PHP line-numbers">&lt;?php
$config-&gt;setDefaultSortDirection(
    \Spryker\Zed\Gui\Communication\Table\TableConfiguration::SORT_DESC);</code></pre>
        <h2><a name="Prepare"></a>Prepare the Data</h2><pre><code class="language-PHP line-numbers">&lt;?php

function prepareData(TableConfiguration $configuration)</code></pre>
        <ul>
            <li class="bullet_list">the query results should be mapped to the table columns in here;</li>
            <li class="bullet_list">also data transformations, such as price formatting, should be done here.</li>
        </ul><pre><code class="language-PHP line-numbers">&lt;?php

protected function prepareData(TableConfiguration $config)
{
    $query = $this-&gt;salesQuery;
    $queryResults = $this-&gt;runQuery($query, $config);
    $results = [];
    foreach ($queryResults as $item) {
        $results[] = [
            SpySalesOrderTableMap::COL_ID_SALES_ORDER =&gt; $item[SpySalesOrderTableMap::COL_ID_SALES_ORDER],
            SpySalesOrderTableMap::COL_CREATED_AT =&gt; $item[SpySalesOrderTableMap::COL_CREATED_AT],
            SpySalesOrderTableMap::COL_FK_CUSTOMER =&gt; $item[SpySalesOrderTableMap::COL_FK_CUSTOMER],
            SpySalesOrderTableMap::COL_FIRST_NAME =&gt; $item[SpySalesOrderTableMap::COL_FIRST_NAME],
            SpySalesOrderTableMap::COL_GRAND_TOTAL =&gt; $this-&gt;formatPrice($item[SpySalesOrderTableMap::COL_GRAND_TOTAL])),
        ];
    }
    return $results;
}</code></pre>
        <h2><a name="Render"></a>Render the Table</h2>
        <p>In order to display the query results in the table, in the controller’s action you retrieve an instance of the table configuration class and call the <code>render()</code> operation.</p><pre><code class="language-PHP line-numbers">&lt;?php

public function indexAction(Request $request)
{
    $table = $this-&gt;getFactory()-&gt;createOrdersTable();
    return [
        'orders' =&gt; $table-&gt;render(),
    ];
}</code></pre>
    </body>
</html>