<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Tutorials|Introduction">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Tutorial - Content and Search - Attribute-Cart-Based Catalog Personalization - Spryker Commerce OS</title>
        <!-- Google Tag Manager -->
        <script>/* <![CDATA[ */(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-NP24S2');/* ]]> */</script>
        <!-- End Google Tag Manager -->
        <script>/* <![CDATA[ */
			var s = document.createElement("script");
			s.type = "text/javascript";
			s.src = "https://www.googletagmanager.com/gtag/js?id==UA-56589105-4";
			document.getElementsByTagName('head').item(0).appendChild(s);
		/* ]]> */</script>
        <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-56589105-4');
		/* ]]> */</script>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/perfect-scrollbar.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../resources/scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../resources/scripts/custom.modernizr.js">
        </script>
        <script src="../../resources/scripts/jquery.min.js">
        </script>
        <script src="../../resources/scripts/require.min.js">
        </script>
        <script src="../../resources/scripts/require.config.js">
        </script>
        <script src="../../resources/scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../resources/scripts/plugins.min.js">
        </script>
        <script src="../../resources/scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <!-- Google Tag Manager (noscript) -->
                                <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP24S2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                </noscript>
                                <!-- End Google Tag Manager (noscript) -->
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="breadcrumbs-block">
                                            <div class="nocontent">
                                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                        </div>
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie _Skins_SearchHome mc-component">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="IFF3xCaOW0i-fyww_FNMEg">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="IFF3xCaOW0i-fyww_FNMEg:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="toolbar-wrapper">
                                                    <div class="widget-github js-widget-github"><a class="widget-github-link js-widget-github-link" href="https://github.com/spryker/spryker-documentation" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><path d="M13.5 0C6.057 0 0 6.057 0 13.5c0 5.888 3.791 10.905 9.058 12.745a.463.463 0 0 0 .258.088c1.316.43 2.724.667 4.184.667C20.943 27 27 20.943 27 13.5S20.943 0 13.5 0zm0 .931c6.93 0 12.569 5.639 12.569 12.569 0 5.428-3.459 10.061-8.287 11.818a1.903 1.903 0 0 1-.092-.527v-2.446c0-.975-.477-2.037-.946-2.75 2.584-.436 5.537-1.776 5.537-6.779 0-1.37-.429-2.58-1.275-3.598.186-.611.415-1.9-.225-3.52a.47.47 0 0 0-.291-.272c-.13-.04-1.326-.35-3.806 1.277a12.921 12.921 0 0 0-6.36 0c-2.481-1.63-3.68-1.319-3.809-1.277a.47.47 0 0 0-.29.273C5.582 7.319 5.811 8.607 6 9.218c-.85 1.018-1.279 2.227-1.279 3.598 0 4.957 2.9 6.323 5.463 6.778-.322.407-.66.934-.81 1.47-.661.184-2.018.19-2.929-1.37-.032-.06-.829-1.475-2.4-1.584-.25.002-.882.042-1.035.525-.169.537.424.944.679 1.117l.058.034c.029.015.707.371 1.213 1.644.105.333 1.03 2.84 4.353 2.399.002.367 0 .552-.004.7v.26c0 .15-.045.378-.096.525C4.386 23.558.931 18.924.931 13.5.931 6.57 6.57.931 13.5.931zm6.51 5.375c.5 1.471.158 2.537.035 2.839a.468.468 0 0 0 .089.49c.805.883 1.214 1.952 1.214 3.181 0 4.72-2.796 5.666-5.535 5.97a.464.464 0 0 0-.253.815c.368.314 1.199 1.68 1.199 2.744v2.446c0 .009.001.414.134.809a12.513 12.513 0 0 1-6.792-.002c.135-.396.139-.802.139-.81l.001-.248c.002-.211.006-.497 0-1.266a.473.473 0 0 0-.174-.362.47.47 0 0 0-.391-.09c-3.126.681-3.802-1.576-3.828-1.67l-.016-.047c-.448-1.135-1.037-1.713-1.388-1.975.759.267 1.182 1.007 1.193 1.024 1.231 2.107 3.264 2.162 4.328 1.685a.463.463 0 0 0 .27-.36c.095-.665.826-1.545 1.196-1.87a.464.464 0 0 0 .136-.488.461.461 0 0 0-.39-.324c-2.73-.31-5.524-1.266-5.524-5.98 0-1.228.41-2.3 1.219-3.181a.464.464 0 0 0 .087-.491c-.124-.302-.467-1.364.031-2.837.396.013 1.362.182 2.988 1.286.112.076.256.1.387.063.973-.27 2.058-.416 3.135-.421 1.08.005 2.166.15 3.14.421.131.037.273.013.386-.063 1.635-1.11 2.6-1.275 2.984-1.288z" /></svg></a>
                                                    </div>
                                                    <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic NextTopic Print ExpandAll CollapseAll;">
                                                        <div class="button-group-container-left">
                                                            <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                                            </button>
                                                            <button class="button needs-pie next-topic-button" title="Navigate next">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                                            </button>
                                                            <button class="button needs-pie print-button" title="Print">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                            </button>
                                                            <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="js-anchorer main-content">
                                                    <h1>Tutorial - Content and Search - Attribute-Cart-Based Catalog Personalization - Spryker Commerce OS</h1>
                                                    <p class="info">This tutorial is also available on the Spryker Training web-site. For more information and hands-on exercises, visit the <a href="https://training.spryker.com/courses/developer-bootcamp">Spryker Training</a> web-site.</p>
                                                    <h2>Challenge Description</h2>
                                                    <p>This is another task on personalization. In this one, we will boost and personalize the catalog using the color attribute of a product when it is added to cart. </p>
                                                    <p class="example">So, when you add a red camera to cart, all red cameras are going to be boosted in the catalog and pushed to the top of the products. </p>
                                                    <p>We are using the cart here only for the sake of training. In a real life scenario, you can use the customer's order history to analyze what colors this customer likes and boost the catalog accordingly, or even use another attribute. </p>
                                                    <p>In this task, you will also learn how to work with plugins and extend the search plugin stack.</p>
                                                    <p>Fulltext search engines like Elasticsearch provide a possibility to influence sorting of products by tweaking the scoring function. The scoring function assigns weights to each result based on a formula, usually based on text similarity or synonyms, but we can change it to boost specific products higher than others. </p>
                                                    <p>In this challenge we will try to affect the scoring function based on products that are already in the cart.</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />1. Prepare the search query plugin</a></span>
                                                        <div class="MCDropDownBody dropDownBody">
                                                            <p>As we are working with search and Elasticsearch, we need then to work with the client level. We are also working with the catalog, so our main place to work with is the <b>CatalogClient</b> in <code>src/Pyz/Client/Catalog</code>.</p>
                                                            <p>The client uses a stack of plugins that implement <code>Spryker/Client/Search/Dependency/Plugin/QueryExpanderPluginInterface</code>. In this task, we will extend this plugin stack by creating a new plugin for boosting and injecting it in the plugin stack. 
				<p class="info">By creating a new plugin for boosting and injecting it in the plugin stack, we can alter the search query accordingly.</p></p>
                                                            <p>Let's create the plugin first.</p>
                                                            <ol>
                                                                <li value="1">Inside the catalog client directory, create the following directories: <code>Plugin/Elasticsearch/QueryExpander</code>. 
					<p>Then, inside the <i>QueryExpander</i> directory, create the new query plugin and call it <b>AttributeCartBasedBoostingQueryExpanderPlugin</b> that implements the <code>QueryExpanderPluginInterface</code>.</p><p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\Catalog\Plugin\Elasticsearch\QueryExpander;
 
use Elastica\Query;
use Elastica\Query\BoolQuery;
use Elastica\Query\FunctionScore;
use Elastica\Query\MultiMatch;
use Generated\Shared\Search\PageIndexMap;
use Generated\Shared\Transfer\ItemTransfer;
use Generated\Shared\Transfer\QuoteTransfer;
use InvalidArgumentException;
use Spryker\Client\Kernel\AbstractPlugin;
use Spryker\Client\Search\Dependency\Plugin\QueryExpanderPluginInterface;
use Spryker\Client\Search\Dependency\Plugin\QueryInterface;
use Spryker\Shared\Kernel\Store;
 
class AttributeCartBasedBoostingQueryExpanderPlugin extends AbstractPlugin implements QueryExpanderPluginInterface
{
	/**
	 * @param QueryInterface $searchQuery
	 * @param array $requestParameters
	 *
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 * @throws \Spryker\Shared\Kernel\Locale\LocaleNotFoundException
	 *
	 * @return QueryInterface
	 */
	public function expandQuery(QueryInterface $searchQuery, array $requestParameters = [])
	{
		$quoteTransfer = $this-&gt;getFactory()
			-&gt;getCartClient()
			-&gt;getQuote();
 
		// Don't need to change query when cart is empty.
		if (!$quoteTransfer-&gt;getItems()-&gt;count()) {
			return $searchQuery;
		}
 
		// Make sure that the query we are extending is compatible with our expectations.
		$boolQuery = $this-&gt;getBoolQuery($searchQuery-&gt;getSearchQuery());
 
		// Boost query based on cart.
		$this-&gt;boostByCartItemColors($boolQuery, $quoteTransfer);
 
		return $searchQuery;
	}
 
	/**
	 * @param \Elastica\Query $query
	 *
	 * @throws \InvalidArgumentException
	 *
	 * @return \Elastica\Query\BoolQuery
	 */
	protected function getBoolQuery(Query $query)
	{
		$boolQuery = $query-&gt;getQuery();
		if (!$boolQuery instanceof BoolQuery) {
			throw new InvalidArgumentException(sprintf(
				'Cart boost query expander available only with %s, got: %s',
				BoolQuery::class,
				get_class($boolQuery)
			));
		}
 
		return $boolQuery;
	}
 
	/**
	 * @param BoolQuery $boolQuery
	 * @param QuoteTransfer $quoteTransfer
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 * @throws \Spryker\Shared\Kernel\Locale\LocaleNotFoundException
	 *
	 * @return void
	 */
	protected function boostByCartItemColors(BoolQuery $boolQuery, QuoteTransfer $quoteTransfer)
	{
		$functionScoreQuery = new FunctionScore();
		// Define how the computed scores are combined for the used functions.
		$functionScoreQuery-&gt;setScoreMode(FunctionScore::SCORE_MODE_MULTIPLY);
		// Define how the newly computed score is combined with the score of the query.
		$functionScoreQuery-&gt;setBoostMode(FunctionScore::BOOST_MODE_MULTIPLY);
 
		foreach ($quoteTransfer-&gt;getItems() as $itemTransfer) {
			$color = $this-&gt;getProductColor($itemTransfer);
 
			if ($color) {
				// Create filter for all products that contains the same color.
				$filter = $this-&gt;createFulltextSearchQuery($color);
 
				// Boost the results with a custom number.
				$functionScoreQuery-&gt;addFunction('weight', 20, $filter);
			}
		}
 
		// Extend the original search query with function_score that will change the score of the results.
		$boolQuery-&gt;addMust($functionScoreQuery);
	}
 
	/**
	 * @param ItemTransfer $itemTransfer
	 *
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 * @throws \Spryker\Shared\Kernel\Locale\LocaleNotFoundException
	 *
	 * @return null
	 */
	protected function getProductColor(ItemTransfer $itemTransfer)
	{
		// We get the concrete product from the key-value storage (Redis).
		$productData = $this-&gt;getFactory()
			-&gt;getProductStorageClient()
			-&gt;getProductAbstractStorageData($itemTransfer-&gt;getIdProductAbstract(), Store::getInstance()-&gt;getCurrentLocale());
 
		return isset($productData['attributes']['color']) ? $productData['attributes']['color'] : null;
	}
 
	/**
	 * @param string $searchString
	 *
	 * @return \Elastica\Query\MultiMatch
	 */
	protected function createFulltextSearchQuery($searchString)
	{
		// We search for color in the "full-text" and "full-text-boosted" fields.
		$matchQuery = (new MultiMatch())
			-&gt;setFields([
				PageIndexMap::FULL_TEXT,
				PageIndexMap::FULL_TEXT_BOOSTED . '^3', // Boost results with custom number.
			])
			-&gt;setQuery($searchString)
			-&gt;setType(MultiMatch::TYPE_CROSS_FIELDS);
 
		return $matchQuery;
	}
}
					</code></pre></p></li>
                                                                <li value="2">As you may notice, the <b>CartClient</b> does not exist as a dependency for the <b>CatalogClient</b>. Let's add this dependency so our query plugin works.
					<p>Open the <code>CatalogDependencyProvider</code> in <code>src/Pyz/Client/Catalog</code> and add the <b>CartClient</b> as a dependency like this:</p><p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\Catalog;
 
use Spryker\Client\Catalog\CatalogDependencyProvider as SprykerCatalogDependencyProvider;
...
use Spryker\Client\Kernel\Container;
...
 
class CatalogDependencyProvider extends SprykerCatalogDependencyProvider
{
	const CLIENT_CART = 'cart client';
 
	/**
	 * @param \Spryker\Client\Kernel\Container $container
	 *
	 * @return \Spryker\Client\Kernel\Container
	 */
	public function provideServiceLayerDependencies(Container $container)
	{
		$container = parent::provideServiceLayerDependencies($container);
 
		$container = $this-&gt;addCartClient($container);
 
		return $container;
	}
 
	/**
	 * @param \Spryker\Client\Kernel\Container $container
	 *
	 * @return \Spryker\Client\Kernel\Container
	 */
	protected function addCartClient(Container $container)
	{
		$container[static::CLIENT_CART] = function (Container $container) {
			return $container-&gt;getLocator()-&gt;cart()-&gt;client();
		};
 
		return $container;
	}
     
	...
}
					</code></pre></p></li>
                                                                <li value="3">Next, get the <b>CartClient</b> dependency using the <b>CatalogFactory</b>. Extend the <b>CatalogFactory</b> of the catalog client in <code>src/Pyz/Client/Catalog</code> and get the <b>CartClient</b>.
				<p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\Catalog;
 
use Spryker\Client\Catalog\CatalogFactory as SprykerCatalogFactory;
 
class CatalogFactory extends SprykerCatalogFactory
{
	/**
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 *
	 * @return \Spryker\Client\Cart\CartClientInterface
	 */
	public function getCartClient()
	{
		return $this-&gt;getProvidedDependency(CatalogDependencyProvider::CLIENT_CART);
	}
}					
				</code></pre></p></li>
                                                                <li value="4">To get the color of a product from the cart we need to read the product data from the <i>key-value storage; Redis</i>. 
				<p>For that you need to use the <b>ProductStorageClient</b> with the method <code>getProductAbstractStorageData()</code>.</p><p>Like the <b>CartClient</b>, the <b>productStorageClient</b> needs to be added to the <code>CatalogDependencyProvider</code>. Then the <b>CatalogFactory</b> can get it from the dependency provider.</p><p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\Catalog;
 
class CatalogDependencyProvider extends SprykerCatalogDependencyProvider
{
	...
	const CLIENT_PRODUCT_STORAGE = 'product storage client';
 
	/**
	 * @param \Spryker\Client\Kernel\Container $container
	 *
	 * @return \Spryker\Client\Kernel\Container
	 */
	public function provideServiceLayerDependencies(Container $container)
	{
		$container = parent::provideServiceLayerDependencies($container);
 
		$container = $this-&gt;addCartClient($container);
		$container = $this-&gt;addProductStorageClient($container);
 
		return $container;
	}
 
	...
     
	/**
	 * @param \Spryker\Client\Kernel\Container $container
	 *
	 * @return \Spryker\Client\Kernel\Container
	 */
	protected function addProductStorageClient(Container $container)
	{
		$container[static::CLIENT_PRODUCT_STORAGE] = function (Container $container) {
			return $container-&gt;getLocator()-&gt;productStorage()-&gt;client();
		};
 
		return $container;
	}
 
	...
}
				</code></pre></p><p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\Catalog;
 
use Spryker\Client\Catalog\CatalogFactory as SprykerCatalogFactory;
class CatalogFactory extends SprykerCatalogFactory
{
	...
 
	/**
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 *
	 * @return \Spryker\Client\ProductStorage\ProductStorageClientInterface
	 */
	public function getProductStorageClient()
	{
		return $this-&gt;getProvidedDependency(CatalogDependencyProvider::CLIENT_PRODUCT_STORAGE);
	}
}		
				</code></pre></p></li>
                                                            </ol>
                                                        </div>
                                                    </div>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />2. Extend the catalog's search queries stack</a></span>
                                                        <div class="MCDropDownBody dropDownBody">
                                                            <p>The final step is very simple.</p>
                                                            <p>In the<code>CatalogDependencyProvider</code>, there is a stack of plugins for expanding the search query.</p>
                                                            <p>Boosting the catalog is basically and expansion of the base search query in order to change the weight of products in the catalog page so it changes the order of the products in that page.</p>
                                                            <p>So, to use our new plugin, we simply need to inject it in the <code>CatalogDependencyProvider</code> in the <code>createCatalogSearchQueryExpanderPlugins()</code> method.</p>
                                                            <ol>
                                                                <li value="1">Replace the <code>SortedCategoryQueryExpanderPlugin()</code> with your <code>AttributeCartBasedBoostingQueryExpanderPlugin()</code>.</li>
                                                                <li value="2">Make sure that you keep the same exact position of the the plugin as the order of these plugins matters for the search results.
					<p><pre><code class="language-PHP line-numbers">
/**
 * @return \Spryker\Client\Search\Dependency\Plugin\QueryExpanderPluginInterface[]
 */
protected function createCatalogSearchQueryExpanderPlugins()
{
	return [
		new StoreQueryExpanderPlugin(),
		new LocalizedQueryExpanderPlugin(),
		new ProductPriceQueryExpanderPlugin(),
		new FacetQueryExpanderPlugin(),
		new SortedQueryExpanderPlugin(),
		new AttributeCartBasedBoostingQueryExpanderPlugin(),
		new PaginatedQueryExpanderPlugin(),
		new SpellingSuggestionQueryExpanderPlugin(),
		new IsActiveQueryExpanderPlugin(),
		new IsActiveInDateRangeQueryExpanderPlugin(),
	];
}
					</code></pre></p></li>
                                                            </ol>
                                                            <p>Done! Now go to the Cameras catalog page in your shop <a href="http://www.de.suite.local/en/cameras-&amp;amp;-camcorders/digital-cameras">http://www.de.suite.local/en/cameras-&amp;-camcorders/digital-cameras</a>:</p>
                                                            <ol>
                                                                <li value="1"> Add a red camera to cart</li>
                                                                <li value="2">Go back to the same catalog page. 
					<p>You will see that all red cameras are on the top now.</p></li>
                                                            </ol>
                                                            <p>To see how simple it is to update this boosting, go to the <code>CatalogDependencyProvider</code>, comment and uncomment the <code>AttributeCartBasedBoostingQueryExpanderPlugin()</code>. </p>
                                                            <p>See how it affects the catalog page.</p>
                                                        </div>
                                                    </div>
                                                    <p>&#160;</p>
                                                    <p>&#160;</p>
                                                    <p><i>Last review date: Jul 11, 2018 </i>
                                                    </p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div><a class="scroll-top js-scroll-top" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill="#FFF" fill-rule="nonzero" d="M11.82 5.22a.54.54 0 0 1 0 .806.636.636 0 0 1-.852 0L6.607 1.937v13.49a.587.587 0 0 1-.602.573c-.336 0-.611-.258-.611-.573V1.937L1.04 6.026a.647.647 0 0 1-.86 0 .54.54 0 0 1 0-.807L5.573.163a.636.636 0 0 1 .852 0L11.82 5.22z" /></svg></a>
                                <script>/* <![CDATA[ */
			function createGithubUrl() {
			var GITHUB_CONTENT_PATH = '/blob/master/public';
			var link = document.querySelector('.js-widget-github-link');
			var href =
			link.getAttribute('href')
			+ GITHUB_CONTENT_PATH
			+ window.location.pathname;
			link.setAttribute('href', href);
			}
			createGithubUrl();
		/* ]]> */</script>
                                <script>/* <![CDATA[ */
			requirejs.config({
				appDir: '',
				paths: {
					'clipboard': ['https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min']
					
				}
			});
			require(['clipboard'], function(Clipboard) {
				console.log(Clipboard);
				window.Clipboard = Clipboard;
			});
		/* ]]> */</script>
                                <script src="../../resources/scripts/perfect-scrollbar.js">
                                </script>
                                <script src="../../resources/scripts/imagemapster.js">
                                </script>
                                <script src="../../resources/scripts/script.js">
                                </script>
                                <script src="../../resources/scripts/prism.js">
                                </script>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>
