<!DOCTYPE html>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" lang="en-us" xml:lang="en-us" class="_Skins_HTML5___Top_Navigation" data-mc-search-type="Stem" data-mc-help-system-file-name="Default.xml" data-mc-path-to-help-system="../../" data-mc-has-content-body="True" data-mc-target-type="WebHelp2" data-mc-runtime-file-type="Topic;Default" data-mc-preload-images="false" data-mc-in-preview-mode="false" data-mc-toc-path="Tutorials|Introduction">
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="msapplication-config" content="../../Skins/Favicons/browserconfig.xml" />
        <link rel="apple-touch-icon" sizes="180x180" href="../../Skins/Favicons/apple-touch-icon.png" />
        <link rel="shortcut icon" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="96x96" href="../../Skins/Favicons/favicon-96x96.png" />
        <link rel="icon" sizes="32x32" href="../../Skins/Favicons/favicon-32x32.png" />
        <link rel="icon" sizes="16x16" href="../../Skins/Favicons/favicon-16x16.png" />
        <meta charset="utf-8" />
        <meta name="description" content="" />
        <meta name="author" content="" /><title>Tutorial - Content and Search - Personalized Catalog Pages - Spryker Commerce OS</title>
        <!-- Google Tag Manager -->
        <script>/* <![CDATA[ */(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
			new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
			j=d.createElement(s),dl=l!='dataLayer'?'&amp;l='+l:'';j.async=true;j.src=
			'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-NP24S2');/* ]]> */</script>
        <!-- End Google Tag Manager -->
        <script>/* <![CDATA[ */
			var s = document.createElement("script");
			s.type = "text/javascript";
			s.src = "https://www.googletagmanager.com/gtag/js?id==UA-56589105-4";
			document.getElementsByTagName('head').item(0).appendChild(s);
		/* ]]> */</script>
        <script>/* <![CDATA[ */
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-56589105-4');
		/* ]]> */</script>
        <link href="../../Skins/Default/Stylesheets/Slideshow.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/TextEffects.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Topic.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Styles.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Tablet.css" rel="stylesheet" />
        <link href="../../Skins/Default/Stylesheets/Components/Mobile.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/foundation.6.2.3.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/styles.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/tablet.css" rel="stylesheet" />
        <link href="../../Skins/Fluid/stylesheets/mobile.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/perfect-scrollbar.css" rel="stylesheet" />
        <link href="../../resources/stylesheets/prism.css" rel="stylesheet" />
        <style>/*&lt;meta /&gt;*/

.button.previous-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-previous.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.next-topic-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/navigate-next.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.print-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/printer.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.expand-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/expand.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.button.collapse-all-button
{
	-pie-background: url('../../Skins/Default/Stylesheets/Images/collapse.png') no-repeat center center, linear-gradient(#ffffff, #ececec);
}

.needs-pie
{
	behavior: url('../../resources/scripts/PIE-no-motw.htc');
}

</style>
        <link href="../../resources/stylesheets/mainstyles.css" rel="stylesheet" />
        <script src="../../resources/scripts/custom.modernizr.js">
        </script>
        <script src="../../resources/scripts/jquery.min.js">
        </script>
        <script src="../../resources/scripts/require.min.js">
        </script>
        <script src="../../resources/scripts/require.config.js">
        </script>
        <script src="../../resources/scripts/foundation.6.2.3_custom.js">
        </script>
        <script src="../../resources/scripts/plugins.min.js">
        </script>
        <script src="../../resources/scripts/MadCapAll.js">
        </script>
    </head>
    <body>
        <div class="foundation-wrap off-canvas-wrapper">
            <div class="off-canvas-wrapper-inner" data-off-canvas-wrapper="">
                <aside class="off-canvas position-right" id="offCanvas" data-off-canvas="" data-position="right" data-mc-ignore="true">
                    <ul class="off-canvas-drilldown vertical menu off-canvas-list" data-drilldown="" data-mc-back-link="Back" data-mc-css-tree-node-expanded="is-drilldown-submenu-parent" data-mc-css-tree-node-collapsed="is-drilldown-submenu-parent" data-mc-css-sub-menu="vertical menu slide-in-right is-drilldown-submenu" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="True" data-mc-include-back="True" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.drilldown" data-mc-toc="True">
                    </ul>
                </aside>
                <div class="off-canvas-content inner-wrap" data-off-canvas-content="">
                    <div data-sticky-container="" class="title-bar-container">
                        <nav class="title-bar tab-bar sticky" data-sticky="" data-options="marginTop:0" style="width:100%" data-sticky-on="small" data-mc-ignore="true">
                            <div class="middle title-bar-section outer-row clearfix">
                                <div class="menu-icon-container relative clearfix">
                                    <button class="menu-icon" data-toggle="offCanvas"><span></span>
                                    </button>
                                </div>
                            </div>
                            <div class="title-bar-layout outer-row">
                                <div class="logo-wrapper"><a class="logo" href="../../home.htm" alt="Logo"></a>
                                </div>
                                <div class="navigation-wrapper nocontent">
                                    <ul class="navigation clearfix" data-mc-css-tree-node-has-children="has-children" data-mc-css-sub-menu="sub-menu" data-mc-expand-event="mouseenter" data-mc-top-nav-menu="True" data-mc-max-depth="3" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                        <li class="placeholder" style="visibility:hidden"><a>placeholder</a>
                                        </li>
                                    </ul>
                                </div>
                                <div class="nav-search-wrapper">
                                    <div class="nav-search row">
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie">
                                                <input class="search-field needs-pie" type="search" placeholder="Search the Academy" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </nav>
                    </div>
                    <section class="main-section">
                        <div class="row outer-row sidenav-layout">
                            <div class="sidenav-wrapper">
                                <div class="sidenav-container">
                                    <ul class="off-canvas-accordion vertical menu sidenav" data-accordion-menu="" data-mc-css-tree-node-expanded="is-accordion-submenu-parent" data-mc-css-tree-node-collapsed="is-accordion-submenu-parent" data-mc-css-sub-menu="vertical menu accordion-menu is-accordion-submenu nested" data-mc-include-indicator="False" data-mc-include-icon="False" data-mc-include-parent-link="False" data-mc-include-back="False" data-mc-defer-expand-event="True" data-mc-expand-event="click.zf.accordionMenu" data-mc-toc="True" data-mc-side-nav-menu="True">
                                    </ul>
                                </div>
                            </div>
                            <div class="body-container" data-mc-content-body="True">
                                <!-- Google Tag Manager (noscript) -->
                                <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NP24S2" height="0" width="0" style="display:none;visibility:hidden"></iframe>
                                </noscript>
                                <!-- End Google Tag Manager (noscript) -->
                                <div class="search-container">
                                    <form class="search" action="#">
                                        <div class="search-bar search-bar-container needs-pie _Skins_SearchTopics mc-component">
                                            <input class="search-field needs-pie" type="search" placeholder="Search" />
                                            <div class="search-filter-wrapper">
                                                <div class="search-filter">
                                                    <div class="search-filter-content">
                                                        <ul>
                                                            <li>All Files</li>
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="search-submit-wrapper" dir="ltr">
                                                <div class="search-submit" title="Search">
                                                </div>
                                            </div>
                                        </div>
                                    </form>
                                </div>
                                <div class="row collapse">
                                    <div class="top-bar">
                                        <div class="breadcrumbs-block">
                                            <div class="nocontent">
                                                <div class="MCBreadcrumbsBox_0 breadcrumbs" data-mc-breadcrumbs-divider=" &gt; " data-mc-breadcrumbs-count="3" data-mc-toc="True"><span class="MCBreadcrumbsPrefix">You are here: </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                        </div>
                                        <form class="search" action="#">
                                            <div class="search-bar search-bar-container needs-pie _Skins_SearchHome mc-component">
                                                <input class="search-field needs-pie" type="search" placeholder="Search" />
                                                <div class="search-filter-wrapper">
                                                    <div class="search-filter">
                                                        <div class="search-filter-content">
                                                            <ul>
                                                                <li>All Files</li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="search-submit-wrapper" dir="ltr">
                                                    <div class="search-submit" title="Search">
                                                    </div>
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="topic-layout">
                                        <div>
                                            <div class="side-menu">
                                                <div data-sticky-container="" id="44w3fFezj0i2F73Hs7EZlg">
                                                    <div class="sticky sticky-menu" style="width:100%" data-sticky="" data-top-anchor="44w3fFezj0i2F73Hs7EZlg:top" data-bottom-anchor="contentBody:bottom" data-sticky-on="small" data-scroll-container-on="small">
                                                        <ul class="nocontent menu _Skins_SideMenu mc-component" data-mc-is-context-sensitive="True" data-mc-linked-toc="Data/Tocs/master.js" data-mc-side-menu="True" data-mc-max-depth="1" data-mc-include-icon="False" data-mc-include-indicator="False" data-mc-include-children="True" data-mc-include-siblings="True" data-mc-include-parent="True" data-mc-toc="True">
                                                        </ul>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div>
                                            <div class="side-menu">
                                                <div class="toolbar-wrapper">
                                                    <div class="widget-github js-widget-github"><a class="widget-github-link js-widget-github-link" href="https://github.com/spryker/spryker-documentation" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 26 26"><path d="M13.5 0C6.057 0 0 6.057 0 13.5c0 5.888 3.791 10.905 9.058 12.745a.463.463 0 0 0 .258.088c1.316.43 2.724.667 4.184.667C20.943 27 27 20.943 27 13.5S20.943 0 13.5 0zm0 .931c6.93 0 12.569 5.639 12.569 12.569 0 5.428-3.459 10.061-8.287 11.818a1.903 1.903 0 0 1-.092-.527v-2.446c0-.975-.477-2.037-.946-2.75 2.584-.436 5.537-1.776 5.537-6.779 0-1.37-.429-2.58-1.275-3.598.186-.611.415-1.9-.225-3.52a.47.47 0 0 0-.291-.272c-.13-.04-1.326-.35-3.806 1.277a12.921 12.921 0 0 0-6.36 0c-2.481-1.63-3.68-1.319-3.809-1.277a.47.47 0 0 0-.29.273C5.582 7.319 5.811 8.607 6 9.218c-.85 1.018-1.279 2.227-1.279 3.598 0 4.957 2.9 6.323 5.463 6.778-.322.407-.66.934-.81 1.47-.661.184-2.018.19-2.929-1.37-.032-.06-.829-1.475-2.4-1.584-.25.002-.882.042-1.035.525-.169.537.424.944.679 1.117l.058.034c.029.015.707.371 1.213 1.644.105.333 1.03 2.84 4.353 2.399.002.367 0 .552-.004.7v.26c0 .15-.045.378-.096.525C4.386 23.558.931 18.924.931 13.5.931 6.57 6.57.931 13.5.931zm6.51 5.375c.5 1.471.158 2.537.035 2.839a.468.468 0 0 0 .089.49c.805.883 1.214 1.952 1.214 3.181 0 4.72-2.796 5.666-5.535 5.97a.464.464 0 0 0-.253.815c.368.314 1.199 1.68 1.199 2.744v2.446c0 .009.001.414.134.809a12.513 12.513 0 0 1-6.792-.002c.135-.396.139-.802.139-.81l.001-.248c.002-.211.006-.497 0-1.266a.473.473 0 0 0-.174-.362.47.47 0 0 0-.391-.09c-3.126.681-3.802-1.576-3.828-1.67l-.016-.047c-.448-1.135-1.037-1.713-1.388-1.975.759.267 1.182 1.007 1.193 1.024 1.231 2.107 3.264 2.162 4.328 1.685a.463.463 0 0 0 .27-.36c.095-.665.826-1.545 1.196-1.87a.464.464 0 0 0 .136-.488.461.461 0 0 0-.39-.324c-2.73-.31-5.524-1.266-5.524-5.98 0-1.228.41-2.3 1.219-3.181a.464.464 0 0 0 .087-.491c-.124-.302-.467-1.364.031-2.837.396.013 1.362.182 2.988 1.286.112.076.256.1.387.063.973-.27 2.058-.416 3.135-.421 1.08.005 2.166.15 3.14.421.131.037.273.013.386-.063 1.635-1.11 2.6-1.275 2.984-1.288z" /></svg></a>
                                                    </div>
                                                    <div class="buttons popup-container clearfix topicToolbarProxy _Skins_TopicToolbar mc-component nocontent" style="mc-topic-toolbar-items: PreviousTopic NextTopic Print ExpandAll CollapseAll;">
                                                        <div class="button-group-container-left">
                                                            <button class="button needs-pie previous-topic-button" title="Navigate previous">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="previous topic" />
                                                            </button>
                                                            <button class="button needs-pie next-topic-button" title="Navigate next">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="next topic" />
                                                            </button>
                                                            <button class="button needs-pie print-button" title="Print">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="print" />
                                                            </button>
                                                            <button class="button needs-pie expand-all-button" data-state1-class="expand-all-button" data-state2-class="collapse-all-button" data-state2-title="Collapse all" title="Expand all" data-state1-title="Expand all">
                                                                <img src="../../Skins/Default/Stylesheets/Images/transparent.gif" alt="expand all" />
                                                            </button>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="js-anchorer main-content">
                                                    <h1>Tutorial - Content and Search - Personalized Catalog Pages - <span class="GeneralProductName">Spryker Commerce OS</span></h1>
                                                    <p class="info">This tutorial is also available on the Spryker Training web-site. For more information and hands-on exercises, visit the <a href="https://training.spryker.com/courses/developer-bootcamp">Spryker Training</a> web-site.</p>
                                                    <h2>Challenge Description</h2>
                                                    <p>The aim of this task is to build the first block of personalization for your shop. We are going to build a new CMS page and fill it with personalized products using the user's session ID. </p>
                                                    <p>We will use the session ID just to show that products change when a new customer visits the page. </p>
                                                    <p class="info">In a real case scenario, the session ID can be replaced and a score calculated from the customer's preferences and order history.</p>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />1. Create the CMS Page</a></span>
                                                        <div class="MCDropDownBody dropDownBody">
                                                            <ol>
                                                                <li value="1">
                        First, we will create the CMS page template. 
						<p>In <code>src/Pyz/Shared/Cms/Theme/default/templates</code>, add a new directory called <i>my-offers</i>.</p><p>Inside this folde, add a twig file called <i>my-offers.twig</i>.</p><p><pre><code class="language-PHP line-numbers">
{% extends template('page-layout-main') %}
 
{% define data = {
	title: _view.pageTitle | default('global.spryker.shop' | trans),
	metaTitle: _view.pageTitle | default('global.spryker.shop' | trans),
	metaDescription: _view.pageDescription | default(''),
	metaKeywords: _view.pageKeywords | default('')
} %}
 
{% block title %}
	&lt;!-- CMS_PLACEHOLDER : "title" --&gt;
	&lt;h3&gt;{{ spyCms('title') | raw }}&lt;/h3&gt;
{% endblock %}
 
{% block content %}
	&lt;!-- CMS_PLACEHOLDER : "content" --&gt;
	&lt;div class="box"&gt;
		{{ spyCms('content') | raw }}
	&lt;/div&gt;
{% endblock %}										
						</code></pre></p></li>
                                                                <li value="2">Create a new CMS page from CMS tab in the back office. Use the twig template you have just added, and use the URL <i>/my-offers</i>. 
					</li>
                                                                <li value="3">Click <b>Next</b> and fill the title and content of the page. 
					<p>Use any title and description you like to add.</p></li>
                                                                <li value="4"> Save the page, and publish it.</li>
                                                                <li value="5">Now, we need to test the CMS page. Go to the <b>My Offers</b> page in your shop: <a href="http://www.de.suite.local/my-offers">http://www.de.suite.local/my-offers</a>.</li>
                                                            </ol>
                                                            <p>That is it! It is very simple to add a CMS page and publish it.</p>
                                                            <p>Next, let's get the personalized products and add them to the page.</p>
                                                        </div>
                                                    </div>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />2. Get the Personalized Products</a></span>
                                                        <div class="MCDropDownBody dropDownBody">
                                                            <p>To get the products, we will use <b>Elasticsearch</b>. To do so, we need to work with the <i>SearchClient</i> as it is the place to connect with <b>Elasticsearch</b>. </p>
                                                            <p>So, mainly we will work with Yves to get the request from the shop, and the client to pass the request to <b>Elasticsearch</b> and get the response back.</p>
                                                            <ol>
                                                                <li value="1">First, create a new Yves module in <code>src/Pyz/Yves</code> and call it <b>PersonalizedProduct</b>.</li>
                                                                <li value="2">Create a <code>PersonalizedProductControllerProvider</code> inside <code>src/Pyz/Yves/PersonalizedProduct/Plugin</code> and add the route to the personalized products inside it.
					<p><pre><code class="language-PHP line-numbers">
namespace Pyz\Yves\PersonalizedProduct\Plugin\Provider;
 
use Silex\Application;
use SprykerShop\Yves\ShopApplication\Plugin\Provider\AbstractYvesControllerProvider;
 
class PersonalizedProductControllerProvider extends AbstractYvesControllerProvider
{
	const PERSONALIZED_PRODUCT_INDEX = 'personalized-product-index';
 
		/**
		 * @param \Silex\Application $app
		 *
		 * @return void
		 */
		protected function defineControllers(Application $app)
		{
			$this-&gt;createGetController('/personalized-product/{limit}', static::PERSONALIZED_PRODUCT_INDEX, 'PersonalizedProduct', 'Index', 'index')
				-&gt;value('limit', 10)
				-&gt;assert('limit', '\d+');
		}
}
					</code></pre></p><div class="info">The <i>value()</i> method gives a default value in case the limit value is not passed from the URL.
							<p>The <i>assert()</i> method checks if the limit value is a positive integer.</p></div></li>
                                                                <li value="3">Register the <code>PersonalizedProductControllerProvider</code> in the method <code>getControllerProviderStack()</code> inside YvesBootstrap.</li>
                                                                <li value="4">Create an <i>IndexController</i> for the <b>PersonalizedProduct</b> module in <code>src/Pyz/Yves/PersonalizedProduct/Controller</code> and add an <i>indexAction()</i>. 
					<p>Then add the twig template for the controller and the action in <code>src/Pyz/Yves/PersonalizedProduct/Theme/default/views/index</code> and call it <i>index.twig</i>.</p><p><pre><code class="language-PHP line-numbers">
namespace Pyz\Yves\PersonalizedProduct\Controller;
 
use Spryker\Yves\Kernel\Controller\AbstractController;
 
class IndexController extends AbstractController
{
	/**
	 * @param $limit
	 *
	 * @return array
	 */
	public function indexAction($limit)
	{
		return [];
	}
}								
</code></pre></p><p><pre><code class="language-PHP line-numbers">
{% extends template('page-blank') %}
 
{% block body %}
	{{ 'My Personalized Products' }}
{% endblock %}									
</code></pre></p></li>
                                                                <div class="info">For now, the Yves part is done. You can now go to <a href="http://www.de.suite.local/personalized-product/12">http://www.de.suite.local/personalized-product/12</a> and get the personalized products page.
					<p>Now try <a href="http://www.de.suite.local/personalized-product/not-positive-integer">http://www.de.suite.local/personalized-product/not-positive-integer</a>, this should result in an <code>404</code> error as the rout in not defined.</p><p>The next set of steps is for work on the client. By performing those, you will connect your module to Elasticsearch. First, you need a client for that in order to connect Yves to Elasticsearch.</p></div>
                                                                <li value="5">Create the PersonalizedProduct's client directory in <b>src/Pyz/Client</b> and call it <i>PersonalizedProduct</i> and add the client class and interface.
					<p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\PersonalizedProduct;
 
interface PersonalizedProductClientInterface
{
	/**
	 * @param int $limit
	 *
	 * @return array
	 */
	public function getPersonalizedProducts($limit);
}						
						</code></pre></p><p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\PersonalizedProduct;
 
use Spryker\Client\Kernel\AbstractClient;
 
class PersonalizedProductClient extends AbstractClient implements PersonalizedProductClientInterface
{
	/**
	 * @param int $limit
	 *
	 * @return array
	 */
	public function getPersonalizedProducts($limit)
	{
	}
}									
									</code></pre></p></li>
                                                                <li value="6">To get the products from Elasticsearch, we need to use the SearchClient. In the SearchClient there is the method <code>search()</code> that queries the search engine and takes a search query and an array of formatters as parameters. So, we need three main steps here: 
					<ul><li value="1">create the query</li><li value="2">get the formatters </li><li value="3">get the SearchClient.</li></ul>Then we can hook things together. 
						<p>First, let's create the query. The query is basically a plugin implementing the QueryInterface. 
						<ol><li value="1">Add the following directory structure inside the client's directory: Plugin/Elasticsearch/Query.</li><li value="2">Then add the query plugin inside it and call it PersonalizedProductQueryPlugin:</li></ol></p><p><pre><code class="language-PHP line-numbers">								
namespace Pyz\Client\PersonalizedProduct\Plugin\Elasticsearch\Query;
 
use Elastica\Query;
use Elastica\Query\BoolQuery;
use Elastica\Query\FunctionScore;
use Elastica\Query\Match;
use Elastica\Query\MatchAll;
use Generated\Shared\Search\PageIndexMap;
use Spryker\Client\Search\Dependency\Plugin\QueryInterface;
use Spryker\Shared\ProductSearch\ProductSearchConfig;
 
class PersonalizedProductQueryPlugin implements QueryInterface
{
	/**
	 * @var int
	 */
	protected $limit;
 
	/**
	 * @param int $limit
	 */
	public function __construct($limit)
	{
		$this-&gt;limit = $limit;
	}
 
	/**
	 * @return \Elastica\Query
	 */
	public function getSearchQuery()
	{
		$boolQuery = (new BoolQuery())
			-&gt;addMust((new FunctionScore())
				-&gt;setQuery(new MatchAll())
				-&gt;addFunction('random_score', ['seed' =&gt; session_id()])
				-&gt;setScoreMode('sum'))
			-&gt;addMust((new Match())
				-&gt;setField(PageIndexMap::TYPE, ProductSearchConfig::RESOURCE_TYPE_PRODUCT_ABSTRACT));
 
		$query = (new Query())
			-&gt;setSource([PageIndexMap::SEARCH_RESULT_DATA])
			-&gt;setQuery($boolQuery)
			-&gt;setSize($this-&gt;limit);
 
		return $query;
	}
}								
									</code></pre></p><p class="info">As you notice, we have the limit passed in the constructor of the query plugin. Also, the seed value is the <code>session_id()</code> of the customer and it is used with the random score from Elasticsearch. Again, you can change these values according to your needs.</p></li>
                                                                <li value="7">Both the formatters and the <b>SearchClient</b> are and external dependency to our <code>PersonalizedProductClient</code>, therefore we need to use the dependency provider to get them and inject them inside our client. Create the <code>PersonalizedProductDependencyProvider</code> in <code>src/Pyz/Client</code> and get both the formatters array and the <b>SearchClient</b>. 
					<p>The formatter that we need to use here is the <code>RawCatalogSearchResultFormatterPlugin</code>.</p><p>Your dependency provider will look like this:</p><p><pre><code class="language-PHP line-numbers">
namespace Pyz\Client\PersonalizedProduct;
 
use Spryker\Client\Catalog\Plugin\Elasticsearch\ResultFormatter\RawCatalogSearchResultFormatterPlugin;
use Spryker\Client\Kernel\AbstractDependencyProvider;
use Spryker\Client\Kernel\Container;
 
class PersonalizedProductDependencyProvider extends AbstractDependencyProvider
{
	const CLIENT_SEARCH = 'CLIENT_SEARCH';
	const CATALOG_SEARCH_RESULT_FORMATTER_PLUGINS = 'CATALOG_SEARCH_RESULT_FORMATTER_PLUGINS';
 
	/**
	 * @param \Spryker\Client\Kernel\Container $container
	 *
	 * @return \Spryker\Client\Kernel\Container
	 */
	public function provideServiceLayerDependencies(Container $container)
	{
		$container = $this-&gt;addSearchClient($container);
		$container = $this-&gt;addCatalogSearchResultFormatterPlugins($container);
 
		return $container;
	}
 
	/**
	 * @param \Spryker\Client\Kernel\Container $container
	 *
	 * @return \Spryker\Client\Kernel\Container
	 */
	protected function addSearchClient(Container $container)
	{
		$container[static::CLIENT_SEARCH] = function (Container $container) {
			return $container-&gt;getLocator()-&gt;search()-&gt;client();
		};
 
		return $container;
	}
 
	public function addCatalogSearchResultFormatterPlugins($container)
	{
		$container[static::CATALOG_SEARCH_RESULT_FORMATTER_PLUGINS] = function () {
			return [
				new RawCatalogSearchResultFormatterPlugin()
			];
		};
 
		return $container;
	}
}
</code></pre></p></li>
                                                                <li value="8">To use the dependencies from the <code>PersonalizedProductDependencyProvider</code>, we need the factory. Create the <code>PersonalizedProductFactory</code> in <code>src/Pyz/Client</code>, then get the dependencies and create the <code>PersonalizedProductQueryPlugin</code> in order for them to be used from the client.
<p><pre><code class="language-PHP line-numbers">						
namespace Pyz\Client\PersonalizedProduct;
 
use Pyz\Client\PersonalizedProduct\Plugin\Elasticsearch\Query\PersonalizedProductQueryPlugin;
use Spryker\Client\Kernel\AbstractFactory;
 
class PersonalizedProductFactory extends AbstractFactory
{
	/**
	 * @param $limit
	 *
	 * @return PersonalizedProductQueryPlugin
	 */
	public function createPersonalizedProductsQueryPlugin($limit)
	{
		return new PersonalizedProductQueryPlugin($limit);
	}
 
	/**
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 *
	 * @return array
	 */
	public function getSearchQueryFormatters()
	{
		return $this-&gt;getProvidedDependency(PersonalizedProductDependencyProvider::CATALOG_SEARCH_RESULT_FORMATTER_PLUGINS);
	}
 
	/**
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 *
	 * @return \Spryker\Client\Search\SearchClientInterface
	 */
	public function getSearchClient()
	{
		return $this-&gt;getProvidedDependency(PersonalizedProductDependencyProvider::CLIENT_SEARCH);
	}
}
						</code></pre></p></li>
                                                                <li value="9">The client now can get all the objects it needs to send the search query and to get the response back from Elasticsearch. 
					<p><pre><code class="language-PHP line-numbers">
/**
 * @param int $limit
 *
 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
 *
 * @return array
 */
public function getPersonalizedProducts($limit)
{
	$searchQuery = $this
		-&gt;getFactory()
		-&gt;createPersonalizedProductsQueryPlugin($limit);
 
	$searchQueryFromatters = $this
		-&gt;getFactory()
		-&gt;getSearchQueryFormatters();
 
	$searchResult = $this-&gt;getFactory()
		-&gt;getSearchClient()
		-&gt;search(
			$searchQuery,
			$searchQueryFromatters
		);
 
	return $searchResult;
}					
									</code></pre></p></li>
                                                                <li value="10">Finally, let's hook things together. The client is done, and now we only need to update the controller and its twig template so it calls the client and renders the results.
<p><pre><code class="language-PHP line-numbers">					
namespace Pyz\Yves\PersonalizedProduct\Controller;
 
use Spryker\Yves\Kernel\Controller\AbstractController;
 
class IndexController extends AbstractController
{
	/**
	 * @param $limit
	 *
	 * @throws \Spryker\Client\Kernel\Exception\Container\ContainerKeyNotFoundException
	 *
	 * @return \Spryker\Yves\Kernel\View\View
	 */
	public function indexAction($limit)
	{
		$searchResults = $this-&gt;getClient()-&gt;getPersonalizedProducts($limit);
 
		return $this-&gt;view(
			$searchResults,
			[],
			'@PersonalizedProduct/views/index/index.twig'
		);
	}
}					
</code></pre></p><p><pre><code class="language-PHP line-numbers">	

{% extends template('page-blank') %}
 
{% define data = {
	products: _view.products
 %}
 
{% block body %}
	&lt;div&gt;
		{% for product in data.products %}
			&lt;div&gt;
				{% include molecule('product-card') with {
					data: {
						name: product.abstract_name,
						abstractId: product.id_product_abstract,
						url: product.url,
						imageUrl: product.images.0.external_url_small,
						price: product.price,
						originalPrice: null
					}
				} only %}
			&lt;/div&gt;
		{% endfor %}
	&lt;/div&gt;
{% endblock %}												
</code></pre></p></li>
                                                            </ol>
                                                            <div class="info">That's it for getting the personalized products. 
				<p>To demonstrate having different personalized products for different customers. Go to <a href="http://www.de.suite.local/personalized-product/12">http://www.de.suite.local/personalized-product/12</a> and check out the products. Refresh the page, you should see the same products as you still have the same session ID.</p><p>Now, remove the Spryker cookie so the session ID is different and refresh the page, you should see different products. This different customers with different sessions IDs get different personalized products.</p></div>
                                                        </div>
                                                    </div>
                                                    <div class="MCDropDown MCDropDown_Closed dropDown"><span class="MCDropDownHead dropDownHead"><a href="javascript:void(0);" class="MCDropDownHotSpot dropDownHotspot MCDropDownHotSpot_ MCHotSpotImage"><img class="MCDropDown_Image_Icon" src="../../Skins/Default/Stylesheets/Images/transparent.gif" height="11" width="16" alt="Closed" data-mc-alt2="Open" />3. Put the personalized products in the CMS page</a></span>
                                                        <div class="MCDropDownBody dropDownBody">
                                                            <p>Let's put our personalized products inside our CMS page, the one we have created in the first step, so they get the same look and feel of the whole shop with extra content around them. </p>
                                                            <p>To do so, we will use the <b>render()</b> method with the twig templates. </p>
                                                            <p>The method takes a path for the route name as a parameter. What it does is that it creates a sub-request internally and calls the route with the provided name, then it renders the results inside another twig template. Open <i>my-offers.twig</i> and use the render method like this <code>{{ render(path('personalized-product-index', {'limit': 12})) }}</code>.</p>
                                                            <p><pre><code class="language-PHP line-numbers">
{% extends template('page-layout-main') %}
 
{% define data = {
	title: _view.pageTitle | default('global.spryker.shop' | trans),
	metaTitle: _view.pageTitle | default('global.spryker.shop' | trans),
	metaDescription: _view.pageDescription | default(''),
	metaKeywords: _view.pageKeywords | default('')
} %}
 
{% block title %}
	&lt;!-- CMS_PLACEHOLDER : "title" --&gt;
	&lt;h3&gt;{{ spyCms('title') | raw }}&lt;/h3&gt;
{% endblock %}
 
{% block content %}
	&lt;!-- CMS_PLACEHOLDER : "content" --&gt;
	&lt;div class="box"&gt;
		{{ spyCms('content') | raw }}
	&lt;/div&gt;
	&lt;div class="box"&gt;
		{{ render(path('personalized-product-index', {'limit': 12})) }}
	&lt;/div&gt;
{% endblock %}
				</code></pre>
                                                            </p>
                                                            <p>Done! To check the results, go to <a href="http://www.de.suite.local/my-offers">http://www.de.suite.local/my-offers</a>. </p>
                                                            <p>Remove the Spryker cookie and refresh again to see different personalized products.</p>
                                                            <p>&#160;</p>
                                                            <p>&#160;</p>
                                                            <p><i>Last review date: Jul 03, 2018</i> </p>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div><a class="scroll-top js-scroll-top" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill="#FFF" fill-rule="nonzero" d="M11.82 5.22a.54.54 0 0 1 0 .806.636.636 0 0 1-.852 0L6.607 1.937v13.49a.587.587 0 0 1-.602.573c-.336 0-.611-.258-.611-.573V1.937L1.04 6.026a.647.647 0 0 1-.86 0 .54.54 0 0 1 0-.807L5.573.163a.636.636 0 0 1 .852 0L11.82 5.22z" /></svg></a>
                                <script>/* <![CDATA[ */
			function createGithubUrl() {
			var GITHUB_CONTENT_PATH = '/blob/master/public';
			var link = document.querySelector('.js-widget-github-link');
			var href =
			link.getAttribute('href')
			+ GITHUB_CONTENT_PATH
			+ window.location.pathname;
			link.setAttribute('href', href);
			}
			createGithubUrl();
		/* ]]> */</script>
                                <script>/* <![CDATA[ */
			requirejs.config({
				appDir: '',
				paths: {
					'clipboard': ['https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min']
					
				}
			});
			require(['clipboard'], function(Clipboard) {
				console.log(Clipboard);
				window.Clipboard = Clipboard;
			});
		/* ]]> */</script>
                                <script src="../../resources/scripts/perfect-scrollbar.js">
                                </script>
                                <script src="../../resources/scripts/script.js">
                                </script>
                                <script src="../../resources/scripts/prism.js">
                                </script>
                            </div>
                        </div>
                    </section><a data-close="true"></a>
                </div>
            </div>
            <script>/* <![CDATA[ */$(document).foundation();/* ]]> */</script>
        </div>
    </body>
</html>
