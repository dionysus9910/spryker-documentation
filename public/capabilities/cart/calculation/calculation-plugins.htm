<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2B,Spryker.B2C,Spryker.DemoShop,Spryker.ShopSuite">
    <head><title>Calculator Plugins | Spryker</title>
        <meta name="description" content="The information in this topic covers the available calculator plugins along with their examples." />
    </head>
    <body>
        <h1>Calculator Plugins <img src="../../../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../../../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../../../Resources/Images/shoptype/MasterSuite.png" /> <img src="../../../Resources/Images/shoptype/Demoshop.png" /></h1>
        <p>Calculator plugins are registered in the <var>CalculationDependencyProvider::getQuoteCalculatorPluginStack()</var> for <var>QuoteTransfer</var> and <var>CalculationDependencyProvider::getOrderCalculatorPluginStack()</var> or in later versions of the Calculation module 4.00 and above <var>CalculationDependencyProvider::getQuoteCalculatorPluginStack()</var> for <var>OrderTransfer</var>.</p>
        <p>This method can be extended on the project level and the plugin stack can be updated with your own plugins.</p>
        <p>Each calculator must implement <var>CalculatorPluginInterface</var>.
			<pre><code class="language-PHP line-numbers">&lt;?php
interface CalculationPluginInterface
{
/**
* @api
*
* @param \Generated\Shared\Transfer\CalculableObjectTransfer $calculableObjectTransfer
*
* @return void
*/
public function recalculate(CalculableObjectTransfer $calculableObjectTransfer);
}</code></pre></p>
        <ul>
            <li><strong>RemoveTotalsCalculatorPlugin</strong> - Resets quote totals, sets TotalsTransfer empty.</li>
            <li><strong>RemoveAllCalculatedDiscountsCalculatorPlugin </strong>- Resets every CalculatedDiscountTransfer.</li>
            <li><strong>ItemGrossAmountsCalculatorPlugin</strong> - Calculates <var>sumGrossPrice</var> for each ItemTransfer.</li>
            <p><pre><code class="language-bash">ItemTransfer::sumGrossPrice = ItemTransfer::unitGrossPrice * ItemTransfer::quantity</code></pre>
            </p>
            <li><strong>ProductOptionGrossSumCalculatorPlugin</strong> - <var>Calculates unitGrossPriceWithProductOptions</var>, <var>sumGrossPriceWithProductOptions </var>for ItemTransfer and <var>sumGrossPrice</var> for ProductOptionTransfer.
				<p><pre><code class="language-bash">ProductOptionTransfer::sumGrossPrice = ProductOptionTransfer::unitGrossPrice * ProductOptionTransfer::quantity
ItemTransfer::unitGrossPriceWithProductOptions = sum(ProductOptionTransfer::unitGrossPrice) + ItemTransfer::unitGrossPrice
ItemTransfer::sumGrossPriceWithProductOptions = sum(ProductOptionTransfer::sumGrossPrice) + ItemTransfer:sumGrossPrice</code></pre></p></li>
            <li><strong>SubtotalTotalsCalculatorPlugin</strong> - Sums each of the <var>sumGrossPriceWithProductOptions</var> items.
			<p><pre><code class="language-bash">TotalsTransfer::subtotal = sum(ItemTransfer::sumGrossPriceWithProductOptions)</code></pre></p></li>
            <li><strong>ExpensesGrossSumAmountCalculatorPlugin</strong> - Calculates <var>sumGrossPrice</var> for each item.
			<p><pre><code class="language-bash">ExpenseTransfer::sumGrossPrice = ExpenseTransfer::unitGrossPrice * ExpenseTransfer::quantity</code></pre></p></li>
            <li><strong>ExpenseTotalsCalculatorPlugin</strong> - Calculates <var>expenseTotal</var> in TotalsTransfer.
			<p><pre><code class="language-bash">TotalsTransfer::expenseTotal = sum(ExpenseTransfer::sumGrossPrice)</code></pre></p></li>
            <li><strong>DiscountCalculatorPlugin</strong> - Applies discounts to current QuoteTransfer each discountable item with property <var>calculatedDiscounts</var>, gets discounts filled. Also <var>voucherDiscounts </var>and <var>cartRuleDiscounts</var> are populated with additional used discount data for order level.
				<div class="info">Discount Calculation
			<p>Discount calculation is a separate topic and is explained here <MadCap:xref href="../../Promotions and Discounts/discount-module-overview.htm">Discount</MadCap:xref>.</p></div></li>
            <li><strong>SumGrossCalculatedDiscountAmountCalculatorPlugin</strong> - Calculates and sets <var>ItemTransfer</var> amounts after discounts to <var>sumGrossPriceWithProductOptionAndDiscountAmounts</var> and <var>unitGrossPriceWithProductOptionAndDiscountAmounts;</var> sets expense amounts after discounts to <var>unitGrossPriceWithDiscounts</var> and <var>sumGrossPriceWithDiscounts</var>.
					<p><pre><code class="language-bash">ItemTransfer::unitGrossPriceWithProductOptionAndDiscountAmounts = ItemTransfer::unitGrossPriceWithProductOptions -  (sum(ItemTransfer:calculatedDiscounts::unitGrossPrice) + sum(ProductOptionTransfer::calculatedDiscounts::unitGrossPrice))
ItemTransfer::sumGrossPriceWithProductOptionAndDiscountAmounts = ItemTransfer::sumGrossPriceWithProductOptions -  (sum(ItemTransfer:calculatedDiscounts::sumGrossPrice) + sum(ProductOptionTransfer::calculatedDiscounts::sumGrossPrice))</code></pre></p></li>
            <li><strong>DiscountTotalsCalculatorPlugin</strong> - Calculates total for discounts used and sets it to <var>totalDiscount</var> in <var>TotalsTransfer</var>. Sum all discountable item <var>CalculatedDiscountTransfer</var> gross amounts:
				<p><pre><code class="language-PHP line-numbers">TotalsTransfer:discountTotal += sum(ItemTransfer::CalculateDiscountTransfer::sumGrossAmount +
ItemTransfer::ProductOptionTransfer::CalculateDiscountTransfer::sumGrossAmount + ExpenseTransfer::sumGrossAmount)
GrandTotalTotalsCalculatorPlugin - Calculates grandTotal in TotalsTransfer.
TotalsTransfer:grandTotal = TotalsTransfer::subtotal + TotalsTransfer:expenseTotal</code></pre></p></li>
            <li><strong>GrandTotalWithDiscountsCalculatorPlugin</strong> - Calculates <var>GrandTotal </var>after discounts in <var>TotalsTransfer</var>.
		<p><pre><code class="language-bash">TotalsTransfer:grandTotal = TotalsTransfer::subtotal + TotalsTransfer:expenseTotal - TotalsTransfer::discountTotal</code></pre></p></li>
            <li><strong>TaxTotalsCalculatorPlugin</strong> - Calculates <var>taxTotal </var>and <var>taxRate</var> used from T<var>otalTransfer::grandTotal</var>, sets it in <var>TotalsTransfer::TaxTotalsTransfer</var>.
                    <p><pre><code class="language-bash">TaxableItems = ItemTransfer, ProductOptionTransfer, ExpenseTransfer. TaxTotalsTransfer::taxRate = sum(TaxableItems) / TaxableItems TaxTotalsTransfer::taxAmount = round((TotalsTransfer::grandTotal * TaxTotalsTransfer::taxRate) / TaxTotalsTransfer::taxRate / 100)</code></pre></p></li>
        </ul>
        <p>&#160;</p>
        <p><b>See also:</b>
        </p>
        <ul>
            <li><a href="calculation.htm">Calculation</a>
            </li>
            <li><a href="calculation-data-structure.htm">Calculation Data Structure</a>
            </li>
        </ul>
    </body>
</html>