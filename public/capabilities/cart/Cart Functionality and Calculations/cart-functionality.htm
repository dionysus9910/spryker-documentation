<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2B,Spryker.B2C">
    <head><title>Cart Functionality | Spryker</title>
        <link href="../../../Resources/TableStyles/PatternedRows2.css" rel="stylesheet" MadCap:stylesheetType="table" />
        <meta name="description" content="Our Cart consists of a few components in Yves and Zed. Cart operations are invoked in CartClient, which contains methods for all common operations." />
    </head>
    <body>
        <h1>Cart Functionality <img src="../../../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../../../Resources/Images/shoptype/B2C_Shop.png" /></h1>
        <p>
            <MadCap:popup>
                <MadCap:popupHead>ML</MadCap:popupHead>
                <MadCap:popupBody>Multi-language</MadCap:popupBody>
            </MadCap:popup> <MadCap:popup><MadCap:popupHead>MS</MadCap:popupHead><MadCap:popupBody>Multi-store</MadCap:popupBody></MadCap:popup> <MadCap:popup><MadCap:popupHead>MC</MadCap:popupHead><MadCap:popupBody>Multi-currency</MadCap:popupBody></MadCap:popup></p>
        <p MadCap:conditions="General.Hidden Comment">Used to be:&#160;http://spryker.github.io/core/bundles/cart/</p>
        <p>Our Cart consists of a few components in Yves and Zed. The Yves components  create the cart requests and persist the cart into the session. The Zed components  persist the data into the database and expand the items with data obtained from plugins.</p>
        <p>Cart operations are invoked in <var>CartClient</var>, which contains methods for all common operations (add, update, remove).</p>
        <p>Each cart operation uses <var>CartChangeTransfer</var> objects. Each transfer holds the current quote transfer and the items that are being modified. Current <var>QuoteTransfer</var> is read from current session and is provided by the <var>QuoteSession</var> session adapter.</p>
        <p>When an operation is invoked, <var>CartClient</var> makes an HTTP request to Zed Cart module. The cart module gateway controller forwards the request to the <var>CartFacade</var> where a corresponding operation is handled and modified; <var>QuoteTransfer</var> is returned to Yves and persisted into the session.</p>
        <h2>Cart Data Flow<a name="CartDataFlow"></a></h2>
        <p>
            <img src="../../../Resources/Images/cart_data_flow.png" title="Click Me" alt="Cart Data Flow" class="Thumbnail" />
        </p>
        <p MadCap:conditions="General.Image_Source">Image source: https://www.gliffy.com/go/html5/9891297</p>
        <h2>Cart Operations</h2>
        <p>The Cart module in Zed has a cart operation class that handles cart operation requests. Each operation does the following:</p>
        <ul>
            <li class="bullet_list"><strong>Expand cart items </strong>- augment cart items with additional data (prices, product details, ProductOptions, …)</li>
            <li class="bullet_list"><strong>Persisting </strong>- storage provider stores items into the database, merges items if same item was added, by default it uses a NonPersistentProvider.</li>
            <li class="bullet_list"><strong>Item grouping</strong> - cart uses the item grouper to group items in the cart using a specially crafted group key, which is provided by cart Expander (e.g.: a list containing the same item coming from different merchants should be split into separate groups and shipped separately).</li>
            <li class="bullet_list"><strong>Log operation message</strong> - Cart writes to messenger messages which should be returned to Yves (for example: validation messages, success, failure messages).</li>
            <li class="bullet_list"><strong>Cart recalculation</strong> - happens for each operation in cart recalculation. Cart amounts are reset and recalculated with new added items.</li>
        </ul>
        <h2>Cart Persistence Providers</h2>
        <p>The Cart has different persistence providers in Zed. By default, it only modifies current QuoteTransfer and it doesn’t persists the data. An example for use case for this is building a cart where the cart items are persisted between log-ins. In this case the <var>StorageProviderInterface</var> needs to be implemented and the operation dependency must be changed.</p>
        <h2>Cart Expanders</h2>
        <p>Zed Cart modules can have expander plugins registered. Expander plugins expand the cart with additional data such as price information, product information and add product options.</p>
        <p>Currently we ship with a couple of plugins:</p>
        <table class="TableStyle-PatternedRows2" style="margin-left: 0;margin-right: auto;mc-table-style: url('../../../Resources/TableStyles/PatternedRows2.css');" cellspacing="0">
            <col class="TableStyle-PatternedRows2-Column-Regular" style="width: 381px;" />
            <col class="TableStyle-PatternedRows2-Column-Regular" />
            <thead>
                <tr class="TableStyle-PatternedRows2-Head-Header1">
                    <th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Cart Expander</th>
                    <th class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-PatternedRows2-Body-LightRows">
                    <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>ProductCartPlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows">Adds product information to <var>ItemTransfer</var> (<var>idConcreteProduct</var>, <var>idAbstractProduct</var>, <var>abstractSku</var>, name and <var>taxRate</var>).</td>
                </tr>
                <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>CartItemPricePlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows">Adds <var>unitGrossPrice</var> into <var>itemTransfer</var>.</td>
                </tr>
                <tr class="TableStyle-PatternedRows2-Body-LightRows">
                    <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>CartItemProductOptionPlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows">Adds <var>productOption</var> collection into <var>ItemTransfer</var>.</td>
                </tr>
                <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>SkuGroupKeyPlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows">Appends SKU to the group key so item's int are grouped by SKU.</td>
                </tr>
                <tr class="TableStyle-PatternedRows2-Body-LightRows">
                    <td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows"><var>CartItemGroupKeyOptionPlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyA-Regular-LightRows">Creates product option group key from option ids, so items with different option combinations would be placed separated.</td>
                </tr>
            </tbody>
        </table>
        <h2><a name="Cart"></a>Cart Pre-Checks</h2>
        <p>
            The Zed Cart module has a list of Pre-Checks. These are validators which run when adding a new item to the cart.
            We have a list of default Pre-Checks and of course you might want to add your own. To do so just add a new plugin to <var>Pyz\Zed\Cart\CartDependencyProvider::getCartPreCheckPlugins()</var>.
        </p>
        <p>Currently we ship a couple of default Pre-Checks:</p>
        <table class="TableStyle-PatternedRows2" style="margin-left: 0;margin-right: auto;mc-table-style: url('../../../Resources/TableStyles/PatternedRows2.css');" cellspacing="0">
            <col class="TableStyle-PatternedRows2-Column-Regular" />
            <col class="TableStyle-PatternedRows2-Column-Regular" />
            <thead>
                <tr class="TableStyle-PatternedRows2-Head-Header1">
                    <th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Cart Pre-Check</th>
                    <th class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Description</th>
                </tr>
            </thead>
            <tbody>
                <tr class="TableStyle-PatternedRows2-Body-LightRows">
                    <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>ProductExistsCartPreCheckPlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows">Checks that passed products exist in the DB. This plugin is provided by <var>ProductCartConnector</var> module.</td>
                </tr>
                <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                    <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>CartBundleAvailabilityPreCheckPlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows">Check availability of new cart items (products and product bundles). Provided by <var>ProductBundle</var> module.</td>
                </tr>
                <tr class="TableStyle-PatternedRows2-Body-LightRows">
                    <td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows"><var>CheckAvailabilityPlugin</var>
                    </td>
                    <td class="TableStyle-PatternedRows2-BodyA-Regular-LightRows">Check availability of new cart items (only products). Provided by <var>AvailabilityCartConnector</var> module.</td>
                </tr>
            </tbody>
        </table>
    </body>
</html>
