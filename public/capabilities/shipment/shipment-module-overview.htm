<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2B,Spryker.B2C,Spryker.DemoShop,Spryker.ShopSuite">
    <head>
    </head>
    <body>
        <h1>Shipment Module Overview <img src="../../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../../Resources/Images/shoptype/MasterSuite.png" /> <img src="../../Resources/Images/shoptype/Demoshop.png" /></h1>
        <p>
            <MadCap:relatedTopics style="mc-label: 'Versions';mc-help-control-display: list;">
                <MadCap:relatedTopic src="shipment-overview.htm" />
            </MadCap:relatedTopics>
        </p>
        <p>The main concepts regarding shipping that are modeled in the database are :</p>
        <ul>
            <li class="bullet_list">shipment carrier</li>
            <li class="bullet_list">shipment method</li>
        </ul>
        <p>The schema below shows how the sales order and shipment method entities are modeled in the database:</p>
        <p>
            <img src="../../Resources/Images/shipment_method_database_schema_2.png" alt="Shipment diagram" class="">
            </img>
        </p>
        <p>A sales order has an associated sales shipment entity which has an associated sales expense. The values of these entities are calculated and stored during the creation of the sales order, using the current state of shipment method, shipment method plugins, shipment method price, shipment carrier, and tax set data.</p>
        <p>Note: The sales order can have additional, not shipment-related expenses.</p>
        <p>For a shipment carrier, the following information must be entered from the Zed Admin UI:</p>
        <ul>
            <li class="bullet_list"><strong>Glossary key name</strong> - ID of the glossary key that holds the name of the shipment carrier (internationalization purpose)</li>
            <li class="bullet_list"><strong>Name</strong> - name of the shipment carrier</li>
            <li class="bullet_list"><strong>Is Active</strong> - if this flag is set to false, then the shipment methods linked to the current shipment carrier are also disabled</li>
        </ul>
        <p>Multiple shipment methods can be added to a shipment carrier. For each shipment method the following details must be entered from the Zed Admin UI:</p>
        <ul>
            <li class="bullet_list"><strong>Tax Set</strong> - shipment method must have an associated tax rate</li>
            <li class="bullet_list"><strong>Glossary Key Name</strong> - ID of the glossary key that holds the name of the shipment method (internationalization purpose)</li>
            <li class="bullet_list"><strong>Glossary Key Description</strong> - ID of the glossary key that holds the description of the shipment method (internationalization purpose)</li>
            <li class="bullet_list"><strong>Name</strong> - name of the shipment method</li>
            <li class="bullet_list"><strong>Price</strong>
            </li>
            <li class="bullet_list"><strong>Is Active</strong> - flag that allows to disable/enable the shipment method</li>
        </ul>
        <p>Additional behaviors can be attached to a shipment method from the Zed Admin UI:</p>
        <ul>
            <li class="bullet_list"><strong>Availability Plugin</strong> - name of the plugin that checks the availability for this shipment method</li>
            <li class="bullet_list"><strong>Delivery Time Plugin</strong> - name of the plugin that can calculate the delivery time for this shipment method</li>
            <li class="bullet_list"><strong>Price Calculation Plugin</strong> - name of the plugin that can calculate the price for this shipment method</li>
        </ul>
        <p class="important">For each glossary key linked to a shipment carrier or methods, the corresponding entry for each locale configured in the application must be added to the glossary keys.</p>
        <p>For more information about the shipment method plugins, visit <a href="shipment-method-plugins.htm">Shipment Methods Plugins</a> page.</p>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Discounts Based on Shipment</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>It is possible to create a discount rule based on a shipment carrier, a shipment method or a shipment price.
				</p>
                <p>
					To have a discount calculated based on a shipment method, select the <var>shipment-method</var>
					rule in the discount UI, <strong>Discount calculation</strong>. Then the discount will be applied only to the shipment expense with
					the chosen method. You could also select <var>shipment-method</var> rule for <strong>Conditions</strong> to define
					that your discount will be applied only when the order will be delivered by the chosen method.
				</p>
                <p>
					The same approach works for a carrier (<var>shipment-carrier</var>) and a price(<var>shipment.price</var>).
					You could combine these rules together based on your requirements.
				</p>
                <p>Follow the steps below to activate this feature:</p>
                <ol>
                    <li>Install <var>ShipmentDiscountConnector</var> module in your project.</li>
                    <li>
						Activate the Decision rule and the Collector plugins in <code>\Pyz\Zed\Discount\DiscountDependencyProvider</code>:
</li>
                </ol><pre><code class="language-PHP line-numbers">&lt;?php

								namespace Pyz\Zed\Discount;

use Spryker\Zed\ShipmentDiscountConnector\Communication\Plugin\DecisionRule\ShipmentCarrierDecisionRulePlugin;
use Spryker\Zed\ShipmentDiscountConnector\Communication\Plugin\DecisionRule\ShipmentMethodDecisionRulePlugin;
use Spryker\Zed\ShipmentDiscountConnector\Communication\Plugin\DecisionRule\ShipmentPriceDecisionRulePlugin;
use Spryker\Zed\ShipmentDiscountConnector\Communication\Plugin\DiscountCollector\ItemByShipmentCarrierPlugin;
use Spryker\Zed\ShipmentDiscountConnector\Communication\Plugin\DiscountCollector\ItemByShipmentMethodPlugin;
use Spryker\Zed\ShipmentDiscountConnector\Communication\Plugin\DiscountCollector\ItemByShipmentPricePlugin;
...

class DiscountDependencyProvider extends SprykerDiscountDependencyProvider
{

    /**
     * @return \Spryker\Zed\Discount\Dependency\Plugin\DecisionRulePluginInterface[]
     */
    protected function getDecisionRulePlugins()
    {
        return array_merge(parent::getDecisionRulePlugins(), [
            ...
            new ShipmentCarrierDecisionRulePlugin(),
            new ShipmentMethodDecisionRulePlugin(),
            new ShipmentPriceDecisionRulePlugin(),
        ]);
    }

    /**
     * @return \Spryker\Zed\Discount\Dependency\Plugin\CollectorPluginInterface[]
     */
    protected function getCollectorPlugins()
    {
        return array_merge(parent::getCollectorPlugins(), [
            ...
            new ItemByShipmentCarrierPlugin(),
            new ItemByShipmentMethodPlugin(),
            new ItemByShipmentPricePlugin(),
        ]);
    }

}
					</code></pre>
                <p>You are ready to use the shipment discounts.</p>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>Checkout Shipment Pre-Check Plugin</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody>
                <p>You can add shipment pre-check plugin to checkout workflow, which will check if the shipment is active in order placing.
				If it's not - then error message will be displayed and customer will get redirected to the shipment step to select another shipment method.</p>
                <p>First, you have to composer install a new module <var>composer require spryker/shipment-checkout-connector</var>. This module will provide plugin itself.</p>
                <p>Then add <var>\Spryker\Zed\ShipmentCheckoutConnector\Communication\Plugin\Checkout\ShipmentCheckoutPreCheckPlugin</var> plugin to checkout dependency provider pre-check plugin stack.</p><pre><code class="language-PHP line-numbers">
	namespace Pyz\Zed\Checkout;
	
	use Spryker\Zed\ShipmentCheckoutConnector\Communication\Plugin\Checkout\ShipmentCheckoutPreCheckPlugin;
	
	class CheckoutDependencyProvider extends SprykerCheckoutDependencyProvider
	{
	    /**
	       * @param \Spryker\Zed\Kernel\Container $container ’
	       *
	       * @return \Spryker\Zed\Checkout\Dependency\Plugin\CheckoutPreConditionInterface[]
	       */
	      protected function getCheckoutPreConditions(Container $container)
	      {
	          return [
	              ...//other plugins
	              new ShipmentCheckoutPreCheckPlugin()
	          ];
	      }
	}						
				</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>&#160;</p>
        <p><b>See also:</b>
        </p>
        <ul>
            <li><a href="#">Getting a general idea about the Shipment feature</a>
            </li>
            <li><a href="shipment-method-plugins.htm">Enabling shipment method plugins</a>
            </li>
            <li><a href="http://documentation.spryker.com/module_migration_guides/mg-shipment.htm">Migrating to a newer version of the Shipment module</a>
            </li>
            <li><a href="http://documentation.spryker.com/tutorials/howtos/ht-add-new-shipment-method-2.htm">Adding a new shipment method</a>
            </li>
        </ul>
        <p>&#160;</p>
        <p><i>Last review date: Dec. 4th, 2017 </i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Aurimas Ličkus</i>
            </MadCap:conditionalText>
        </p>
    </body>
</html>