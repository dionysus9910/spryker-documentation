<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2C,Spryker.B2B">
    <head>
    </head>
    <body>
        <h1>Under the Hood - Product Reviews <img src="../../../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../../../Resources/Images/shoptype/B2C_Shop.png" /></h1>
        <h2>Database Schema</h2>
        <img src="../../../Resources/Images/product_review_er.png" />
        <p>The Product Review module adds a new table: <var>spy_product_review</var>. The table stores all product review related information such as description, rating, locale, customer, product, etc.</p>
        <h2>Product Reviews in Search</h2>
        <p><var>product-review type</var> is defined under the already existing <var>index</var> in Search.</p>
        <p>The product review Search documents are generated with the newly created <var>product-review type</var> using the <a href="#configurable-collectors">configurable collectors</a> with the following mapping:</p><pre><code class="language-html line-numbers">
            {
              "mappings": {
                "product-review": {
                  "dynamic_templates": [
                    {
                      "search-result-data": {
                        "mapping": {
                          "index": "no"
                        },
                        "path_match": "search-result-data.*"
                      }
                    }
                  ],
                  "properties": {
                    "search-result-data": {
                      "type": "object",
                      "include_in_all": false,
                      "properties": {

                      }
                    },
                    "store": {
                      "type": "string",
                      "include_in_all": false,
                      "index": "not_analyzed"
                    },
                    "locale": {
                      "type": "string",
                      "include_in_all": false,
                      "index": "not_analyzed"
                    },
                    "id-product-abstract": {
                      "type": "integer",
                      "include_in_all": false
                    },
                    "rating": {
                      "type": "integer",
                      "include_in_all": false
                    },
                    "created-at": {
                      "type": "string",
                      "include_in_all": false,
                      "index": "not_analyzed"
                    }
                  }
                }
              }
            }
        </code></pre>
        The <var>ProductReviewsQueryPlugin</var> allows to alter a Search query to look for the product reviews of a specific product abstract with the separate <var>product-review type</var>.

        <a href="#" name="configurable-collectors"></a><h2>Configurable Collectors</h2><p>Collectors are able to manage documents within different indexes and to use different types using <var>AbstractConfigurableSearchPropelCollector</var> and <var>AbstractConfigurableSearchPdoCollector</var> abstract classes.</p><p>For an example implementation, please take a look at <var>Business\Collector\Search\ProductReviewCollector</var> class in <var>Product Review Collector</var> module.</p><p>&#160;</p><p><i>Last review date: Aug. 28, 2017 </i><MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Karoly Gerner</i></MadCap:conditionalText></p></body>
</html>