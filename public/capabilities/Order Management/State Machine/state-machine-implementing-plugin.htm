<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" style="" MadCap:conditions="Spryker.B2B,Spryker.B2C,Spryker.DemoShop,Spryker.ShopSuite,Spryker.MultiStore">
    <head>
    </head>
    <body>
        <h1><a name="Implemen"></a>Implementing the Plugin - State Machine <img src="../../../Resources/Images/shoptype/B2B_Shop.png" /> <img src="../../../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../../../Resources/Images/shoptype/MasterSuite.png" /> <img src="../../../Resources/Images/shoptype/Demoshop.png" /></h1>
        <p>
            <MadCap:popup>
                <MadCap:popupHead>MS</MadCap:popupHead>
                <MadCap:popupBody>Multi-store</MadCap:popupBody>
            </MadCap:popup>
        </p>
        <p>To start using state machine, you need create a new plugin by implementing the <span><a href="state-machine-cronjob.htm#State" target="_blank">StateMachineHandlerInterface</a></span>. This plugin is used when there is need for additional information from client or some action happens and the client needs to be notified about it.</p>
        <p>List of interface methods that need to be implemented:</p>
        <ul>
            <li class="bullet_list"><strong>getCommandPlugins()</strong> - returns an array containing the list of command plugins registered for the current state machine; each plugin implements the <a href="state-machine-cronjob.htm#Command" target="_blank">CommandPluginInterface</a>. The keys in the array are the identifiers for the commands defined in the XML that describes the SM.</li>
            <li class="bullet_list"><strong>getConditionPlugins()</strong> - returns an array containing the list of condition plugins registered for the current state machine; each plugin implements the <a href="state-machine-cronjob.htm#Conditio" target="_blank">ConditionPluginInterface</a>. The keys in the array are the identifiers for the conditions defined in the XML that describes the SM.</li>
            <li class="bullet_list"><strong>getStateMachineName()</strong> - returns a string that is the state machine name (case sensitive). Used by many processes while SM is working internally, also it’s the directory subfolder of the XML files.</li>
            <li class="bullet_list"><strong>getActiveProcesses()</strong> - returns an array containing the list of processes used, as they are stored in the XML file names from the SM subfolder.</li>
            <li class="bullet_list"><strong>getInitialStateForProcess($processName)</strong> - returns a string that is the state name to use when the state machine process is initialized.</li>
            <li class="bullet_list"><strong>itemStateUpdated(StateMachineItemTransfer)</strong> - returns a bool; this method is called when the state changes for a single state machine item. It’s up to the client to implement the logic that needs to get executed, but most of the times you need to save the new assigned <var>idItemState</var> in the database.</li>
            <li class="bullet_list"><strong>getStateMachineItemsByStateIds(array $stateIds)</strong> - returns <var>StateMachineItemTransfer[]</var>; this method is called when condition check cron job is running. The client will get the list of stateIds, it’s integer array. You need to return the list of <var>StateMachineItemTransfer</var> objects populated with <var>identifier</var>, <var>IdStateMachineProcess</var>, <var>IdItemState</var>.</li>
        </ul>
        <p>A new created plugin needs to be added to the <var>Pyz\Zed\StateMachine\StateMachineDependencyProvider::getStateMachineHandlers()</var> handler stack. The correct plugin will be selected based on <var>getStateMachineName()</var> method.</p>
        <p>After the plugins are added, you can view the state machine graph in the <a href="http://zed.de.demoshop.local/state-machine/list" title="State machine list" alt="State machine list">State machine list</a>.</p>
        <p>&#160;</p>
        <p><b>See also:</b>
        </p>
        <ul>
            <li><a href="order-process-modelling-state-machines.htm">State Machine Modelling</a>
            </li>
            <li><a href="state-machine-cronjob.htm">Cron Jobs - State Machine</a>
            </li>
            <li><a href="state-machine-events.htm">Triggering Events - State Machine</a>
            </li>
            <li><a href="state-machine-persistence.htm">Persistence - State Machine</a>
            </li>
            <li><a href="state-machine-persistence.htm">Updating Presentation in Zed - State Machine</a>
            </li>
        </ul>
        <p>&#160;</p>
        <p><![CDATA[
		
		]]><i>Last review date: </i><i>Oct. 2nd, 2017 </i><MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Denis Turkov</i><![CDATA[
]]></MadCap:conditionalText></p>
    </body>
</html>