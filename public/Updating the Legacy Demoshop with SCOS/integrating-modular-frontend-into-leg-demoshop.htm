<?xml version="1.0" encoding="utf-8"?>
<html MadCap:conditions="Spryker.DemoShop,General.Draft" xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head>
    </head>
    <body>
        <h1>Integrating Modular Frontend into Legacy Demoshop</h1>
        <h2>Infrastructure Preparation</h2>
        <p class="info">This has to be done only once for Demoshop (not for every feature.)</p>
        <p>These steps are required to install features which use the new <a href="https://github.com/spryker-shop">shop pages and widgets</a> i.e. the shop app.</p>
        <h4>Add infrastructure modules</h4>
        <p>To use the spryker-shop modules, you need to add new modules required by infrastructure. </p>
        <p>Update all the existing modules:</p>
        <p><pre><code class="language-PHP line-numbers">composer update "spryker/*"</code></pre>
        </p>
        <p>Remove the Event-Behavior module to avoid the version constraint problems:</p>
        <p><pre><code class="language-PHP line-numbers">composer remove spryker/event-behavior</code></pre>
        </p>
        <p>Remove</p>
        <p><pre><code class="language-PHP line-numbers">$config[EventBehaviorConstants::EVENT_BEHAVIOR_TRIGGERING_ACTIVE] = false;</code></pre>
        </p>
        <p>from <var>config_default.php</var></p>
        <p>Remove</p>
        <p><pre><code class="language-PHP line-numbers">new EventBehaviorTriggerTimeoutConsole(),</code></pre>
        </p>
        <p>from <var>\Pyz\Zed\Console\ConsoleDependencyProvider</var></p>
        <p>Install the required modules for Shop-App:</p>
        <p><pre><code class="language-PHP line-numbers">composer require "spryker/kernel":"^3.24.0" spryker-shop/shop-router:"^1.0.0" <br />spryker-shop/shop-application:"^1.3.0" spryker-shop/shop-ui:"^1.0.0" --update-with-all-dependencies</code></pre>
        </p>
        <p>Install the required modules for Publish&amp;Synchronize:</p>
        <p><i>composer require spryker/availability-storage:"^1.0.0" spryker/category-page-search:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/category-storage:"^1.0.0" spryker/cms-block-category-storage:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/cms-block-product-storage:"^1.0.0" spryker/cms-block-storage:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/cms-page-search:"^1.0.0" spryker/cms-storage:"^1.0.0" spryker/glossary-storage:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/navigation-storage:"^1.0.0" spryker/price-product-storage:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/product-category-filter-storage:"^1.0.0"</i>
            <br style="font-style: italic;" /><i>spryker/product-category-storage:"^1.0.0" spryker/product-group-storage:"^1.0.0"</i>
            <br style="font-style: italic;" /><i>spryker/product-image-storage:"^1.0.0" spryker/product-label-search:"^1.0.0"</i>
            <br style="font-style: italic;" /><i>spryker/product-label-storage:"^1.0.0" spryker/product-measurement-unit:"^0.2.0"</i>
            <br style="font-style: italic;" /><i>spryker/product-measurement-unit-storage:"^0.2.0" spryker/product-option-storage:"^1.0.0"</i>
            <br style="font-style: italic;" /><i>spryker/product-page-search:"^1.0.0" spryker/product-relation-storage:"^1.0.0"</i>
            <br style="font-style: italic;" /><i>spryker/product-review-search:"^1.0.0" spryker/product-review-storage:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/product-search-config-storage:"^1.0.0" spryker/product-set-page-search:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/product-set-storage:"^1.0.0" spryker/product-storage:"^1.0.0" </i>
            <br style="font-style: italic;" /><i>spryker/url-storage:"^1.0.0"  spryker/product-quantity-storage:"^0.1.1" --update-with-all-dependencies</i><![CDATA[
		
		]]></p>
        <p>
            <h4>Add namespace to configuration</h4>
        </p>
        <p>To let the kernel find your files within the SprykerShop Organization namespace, you need to add SprykerShop as a new namespace to <var>Spryker\Shared\Kernel\KernelConstants::CORE_NAMESPACES in your ./config/Shared/config_default.php </var></p>
        <p class="info"><code class="language-PHP line-numbers">$config[\Spryker\Shared\Kernel\KernelConstants::CORE_NAMESPACES] = [
				'SprykerEco',
				'Spryker',
				'SprykerShop'
			];</code>
        </p>
        <p>&#160;</p>
        <h4>Add service providers</h4>
        <p>To make all the features available from the newly added Modules, you need to add the following lines to <var>Pyz\Yves\Application\YvesBootstrap::registerServiceProviders()</var> between the registration of the TwigServiceProvider and the SprykerTwigServiceProvider.</p>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot><b>Click to expand the code sample</b>
                </MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><b>src/Pyz/Yves/Application/YvesBootstrap.php</b><pre xml:space="preserve"><code class="language-PHP line-numbers">
...
use SprykerShop\Yves\ShopApplication\Plugin\Provider\ShopApplicationServiceProvider;
use SprykerShop\Yves\ShopApplication\Plugin\Provider\ShopControllerEventServiceProvider;
use SprykerShop\Yves\ShopApplication\Plugin\Provider\ShopTwigServiceProvider;
use SprykerShop\Yves\ShopApplication\Plugin\Provider\WidgetServiceProvider;
use SprykerShop\Yves\ShopApplication\Plugin\Provider\WidgetTagServiceProvider;
use SprykerShop\Yves\ShopUi\Plugin\Provider\ShopUiTwigServiceProvider;
 
class YvesBootstrap
{
	...
 
	protected function registerServiceProviders()
	{
		...
 
		$this-&gt;application-&gt;register(new TwigServiceProvider()); // existing registration
 
		$this-&gt;application-&gt;register(new ShopApplicationServiceProvider());
		$this-&gt;application-&gt;register(new ShopControllerEventServiceProvider());
		$this-&gt;application-&gt;register(new ShopTwigServiceProvider());
		$this-&gt;application-&gt;register(new WidgetServiceProvider());
		$this-&gt;application-&gt;register(new WidgetTagServiceProvider());
		$this-&gt;application-&gt;register(new ShopUiTwigServiceProvider());
 
		$this-&gt;application-&gt;register(new SprykerTwigServiceProvider()); // existing registration
 
		...
	}
}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>&#160;</p>
        <h4>Inherit YvesBootstrap</h4>
        <p>You need to inherit YvesBootstrap from SprykerShop\Yves\ShopApplication\YvesBootstrap</p>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot style="font-weight: bold;"><b>Click to expand the code sample</b>
                </MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><b>src/Pyz/Yves/Application/YvesBootstrap.php</b><pre><code class="language-PHP line-numbers">
use SprykerShop\Yves\ShopApplication\YvesBootstrap as SprykerYvesBootstrap;
 
class YvesBootstrap extends SprykerYvesBootstrap{</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>&#160;</p>
        <h4>Adopt routers in YvesBootstrap</h4>
        <p>You will also need to change the applied SilexRouter so that the new controllers from the SprykerShop namespace can be used.</p><pre><code class="language-PHP line-numbers">
// use Pyz\Shared\Application\Business\Routing\SilexRouter;
use SprykerShop\Yves\ShopRouter\Plugin\Router\SilexRouter;</code></pre>
        <p>&#160;</p>
        <h4>Change layout for new shop app modules</h4>
        <p>The new shop app modules use a new layout which is not supported in Demoshop. To make them compatible, you need to switch to the existing layout.</p>
        <p>Create a file <var>page-layout-main.twig</var> and add the following code.</p>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot style="font-weight: bold;"><b>Click to expand the code sample</b>
                </MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><b>src/Pyz/Yves/ShopUi/Theme/default/templates/page-layout-main/page-layout-main.twig</b><pre><code class="language-PHP line-numbers">{% extends "@application/layout/layout.twig" %}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>Don't forget to flush the cache afterwards.</p><pre><code class="language-PHP line-numbers">console cache:empty-all</code></pre>
        <p><b>See also:</b>
        </p>
        <ul>
            <li><a href="twig-compatibility-mode-demoshop-vs-suite.htm">Using SCOS Twig templates in the Legcay Demoshop</a>
            </li>
            <li><a href="demoshop-to-atomic-frontend.htm">Migrating from the Legacy Demoshop to Atomic Frontend</a>
            </li>
            <li><a href="setting-up-shopuicompatibility.htm">Setting up ShopUiCompatibility Module in the Legacy Demoshop</a>
            </li>
            <li>Tutorial - Pages and Widgets</li>
        </ul>
        <p>&#160;</p>
        <p><i>Last review date: Nov 1, 2018</i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment">by René Klatt, Tamás Nyulas, Dmitry Beirak</MadCap:conditionalText>
        </p>
    </body>
</html>