<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="ReleaseVersions.2018-10">
    <head><title>Customer API | Spryker</title>
        <link href="../../Resources/TableStyles/PatternedRows2.css" rel="stylesheet" MadCap:stylesheetType="table" />
        <meta name="description" content="This guide will navigate through the process of installing and configuring of the Customer API feature used in Spryker OS." />
    </head>
    <body>
        <h1>Customer API Feature Integration</h1>
        <MadCap:menuProxy data-mc-skin="/Project/Skins/SideMenuNotFixed.flskn" mc-linked-toc="$topicHeadings" style="mc-context-sensitive: True;mc-include-parent: True;mc-include-siblings: True;mc-include-children: True;" />
        <h2>Install Feature API</h2>
        <h3>Prerequisites</h3>
        <p>To start feature integration, overview and install the necessary features:</p>
        <div class="table-wrap">
            <table style="mc-table-style: url('../../Resources/TableStyles/PatternedRows2.css');" class="TableStyle-PatternedRows2" cellspacing="0">
                <thead>
                    <tr class="TableStyle-PatternedRows2-Head-Header1">
                        <th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Name</th>
                        <th class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Version</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="TableStyle-PatternedRows2-Body-LightRows">
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">Spryker Core</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows">2018.12.0</td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                        <td class="TableStyle-PatternedRows2-BodyB-Regular-DarkerRows">Customer Account Management</td>
                        <td class="TableStyle-PatternedRows2-BodyA-Regular-DarkerRows">2018.12.0</td>
                    </tr>
                </tbody>
            </table>
        </div>
        <h2>1) Install the required modules</h2>
        <p>Run the following command to install the required modules:</p><pre><code class="language-PHP line-numbers">composer require spryker/customers-rest-api:"^1.6.2" --update-with-dependencies</code></pre>
        <div class="tip">
			Make sure that the following module is installed:<br /><div class="table-wrap"><table style="mc-table-style: url('../../Resources/TableStyles/PatternedRows2.css');" class="TableStyle-PatternedRows2" cellspacing="0"><thead><tr class="TableStyle-PatternedRows2-Head-Header1"><th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Module</th><th class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Expected Directory</th></tr></thead><tbody><tr class="TableStyle-PatternedRows2-Body-LightRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>CustomersRestApiExtensions</var></td><td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows"><var>vendor/spryker/customers-rest-api-extension</var></td></tr></tbody><tbody><tr class="TableStyle-PatternedRows2-Body-DarkerRows"><td class="TableStyle-PatternedRows2-BodyB-Regular-DarkerRows"><var>CustomersRestApi	</var></td><td class="TableStyle-PatternedRows2-BodyA-Regular-DarkerRows"><var>vendor/spryker/customers-rest-api</var></td></tr></tbody></table></div></div>
        <h2>2) Set up Database Schema and Transfer objects</h2>
        <p>Run the following commands to apply database changes and generate entity and transfer changes:</p><pre><code class="language-PHP line-numbers">console transfer:generate
console propel:install
console transfer:generate</code></pre>
        <div class="tip">
			Check your database and make sure that the following changes have been applied:<br /><div class="table-wrap"><table style="mc-table-style: url('../../Resources/TableStyles/PatternedRows2.css');" class="TableStyle-PatternedRows2" cellspacing="0"><col class="TableStyle-PatternedRows2-Column-Regular" /><col class="TableStyle-PatternedRows2-Column-Regular" /><col class="TableStyle-PatternedRows2-Column-Regular" /><thead><tr class="TableStyle-PatternedRows2-Head-Header1"><th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Transfer</th><th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Type</th><th class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Event</th></tr></thead><tbody><tr class="TableStyle-PatternedRows2-Body-LightRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>spy_customer_address.uuid</var></td><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">column</td><td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows">created</td></tr><tr class="TableStyle-PatternedRows2-Body-DarkerRows"><td class="TableStyle-PatternedRows2-BodyB-Regular-DarkerRows"><var>spy_customer_address.spy_customer_address-unique-uuid	</var></td><td class="TableStyle-PatternedRows2-BodyB-Regular-DarkerRows">class</td><td class="TableStyle-PatternedRows2-BodyA-Regular-DarkerRows">created</td></tr></tbody></table></div></div>
        <div class="tip">
			Make sure that the following changes are present in the transfer objects:<br /><div class="table-wrap"><table style="mc-table-style: url('../../Resources/TableStyles/PatternedRows2.css');" class="TableStyle-PatternedRows2" cellspacing="0"><thead><tr class="TableStyle-PatternedRows2-Head-Header1"><th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Transfer</th><th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Type</th><th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Event</th><th class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Path</th></tr></thead><tbody><tr class="TableStyle-PatternedRows2-Body-LightRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>Address.uuid</var></td><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">column</td><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">created</td><td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows"><var>src/Generated/Shared/Transfer/Address</var></td></tr><tr class="TableStyle-PatternedRows2-Body-DarkerRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>RestCustomersAttributes</var></td><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">class</td><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">created</td><td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows"><var>src/Generated/Shared/Transfer/RestCustomersAttributes</var></td></tr><tr class="TableStyle-PatternedRows2-Body-LightRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>RestCustomersResponseAttributes</var></td><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">class</td><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">created</td><td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows"><var>src/Generated/Shared/Transfer/RestCustomersResponseAttributes</var></td></tr><tr class="TableStyle-PatternedRows2-Body-DarkerRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>RestCustomersRegisterAttributes</var></td><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">class</td><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">created</td><td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows"><var>src/Generated/Shared/Transfer/RestCustomersRegisterAttributes</var></td></tr><tr class="TableStyle-PatternedRows2-Body-LightRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>RestAddressAttributes</var></td><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">class</td><td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">created</td><td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows"><var>src/Generated/Shared/Transfer/RestAddressAttributes</var></td></tr><tr class="TableStyle-PatternedRows2-Body-DarkerRows"><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>RestCustomerPasswordAttributes</var></td><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">class</td><td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">created</td><td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows"><var>src/Generated/Shared/Transfer/RestCustomerPasswordAttributes</var></td></tr><tr class="TableStyle-PatternedRows2-Body-LightRows"><td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows"><var>RestCustomerForgottenPasswordAttributes</var></td><td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows">class</td><td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows">created</td><td class="TableStyle-PatternedRows2-BodyA-Regular-LightRows"><var>src/Generated/Shared/Transfer/RestCustomerForgottenPasswordAttributes</var></td></tr></tbody></table></div></div>
        <h2>3) Set up behavior</h2>
        <h3>Enable console command</h3>
        <p>Register the console command in ConsoleDependencyProvider:</p><pre><code class="language-PHP line-numbers">&lt;?php
 
namespace Pyz\Zed\Console;
 
use Spryker\Zed\CustomersRestApi\Communication\Console\CustomerAddressesUuidWriterConsole;
 
class ConsoleDependencyProvider extends SprykerConsoleDependencyProvider
{
    /**
     * @param \Spryker\Zed\Kernel\Container $container
     *
     * @return \Symfony\Component\Console\Command\Command[]
     */
    protected function getConsoleCommands(Container $container)
    {
        $commands = [
            new CustomerAddressesUuidWriterConsole(),
        ];
 
        return $commands;
    }
}</code></pre>
        <div class="tip">
			Run the console command and make sure that the new command <var>customer-addresses:uuid:generate</var> is in the list.</div>
        <p>&#160;</p>
        <h3>Migrate data in database</h3>
        <p>Run the following command to generate the UUID for all the existing records in the <var>spy_customer_address</var> table:</p><pre><code class="language-PHP line-numbers">console customer-addresses:uuid:generate</code></pre>
        <div class="tip">
			Make sure that the UUID field is filled out for all records in the <var>spy_customer_address</var> table. You can run the following SQL-query for it and make sure that the result is 0 records.<br /><pre><code class="language-PHP line-numbers">select count(*) from spy_customer_address where uuid is NULL;</code></pre></div>
        <p>&#160;</p>
        <h3>Enable resources and relationships</h3>
        <p>Activate the following plugins:</p>
        <div class="table-wrap">
            <table style="mc-table-style: url('../../Resources/TableStyles/PatternedRows2.css');" class="TableStyle-PatternedRows2" cellspacing="0">
                <thead>
                    <tr class="TableStyle-PatternedRows2-Head-Header1">
                        <th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Plugin</th>
                        <th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Specification</th>
                        <th class="TableStyle-PatternedRows2-HeadE-Regular-Header1">Prerequisites</th>
                        <th class="TableStyle-PatternedRows2-HeadD-Regular-Header1">Namespace</th>
                    </tr>
                </thead>
                <tbody>
                    <tr class="TableStyle-PatternedRows2-Body-LightRows">
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>SetCustomerBeforeActionPlugin.uuid</var>
                        </td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">Sets customer data to session.

</td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">It is expected that the user field will be set in the REST request</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows"><var>Spryker\Glue\CustomersRestApi\Plugin</var>
                        </td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>CustomersResourceRoutePlugin</var>
                        </td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">Registers the <var>customers</var> resource.</td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">None</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows"><var>Spryker\Glue\CustomersRestApi\Plugin</var>
                        </td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-LightRows">
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>AddressesResourceRoutePlugin</var>
                        </td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">Registers the <var>addresses</var> resource.</td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">None</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows"><var>Spryker\Glue\CustomersRestApi\Plugin</var>
                        </td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>CustomerForgottenPasswordResourceRoutePlugin</var>
                        </td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">Registers the <var>customer-forgotten-password</var>
 resource.</td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">None</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows"><var>Spryker\Glue\CustomersRestApi\Plugin</var>
                        </td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-LightRows">
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows"><var>CustomerRestorePasswordResourceRoutePlugin</var>
                        </td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">Registers the <var>customer-restore-password</var>
resource.</td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-LightRows">None</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-LightRows"><var>Spryker\Glue\CustomersRestApi\Plugin</var>
                        </td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-DarkerRows">
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows"><var>CustomerPasswordResourceRoutePlugin</var>
                        </td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">Registers the <var>customer-password</var>
resource.</td>
                        <td class="TableStyle-PatternedRows2-BodyE-Regular-DarkerRows">None</td>
                        <td class="TableStyle-PatternedRows2-BodyD-Regular-DarkerRows"><var>Spryker\Glue\CustomersRestApi\Plugin</var>
                        </td>
                    </tr>
                    <tr class="TableStyle-PatternedRows2-Body-LightRows">
                        <td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows"><var>CustomersToAddressesRelationshipPlugin</var>
                        </td>
                        <td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows">Adds the <var>addresses</var> resource as a relationship to the <var>customers</var> resource</td>
                        <td class="TableStyle-PatternedRows2-BodyB-Regular-LightRows">None</td>
                        <td class="TableStyle-PatternedRows2-BodyA-Regular-LightRows"><var>Spryker\Glue\CustomersRestApi\Plugin</var>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot style="font-weight: bold;">src/Pyz/Glue/GlueApplication/GlueApplicationDependencyProvider.php</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-PHP line-numbers">&lt;?php
 
namespace Pyz\Glue\GlueApplication;
 
use Spryker\Glue\CustomersRestApi\CustomersRestApiConfig;
use Spryker\Glue\CustomersRestApi\Plugin\AddressesResourceRoutePlugin;
use Spryker\Glue\CustomersRestApi\Plugin\CustomerForgottenPasswordResourceRoutePlugin;
use Spryker\Glue\CustomersRestApi\Plugin\CustomerPasswordResourceRoutePlugin;
use Spryker\Glue\CustomersRestApi\Plugin\CustomerRestorePasswordResourceRoutePlugin;
use Spryker\Glue\CustomersRestApi\Plugin\CustomersResourceRoutePlugin;
use Spryker\Glue\CustomersRestApi\Plugin\CustomersToAddressesRelationshipPlugin;
use Spryker\Glue\CustomersRestApi\Plugin\SetCustomerBeforeActionPlugin;
use Spryker\Glue\GlueApplication\GlueApplicationDependencyProvider as SprykerGlueApplicationDependencyProvider;
 
 
class GlueApplicationDependencyProvider extends SprykerGlueApplicationDependencyProvider
{
    /**
    * {@inheritdoc}
    *
    * @return \Spryker\Glue\GlueApplicationExtension\Dependency\Plugin\ResourceRoutePluginInterface[]
    */
    protected function getResourceRoutePlugins(): array
    {       
        return [
            new CustomersResourceRoutePlugin(),
            new CustomerForgottenPasswordResourceRoutePlugin(),
            new CustomerRestorePasswordResourceRoutePlugin(),
            new CustomerPasswordResourceRoutePlugin(),
            new AddressesResourceRoutePlugin(),
        ];
    }
 
    /**
    * {@inheritdoc}
    *
    * @return \Spryker\Glue\GlueApplicationExtension\Dependency\Plugin\ControllerBeforeActionPluginInterface[]
    */
    protected function getControllerBeforeActionPlugins(): array
    {
        return [
            new SetCustomerBeforeActionPlugin(),
        ];
    }
 
    /**
    * {@inheritdoc}
    *
    * @param \Spryker\Glue\GlueApplicationExtension\Dependency\Plugin\ResourceRelationshipCollectionInterface $resourceRelationshipCollection
    *
    * @return \Spryker\Glue\GlueApplicationExtension\Dependency\Plugin\ResourceRelationshipCollectionInterface
    */
    protected function getResourceRelationshipPlugins(
        ResourceRelationshipCollectionInterface $resourceRelationshipCollection
    ): ResourceRelationshipCollectionInterface {
        $resourceRelationshipCollection-&gt;addRelationship(
            CustomersRestApiConfig::RESOURCE_CUSTOMERS,
            new CustomersToAddressesRelationshipPlugin()
        );
 
        return $resourceRelationshipCollection;
    }
}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <div class="tip">
			Make sure that the following endpoints are available:			<ul class="disk"><li><p>http://example.org/customers</p></li><li><p>http://example.org/addresses</p></li><li><p>http://example.org/customer-password</p></li><li><p>http://example.org/customer-forgotten-password</p></li><li><p>http://example.org/customer-restore-password</p></li></ul><p>Send a request to http://example.org/customers/{{customer_id}}?include=addresses. The Customer with the given ID should have at least one address. Make sure that the response includes relationships to the addresses resources.</p><![CDATA[		]]></div>
        <p>&#160;</p>
        <p><b>See also:</b>
        </p>
        <ul>
            <li>
                <p><a href="https://documentation.spryker.com/glue_rest_api/glue_api_storefront_guides/managing-customers.htm">Managing Customers</a>
                </p>
            </li>
        </ul>
        <p>&#160;</p>
        <p><i>Last review date: Feb 12, 2019</i> <MadCap:conditionalText MadCap:conditions="General.Hidden Comment">by Valerii Pravoslavnyi and Dmitry Beirak</MadCap:conditionalText></p>
    </body>
</html>