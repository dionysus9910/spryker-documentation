<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="Spryker.ShopSuite">
    <head><title>Adyen - Integration | Spryker</title>
        <meta name="description" content="Integrate Adyen payment provider into your Spryker project." />
    </head>
    <body>
        <h1>Adyen - Integration</h1>
        <h2>Integration into Project</h2>
        <p>Add sub form plugins and payment method handlers to <var>\Pyz\Yves\CheckoutPage\CheckoutPageDependencyProvider</var>:</p><pre><code class="language-php line-numbers">
protected function addSubFormPluginCollection(Container $container): Container
{
	$container[self::PAYMENT_SUB_FORMS] = function () {
		$paymentSubFormPluginCollection = new SubFormPluginCollection();
		...
		$paymentSubFormPluginCollection-&gt;add(new AdyenCreditCardSubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenSofortSubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenDirectDebitSubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenKlarnaInvoiceSubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenPrepaymentSubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenIdealSubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenPayPalSubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenAliPaySubFormPlugin());
		$paymentSubFormPluginCollection-&gt;add(new AdyenWeChatPaySubFormPlugin());
 
		return $paymentSubFormPluginCollection;
	};
 
	return $container;
}
 
protected function addPaymentMethodHandlerPluginCollection(Container $container): Container
{
	$container[self::PAYMENT_METHOD_HANDLER] = function () {
		$paymentMethodHandlerCollection = new StepHandlerPluginCollection();
		... 
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_CREDIT_CARD);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_SOFORT);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_DIRECT_DEBIT);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_KLARNA_INVOICE);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_PREPAYMENT);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_IDEAL);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_PAY_PAL);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_ALI_PAY);
		$paymentMethodHandlerCollection-&gt;add(new AdyenPaymentHandlerPlugin(), PaymentTransfer::ADYEN_WE_CHAT_PAY);
 
		return $paymentMethodHandlerCollection;
	};
 
	return $container;
}</code></pre>
        <p>Add controller provider to <var>\Pyz\Yves\ShopApplication\YvesBootstrap</var>:</p><pre><code class="language-php line-numbers">	
	
protected function getControllerProviderStack($isSsl)
	{
		return [
			...   
			new AdyenControllerProvider($isSsl),
		];
	}</code></pre>
        <p>Add checkout plugins to <var>\Pyz\Zed\Checkout\CheckoutDependencyProvider</var></p><pre><code class="language-php line-numbers">
	protected function getCheckoutOrderSavers(Container $container)
	{
		$plugins = [
			...
			new AdyenDoSaveOrderPlugin(),
		];
 
		return $plugins;
	}
 
	protected function getCheckoutPostHooks(Container $container)
	{
		return [
			...
			new AdyenPostSaveHookPlugin(),
		];
	}</code></pre>
        <p>Add OMS commands and conditions to <var>\Pyz\Zed\Oms\OmsDependencyProvider</var>:</p><pre><code class="language-php line-numbers">
protected function extendCommandPlugins(Container $container)
{
	$container-&gt;extend(self::COMMAND_PLUGINS, function (CommandCollectionInterface $commandCollection) {
		...
		$commandCollection-&gt;add(new AuthorizePlugin(), 'Adyen/Authorize');
		$commandCollection-&gt;add(new CancelPlugin(), 'Adyen/Cancel');
		$commandCollection-&gt;add(new CapturePlugin(), 'Adyen/Capture');
		$commandCollection-&gt;add(new RefundPlugin(), 'Adyen/Refund');
		$commandCollection-&gt;add(new CancelOrRefundPlugin(), 'Adyen/CancelOrRefund');
 
		return $commandCollection;
	});
 
	return $container;
}
 
protected function extendConditionPlugins(Container $container)
{
	$container-&gt;extend(OmsDependencyProvider::CONDITION_PLUGINS, function (ConditionCollectionInterface $conditionCollection) {
		...
		$conditionCollection-&gt;add(new IsAuthorizedAndCapturedPlugin(), 'Adyen/IsAuthorizedAndCaptured');
		$conditionCollection-&gt;add(new IsAuthorizedPlugin(), 'Adyen/IsAuthorized');
		$conditionCollection-&gt;add(new IsCanceledPlugin(), 'Adyen/IsCanceled');
		$conditionCollection-&gt;add(new IsCancellationReceivedPlugin(), 'Adyen/IsCancellationReceived');
		$conditionCollection-&gt;add(new IsCancellationFailedPlugin(), 'Adyen/IsCancellationFailed');
		$conditionCollection-&gt;add(new IsCapturedPlugin(), 'Adyen/IsCaptured');
		$conditionCollection-&gt;add(new IsCaptureReceivedPlugin(), 'Adyen/IsCaptureReceived');
		$conditionCollection-&gt;add(new IsCaptureFailedPlugin(), 'Adyen/IsCaptureFailed');
		$conditionCollection-&gt;add(new IsRefundedPlugin(), 'Adyen/IsRefunded');
		$conditionCollection-&gt;add(new IsRefundReceivedPlugin(), 'Adyen/IsRefundReceived');
		$conditionCollection-&gt;add(new IsRefundFailedPlugin(), 'Adyen/IsRefundFailed');;
 
		return $conditionCollection;
	});
 
	return $container;
}</code></pre>
        <p>Frontend Integration</p>
        <p>To make Eco module work with your project, it's necessary to extend the frontend part:</p>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>tsconfig.json</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-php line-numbers">
	"include": [
		"./vendor/spryker/spryker-shop/**/*",
		"./vendor/spryker-eco/**/*",
		"./src/Pyz/Yves/**/*"
	],</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>frontend/settings.js</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-php line-numbers">
	// eco folders
	eco: {
		// all modules
		modules: './vendor/spryker-eco'
	},
...
	componentEntryPoints: {
		// absolute dirs in which look for
		dirs: [
			...
			path.join(context, paths.eco.modules),
			...
		],</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>src/Pyz/Yves/CheckoutPage/Theme/default/views/payment/payment.twig</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-twig line-numbers">
...
 
{% block content %}
	{% embed molecule('form') with {
		class: 'box',
		data: {
			form: data.forms.payment,
			options: {
				attr: {
					id: 'payment-form'
				}
			},
			submit: {
				enable: true,
				text: 'checkout.step.summary' | trans
			},
			cancel: {
				enable: true,
				url: data.backUrl,
				text: 'general.back.button' | trans
			}
		}
	} only %}
		{% block fieldset %}
			{% for name, choices in data.form.paymentSelection.vars.choices %}
				{% set paymentProviderIndex = loop.index %}
				&lt;h5&gt;{{ ('checkout.payment.provider.' ~ name) | trans }}&lt;/h5&gt;&lt;ul class="list spacing-y"&gt;
					{% for key, choice in choices %}
						&lt;li class="list__item spacing-y clear"&gt;
							{% embed molecule('form') with {
								data: {
									form: data.form[data.form.paymentSelection[key].vars.value],
									enableStart: false,
									enableEnd: false
								},
								embed: {
									index: loop.index ~ '-' ~ paymentProviderIndex,
									toggler: data.form.paymentSelection[key]
								}
							} only %}
								{% block fieldset %}
									{{ form_row(embed.toggler, {
										required: false,
										component: molecule('toggler-radio'),
										attributes: {
											'target-selector': '.js-payment-method-' ~ embed.index,
											'class-to-toggle': 'is-hidden'
										}
									}) }}
									&lt;div class="col col--sm-12 is-hidden js-payment-method-{{embed.index}}"&gt;&lt;div class="col col--sm-12 col--md-6"&gt;
											{% if data.form.vars.template_path is defined %}
												{% set viewName = data.form.vars.template_path | split('/') %}
												{% include view(viewName[1], viewName[0]) with {
													form: data.form.parent
												} only %}
											{% else %}
												{{parent()}}
											{% endif %}
										&lt;/div&gt;&lt;/div&gt;
								{% endblock %}
							{% endembed %}
						&lt;/li&gt;
					{% endfor %}
				&lt;/ul&gt;
			{% endfor %}
		{% endblock %}
	{% endembed %}
{% endblock %}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <MadCap:dropDown>
            <MadCap:dropDownHead>
                <MadCap:dropDownHotspot>src/Pyz/Yves/Twig/TwigConfig.php</MadCap:dropDownHotspot>
            </MadCap:dropDownHead>
            <MadCap:dropDownBody><pre><code class="language-php line-numbers">
protected function addCoreTemplatePaths(array $paths)
{
	...
	$paths[] = APPLICATION_VENDOR_DIR . '/spryker-eco/%1$s/src/SprykerEco/Yves/%1$s/Theme/' . $themeName;
 
	return $paths;
}</code></pre>
            </MadCap:dropDownBody>
        </MadCap:dropDown>
        <p>&#160;</p>
        <p><b>See also</b>:</p>
        <ul>
            <li><a href="adyen.htm">Get acquainted with Adyen</a>
            </li>
            <li><a href="adyen-configuration.htm">Configure Adyen</a>
            </li>
            <li><a href="adyen-filter-payment-methods.htm">Learn about Adyen Filter Payment Methods
					</a>
            </li>
            <li><a href="adyen-provided-payment-methods.htm">Learn about Adyen Provided Payment Methods</a>
            </li>
        </ul>
        <p>&#160;</p>
        <p><i>Last review date: November, 16th, 2018 </i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Aleksey Kotsuba, Oksana Karasyova</i>
            </MadCap:conditionalText>
        </p>
    </body>
</html>