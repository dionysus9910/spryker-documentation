<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="Spryker.DemoShop,Spryker.B2C">
    <head>
    </head>
    <body>
        <h1>Hedelpay - iDeal <img src="../../../../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../../../../Resources/Images/shoptype/Demoshop.png" /></h1>
        <h3>Setup</h3>
        <p>The following configuration should be made after Heidelpay has been <a href="heidelpay-installation.htm">installed</a> and <a href="heidelpay-integration.htm">integrated</a>.</p>
        <h4>Configuration</h4>
        <p>Example (for testing only):</p><pre><code class="language-php line-numbers">$config[HeidelpayConstants::CONFIG_HEIDELPAY_TRANSACTION_CHANNEL_IDEAL] = '31HA07BC8142C5A171744B56E61281E5';</code></pre>
        <p><sub>This value should be taken from HEIDELPAY.</sub>
        </p>
        <h4>Checkout Payment Step Display</h4>
        <p>Displays payment method name with a radio button. No extra input fields are required.</p>
        <h4>Payment Step Submitting</h4>
        <p>No extra actions needed, quote being filled with payment method selection as default.</p>
        <h4>Summary Review and Order
    Submitting</h4>
        <p style="text-decoration: underline;"><u><span style="text-decoration: none; font-weight: bold;">On "save order" event</span></u>&#160;<span style="text-decoration: none;">- save Heidelpay payment
    per order and items, as usual</span></p>
        <p><b>When state machine is initialized</b>, an event "send
    authorize request" will trigger the authorize request. In case of success, the payment system will
    return a redirect URL for customer, where the payment can be completed. Request and response will be
    fully persisted in the database (<var>spy_payment_heidelpay_transaction_log</var>).&#160;</p>
        <p><u><span style="text-decoration: none; font-weight: bold;">On "post save hook" event</span></u> we check in
    transaction log table if the authorize request was sent successfully and if so, we set an external
    redirect response to the next step (<var>IdealController::authorizeAction()</var>) where the form will be
    displayed with 3 fields: bank country, bank name and account holder name. The URL obtained in the
    previous step will be a "form action". When customer submits the form, he will be redirected
    to the iDeal website to complete the payment.&#160;</p>
        <p><u><span style="text-decoration: none; font-weight: bold;">On payment confirmation</span></u>, response from iDeal is sent to the
    Heidelpay and Heidelpay makes an asynchronous POST request to the shop's <var>CONFIG_HEIDELPAY_PAYMENT_RESPONSE_URL</var>
    URL (Yves), with the result of payment (see <var>HeidelpayController::paymentAction()</var>). This is called
    "external response transaction", the result will be persisted in
    <var>spy_payment_heidelpay_transaction_log</var> as usual.</p>
        
            The most important data here - is the payment
        reference ID which can be used for further transactions like capture/cancel/etc.&#160;
    
        <p style="text-decoration: none;">In the response Heidelpay expects an URL string which defines where customer has to be redirected. In case
    if customer successfully confirmed payment, it should be a link to the checkout order success step, in
    case of the failure - checkout payment failed action with the error code
    (see <var>HeidelpayController::paymentFailedAction()</var> and <a href="heidelpay-error-workflow.htm">Heidelpay - Workflow for Errors</a> section).&#160;Heidelpay
    redirects customer to the given URL and the payment process is finished.&#160;</p><p style="text-decoration: none;"><u><span style="text-decoration: none; font-weight: bold;">Capture the money</span></u> - later on, when the item is shipped to the
    customer, it is time to call "capture" command of the state machine to capture the money
    from the customer's account. This is done in CapturePlugin of the OMS command. In the provided basic
    order state machine for iDeal authorize method, command will be executed automatically, when order
    is manually moved into the "shipped" state. Now order can be considered as "paid".
		</p><p>&#160;</p><p><b>See also:</b></p><ul><li><a href="../heidelpay.htm">Get a general idea about Heidelpay</a></li><li><a href="heidelpay-installation.htm">Install Heidelpay</a></li><li><a href="heidelpay-integration.htm">Integrate Heidelpay</a></li><li><a href="heidelpay-credit-card.htm">Configure Credit Card Secure payment for Heidelpay</a></li><li><a href="heidelpay-error-workflow.htm">Configure error workflow</a></li><li><a href="heidelpay-paypal-debit.htm">Configure Paypal Debit Workflow for Heidelpay</a></li><li><a href="heidelpay-sofort.htm">Configure Sofort payment for Heidelay</a></li></ul><p>&#160;</p><p><![CDATA[   ]]><i>Last
        review date: Nov. 15th, 2017</i><MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i> by Mykyta Borysevych</i></MadCap:conditionalText></p></body>
</html>