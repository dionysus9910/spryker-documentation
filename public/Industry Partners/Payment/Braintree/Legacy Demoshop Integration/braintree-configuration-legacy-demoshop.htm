<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd" MadCap:conditions="Spryker.DemoShop,Spryker.B2C">
    <head><title>Braintree — Configuration for Legacy Demoshop | Spryker</title>
        <meta name="description" content="To configure Braintree module for Legacy Demoshop, use credentials that have been received after registering the Braintree account.Also, Checkout,OMS and Payment configuration needs to be added" />
    </head>
    <body>
        <h1>Braintree - Configuration for the Legacy Demoshop <img src="../../../../Resources/Images/shoptype/B2C_Shop.png" /> <img src="../../../../Resources/Images/shoptype/Demoshop.png" /></h1>
        <p>
    Add <var>spryker-eco/braintree</var> to your project by running <var>composer require spryker-eco/braintree</var>.</p>
        <p>
    Please refer to <var>config/config.dist.php</var> for an example of module configuration.
</p>
        <p>To setup the initial Braintree configuration, use the credentials you received after registering your Braintree merchant account:</p><pre><code class="language-php line-numbers">// the mode of the transaction, either development, integration, sandbox, production, qa (required)
$config[BraintreeConstants::ENVIRONMENT] = '';

// the id of the merchant used (required)
$config[BraintreeConstants::MERCHANT_ID] = '';

// the public key given by the defined merchant account (required)
$config[BraintreeConstants::PUBLIC_KEY] = '';

// the private key given by the defined merchant account (required)
$config[BraintreeConstants::PRIVATE_KEY] = '';

// merchant account id specifying the currency (Marketplace master merchant is used by default)
$config[BraintreeConstants::ACCOUNT_ID] = '';

// merchant account unique identifier (Marketplace master merchant is used by default)
$config[BraintreeConstants::ACCOUNT_UNIQUE_IDENTIFIER] = '';

// defaults to false
$config[BraintreeConstants::IS_VAULTED] = true;

// defaults to false
$config[BraintreeConstants::IS_3D_SECURE] = true;</code></pre>
        <h2>Checkout Configuration</h2>
        <p>To use Braintree in frontend, Braintree payment method handlers and subforms should be added to <var>Pyz/Yves/Checkout/CheckoutDependencyProvider.php</var>.</p><pre xml:space="preserve"><code class="language-php line-numbers">$container[CheckoutDependencyProvider::PAYMENT_METHOD_HANDLER] = function () {
	$paymentHandlerPlugins = new StepHandlerPluginCollection();

		$paymentHandlerPlugins-&gt;add(new BraintreeHandlerPlugin(), PaymentTransfer::BRAINTREE_CREDIT_CARD);
		$paymentHandlerPlugins-&gt;add(new BraintreeHandlerPlugin(), PaymentTransfer::BRAINTREE_PAY_PAL);

	return $paymentHandlerPlugins;
        };

$container[CheckoutDependencyProvider::PAYMENT_SUB_FORMS] = function () {
	$paymentSubFormPlugins = new SubFormPluginCollection();

		$paymentSubFormPlugins-&gt;add(new BraintreeCreditCardSubFormPlugin());
		$paymentSubFormPlugins-&gt;add(new BraintreePayPalSubFormPlugin());

 	return $paymentSubFormPlugins;
        };</code></pre>
        <p>All subform and handler plugins are located in <var>SprykerEco\Yves\Braintree\Plugin\</var> namespace.</p>
        <h2>OMS Configuration</h2>
        <p>Activate the following Braintree process:</p><pre><code class="language-php line-numbers">$config[OmsConstants::ACTIVE_PROCESSES] = [
    'BraintreePayPal01',
    'BraintreeCreditCard01',
];</code></pre><pre><code class="language-php line-numbers">$config[OmsConstants::PROCESS_LOCATION] = [
    OmsConfig::DEFAULT_PROCESS_LOCATION,
    APPLICATION_VENDOR_DIR . '/spryker-eco/braintree/config/Zed/Oms',
];</code></pre><pre><code class="language-php line-numbers">$config[SalesConstants::PAYMENT_METHOD_STATEMACHINE_MAPPING] = [
    \SprykerEco\Shared\Braintree\BraintreeConfig::PAYMENT_METHOD_CREDIT_CARD =&gt; 'BraintreeCreditCard01',
    \SprykerEco\Shared\Braintree\BraintreeConfig::PAYMENT_METHOD_PAY_PAL =&gt; 'BraintreePayPal01',
];</code></pre>
        <p>Default implementation for commands and options should be added to <var>Pyz/Zed/Oms/OmsDependencyProvider.php</var></p>
        <ol>
            <li>Commands:
        <pre><code class="language-php line-numbers">$container-&gt;extend(OmsDependencyProvider::COMMAND_PLUGINS, function (CommandCollectionInterface $commandCollection) {
    $commandCollection
        -&gt;add(new AuthorizePlugin(), 'Braintree/Authorize')
        -&gt;add(new RevertPlugin(), 'Braintree/Revert')
        -&gt;add(new CapturePlugin(), 'Braintree/Capture')
        -&gt;add(new RefundPlugin(), 'Braintree/Refund');

    return $commandCollection;
});</code></pre></li>
            <li>
        Conditions:
        <pre><code class="language-php line-numbers">$container-&gt;extend(OmsDependencyProvider::CONDITION_PLUGINS, function (ConditionCollectionInterface $conditionCollection) {
    $conditionCollection
        -&gt;add(new IsAuthorizationApprovedPlugin(), 'Braintree/IsAuthorizationApproved')
        -&gt;add(new IsReversalApprovedPlugin(), 'Braintree/IsReversalApproved')
        -&gt;add(new IsCaptureApprovedPlugin(), 'Braintree/IsCaptureApproved')
        -&gt;add(new IsRefundApprovedPlugin(), 'Braintree/IsRefundApproved');

    return $conditionCollection;
});</code></pre></li>
        </ol>
        <p>All commands and conditions are located in <var>SprykerEco\Zed\Braintree\Communication\Plugin\Oms\</var> namespace.</p>
        <h2>Payment Configuration</h2>
        <p>Default implementation for checkout payment plugins should be added to <var>Pyz/Zed/Payment/PaymentDependencyProvider.php</var></p><pre><code class="language-php line-numbers">$container-&gt;extend(PaymentDependencyProvider::CHECKOUT_PLUGINS, function (CheckoutPluginCollection $pluginCollection) {
            $pluginCollection
                -&gt;add(new BraintreePreCheckPlugin(), BraintreeConfig::PROVIDER_NAME, PaymentDependencyProvider::CHECKOUT_PRE_CHECK_PLUGINS)
                -&gt;add(new BraintreeSaveOrderPlugin(), BraintreeConfig::PROVIDER_NAME, PaymentDependencyProvider::CHECKOUT_ORDER_SAVER_PLUGINS)
                -&gt;add(new BraintreePostSavePlugin(), BraintreeConfig::PROVIDER_NAME, PaymentDependencyProvider::CHECKOUT_POST_SAVE_PLUGINS);

            return $pluginCollection;
        });</code></pre>
        <p>All payment plugins are located in <var>SprykerEco\Zed\Braintree\Communication\Plugin\Checkout\</var> namespace.</p>
        <p>&#160;</p>
        <p><strong>See also:</strong>
        </p>
        <ul>
            <li><a href="../braintree.htm">Get a general idea about Braintree</a>
            </li>
            <li><a href="braintree-requests-legacy-demoshop.htm">Learn how to perform requests with Braintree</a>
            </li>
            <li><a href="braintree-workflow-legacy-demoshop.htm">Familiarize yourself with the Braintree workflow</a>
            </li>
        </ul>
        <p>&#160;</p>
        <p><i>Last review date: Dec. 22nd, 2017 </i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Darius Telyčėnas</i>
            </MadCap:conditionalText>
        </p>
    </body>
</html>