<?xml version="1.0" encoding="utf-8"?>
<html xmlns:MadCap="http://www.madcapsoftware.com/Schemas/MadCap.xsd">
    <head><title>Seven Senders - the Delivery Platform</title>
    </head>
    <body>
        <h1>Seven Senders - the Delivery Platform</h1>
        <p>
            <img src="../../Resources/Images/7senders_logo.png" />
        </p>
        <h2>Partner Information</h2>
        <table style="margin-left: 0; margin-right: auto;">
            <col />
            <col />
            <tbody>
                <tr>
                    <td><a href="https://www.sevensenders.com/" target="_blank">ABOUT SEVEN SENDERS</a><![CDATA[
                    ]]></td>
                    <td>&#160;</td>
                </tr>
                <tr>
                    <td colspan="2">
                        SEVEN SENDERS optimizes international cross-border shipments by serving as Europe’s Leading Delivery Platform. We unite online retailers of all sizes with local premium carriers abroad, thereby achieving faster and cheaper delivery for customers worldwide. In addition, we offer the SaaS-based solution SENDWISE, that brings full transparency into the international parcel flow, offers seamless tracking and a proactive communication with the end customer to provide a unique shopping experience.
                    </td>
                </tr>
                <tr>
                    <td>YOUR ADVANTAGES:</td>
                    <td>&#160;</td>
                </tr>
                <tr>
                    <td colspan="2">
                        <ul>
                            <li>Seamless integration into the services offered by SEVEN SENDERS</li>
                            <li>Full control over the customer experience during the delivery process</li>
                            <li>Proactively creating the customer journey during delivery</li>
                            <li>Tracking page in the shop design - in no time and without IT support</li>
                            <li>Direct delivery updates to the customer: the right information at the right time</li>
                            <li>25% reduction of customer service efforts through proactive customer communication</li>
                            <li>Harmonization of shipment data including all shipping providers and warehouse locations</li>
                            <li>Access to all premium parcel delivery providers through one platform</li>
                            <li>Multi-carrier solution: the optimal carrier for each parcel</li>
                            <li>Straightforward connection to the own online shop through our APIs and partner plugins</li>
                        </ul>
                    </td>
                </tr>
            </tbody>
        </table>
        <h2>Installation</h2>
        <p>To install Seven Senders, run the command in the console:</p><pre><code class="language-php">composer require spryker-eco/sevensenders:1.0.0</code></pre>
        <h2>Configuration</h2>
        <p>To set up the Seven Senders initial configuration, use the credentials you received from your Seven Senders server. Space id, key id and secret you can get from Settings → API keys panel on Seven Senders server:</p><pre><code class="language-php">$config[SevensendersConstants::API_KEY] = '';
$config[SevensendersConstants::API_URL] = '';</code></pre>
        <h2>Integration</h2>
        <h3>Oms Commands</h3>
        <p>Seven Senders module has two different commands:</p>
        <ul>
            <li><code>\SprykerEco\Zed\Sevensenders\Communication\Plugin\Oms\Command\SevensendersOrderPlugin</code>
            </li>
            <li><code>\SprykerEco\Zed\Sevensenders\Communication\Plugin\Oms\Command\SevensendersShipmentPlugin</code>
            </li>
        </ul>
        <p>You can use this commands in <code>\Pyz\Zed\Oms\OmsDependencyProvider::getCommandPlugins</code></p><pre xml:space="preserve"><code class="language-php line-numbers">...
use Spryker\Zed\Oms\Communication\Plugin\Oms\Command\SendOrderConfirmationPlugin;
use Spryker\Zed\Oms\Communication\Plugin\Oms\Command\SendOrderShippedPlugin;
...

/**
 * @param \Spryker\Zed\Kernel\Container $container
 *
 * @return \Spryker\Zed\Oms\Communication\Plugin\Oms\Command\CommandCollection
 */
protected function getCommandPlugins(Container $container)
{
	$collection = parent::getCommandPlugins($container);
 
	...
	$collection-&gt;add(new SevenordersOrderPlugin(), 'Sevensenders/NewOrder');
	$collection-&gt;add(new SevenordersShipmentPlugin(), 'Sevensenders/NewShipment');
	...
 
	return $collection;
}</code></pre>
        <p>After you are ready to use commands in OMS setup:</p><pre><code class="language-xml line-numbers">&lt;events&gt;
	&lt;event name="shipping_confirmed" onEnter="true" command="Sevensenders/NewOrder"/&gt;
	&lt;event name="shipping_delivered" manual="true" command="Sevensenders/NewShipment"/&gt;
&lt;/events&gt;</code></pre>
        <h3>Oms Conditions</h3>
        <p>Sevensenders module has two different conditions:</p>
        <ul>
            <li><code>SprykerEco\Zed\Sevensenders\Communication\Plugin\Oms\Condition\IsSuccessfulPreviousOrderResponseConditionPlugin</code>
            </li>
            <li><code>SprykerEco\Zed\Sevensenders\Communication\Plugin\Oms\Condition\IsSuccessfulPreviousShipmentResponseConditionPlugin</code>
            </li>
        </ul>
        <p>You can use these commands in <code>\Pyz\Zed\Oms\OmsDependencyProvider::getConditionPlugins</code></p><pre xml:space="preserve"><code class="language-php line-numbers">...
use SprykerEco\Zed\Sevensenders\Communication\Plugin\Oms\Condition\IsSuccessfulPreviousOrderResponseConditionPlugin;
use SprykerEco\Zed\Sevensenders\Communication\Plugin\Oms\Condition\IsSuccessfulPreviousShipmentResponseConditionPlugin;
...
 
/**
 * @param \Spryker\Zed\Kernel\Container $container
 *
 * @return \Spryker\Zed\Oms\Communication\Plugin\Oms\Condition\ConditionCollection
 */
protected function getConditionPlugins(Container $container)
{
	$collection = parent::getConditionPlugins($container);
 
	...
	$collection-&gt;add(new IsSuccessfulPreviousOrderResponseConditionPlugin(), 'Sevensenders/IsSuccessfulResponse');
	$collection-&gt;add(new IsSuccessfulPreviousShipmentResponseConditionPlugin(), 'Sevensenders/IsSuccessfulResponse');
	...
 
	return $collection;
}
</code></pre>
        <p>After you are ready to use commands in OMS setup:</p><pre><code class="language-xml line-numbers">&lt;transition happy="true" condition="Sevensenders/IsSuccessfulResponse"&gt;
	&lt;source&gt;new&lt;/source&gt;
	&lt;target&gt;shipping confirmed&lt;/target&gt;
	&lt;event&gt;shipping_confirmed&lt;/event&gt;
&lt;/transition&gt;</code></pre>
        <h2>API Requests</h2>
        <p><code>\SprykerEco\Zed\Inxmail\Business\Api\Adapter\EventAdapter</code> extending <code>\SprykerEco\Zed\Sevensenders\Business\Api\Adapter\SevensendersApiAdapter</code> contains everything for sending data to Seven Senders system for events.</p>
        <p>You should use <code>\Generated\Shared\Transfer\SevensendersRequestTransfer</code> for request and <code>\Generated\Shared\Transfer\SevensendersResponseTransfer</code></p><pre xml:space="preserve"><code class="language-xml line-numbers">&lt;?xml version="1.0"?&gt;
&lt;transfers xmlns="http://xsd.spryker.com"
	    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	    xsi:schemaLocation="http://static.spryker.com http://static.spryker.com/transfer-01.xsd"&gt;
 
	&lt;transfer name="SevensendersRequest"&gt;
		&lt;property name="payload" type="array"/&gt;
	 &lt;/transfer&gt;
 
	&lt;transfer name="SevensendersResponse"&gt;
		&lt;property name="requestPayload" type="array"/&gt;
		&lt;property name="responsePayload" type="array"/&gt;
		&lt;property name="status" type="int"/&gt;
		&lt;property name="status" type="int"/&gt;
	&lt;/transfer&gt;
&lt;/transfers&gt;</code></pre>
        <h2>Mappers</h2>
        <p>For mapping data from Spryker to Seven Senders <code>\SprykerEco\Zed\Sevensenders\Business\Mapper\OrderMapper</code> and <code>\SprykerEco\Zed\Sevensenders\Business\Mapper\ShipmentMapper</code> are used by default.</p><pre xml:space="preserve"><code class="language-php line-numbers">&lt;?php
 
namespace SprykerEco\Zed\Sevensenders\Business\Mapper;
 
use Generated\Shared\Transfer\OrderTransfer;
use Generated\Shared\Transfer\SevensendersRequestTransfer;
 
class OrderMapper implements MapperInterface
{
	/**
	 * @param \Generated\Shared\Transfer\OrderTransfer $orderTransfer
	 *
	 * @return \Generated\Shared\Transfer\SevensendersRequestTransfer
	 */
	public function map(OrderTransfer $orderTransfer): SevensendersRequestTransfer
	{
		$payload = [
			'order_id' =&gt; (string)$orderTransfer-&gt;getIdSalesOrder(),
			'order_url' =&gt; '',
			'order_date' =&gt; $orderTransfer-&gt;getCreatedAt(),
			'delivered_with_seven_senders' =&gt; true,
			'boarding_complete' =&gt; true,
			'language' =&gt; $orderTransfer-&gt;getLocale() ? $orderTransfer-&gt;getLocale()-&gt;getLocaleName() : '',
			'promised_delivery_date' =&gt; $orderTransfer-&gt;getShipmentDeliveryTime(),
		];
 
		$transfer = new SevensendersRequestTransfer();
		$transfer-&gt;setPayload($payload);
 
		return $transfer;
	}
}</code></pre>
        <p>You can extend <code>OrderMapper</code> on the project level and map fields as you need. If you want to create a new mapper you should implement <code>SprykerEco\Zed\Sevensenders\Business\Mapper\MapperInterface</code>.</p>
        <h2>Persistence layer</h2>
        <p>There is a table in the database for saving response and request data:</p><pre xml:space="preserve"><code class="language-xml line-numbers">&lt;?xml version="1.0"?&gt;
&lt;database xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	   name="zed"
	   xsi:noNamespaceSchemaLocation="http://static.spryker.com/schema-01.xsd"
	   namespace="Orm\Zed\Sevensenders\Persistence"
	   package="src.Orm.Zed.Sevensenders.Persistence"&gt;
 
	&lt;table name="spy_sevensenders_response" idMethod="native"&gt;
		&lt;column name="fk_sales_order" type="INTEGER" required="true" primaryKey="true"/&gt;
		&lt;column name="request_payload" type="LONGVARCHAR" required="true"/&gt;
		&lt;column name="resource_type" type="VARCHAR" required="true" primaryKey="true"/&gt;
		&lt;column name="response_payload" type="LONGVARCHAR" required="true"/&gt;
		&lt;column name="response_status" type="INTEGER" required="true"/&gt;
		&lt;column name="iri" type="VARCHAR" required="true"/&gt;
 
		&lt;unique name="spy_sevensenders_request-order_reference"&gt;
			&lt;unique-column name="fk_sales_order"/&gt;
			&lt;unique-column name="resource_type"/&gt;
		&lt;/unique&gt;
 
		&lt;foreign-key name="spy_sevensenders_request-fk_sales_order" foreignTable="spy_sales_order" phpName="SalesOrder"&gt;
			&lt;reference local="fk_sales_order" foreign="id_sales_order"/&gt;
		&lt;/foreign-key&gt;
	&lt;/table&gt;
 
	&lt;table name="spy_sevensenders_token" idMethod="native"&gt;
		&lt;column name="token" type="VARCHAR" required="true"/&gt;
		&lt;column name="created_at" type="VARCHARv required="true"/&gt;
	&lt;/table&gt;
&lt;/database&gt;</code></pre>
        <p>&#160;</p>
        <p><i>Last review date: November, 16th, 2018 </i>
            <MadCap:conditionalText MadCap:conditions="General.Hidden Comment"><i>by Volodymyr Hrychenko, Oksana Karasyova</i>
            </MadCap:conditionalText>
        </p>
    </body>
</html>